package com afollestad aesthetic import android content res ColorStateList import android support annotation ColorInt @SuppressWarnings WeakerAccess public final class ActiveInactiveColors @ColorInt private final int activeColor @ColorInt private final int inactiveColor private ActiveInactiveColors @ColorInt int activeColor @ColorInt int inactiveColor this activeColor activeColor this inactiveColor inactiveColor public static ActiveInactiveColors create @ColorInt int activeColor @ColorInt int inactiveColor return new ActiveInactiveColors activeColor inactiveColor @ColorInt public int activeColor return activeColor @ColorInt public int inactiveColor return inactiveColor public ColorStateList toEnabledSl return new ColorStateList new int new int android R attr state_enabled new int android R attr state_enabled new int activeColor @@@ 1 1
package com afollestad aesthetic import android annotation SuppressLint import android content Context import android content SharedPreferences import android graphics Color import android graphics drawable ColorDrawable import android support annotation CheckResult import android support annotation ColorInt import android support annotation ColorRes import android support annotation NonNull import android support annotation Nullable import android support annotation StyleRes import android support v4 content ContextCompat import android support v4 util ArrayMap import android support v4 util Pair import android support v4 widget DrawerLayout import android support v7 app AppCompatActivity import android view LayoutInflater import android view View import android view ViewGroup import com f2prateek rx preferences2 RxSharedPreferences import java util ArrayList import java util List import io reactivex Observable import io reactivex ObservableSource import io reactivex disposables CompositeDisposable import io reactivex functions BiFunction import io reactivex functions Consumer import io reactivex functions Function import io reactivex functions Predicate import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util isColorLight import static com afollestad aesthetic Util resolveColor import static com afollestad aesthetic Util setLightStatusBarCompat import static com afollestad aesthetic Util setNavBarColorCompat @SuppressWarnings WeakerAccess unused public class Aesthetic private static final String PREFS_NAME aesthetic prefs private static final String KEY_FIRST_TIME first_time private static final String KEY_ACTIVITY_THEME activity_theme_ s private static final String KEY_IS_DARK is_dark private static final String KEY_PRIMARY_COLOR primary_color private static final String KEY_PRIMARY_DARK_COLOR primary_dark_color private static final String KEY_ACCENT_COLOR accent_color private static final String KEY_PRIMARY_TEXT_COLOR primary_text private static final String KEY_SECONDARY_TEXT_COLOR secondary_text private static final String KEY_PRIMARY_TEXT_INVERSE_COLOR primary_text_inverse private static final String KEY_SECONDARY_TEXT_INVERSE_COLOR secondary_text_inverse private static final String KEY_WINDOW_BG_COLOR window_bg_color private static final String KEY_STATUS_BAR_COLOR status_bar_color_ s private static final String KEY_NAV_BAR_COLOR nav_bar_color_ S private static final String KEY_LIGHT_STATUS_MODE light_status_mode private static final String KEY_TAB_LAYOUT_BG_MODE tab_layout_bg_mode private static final String KEY_TAB_LAYOUT_INDICATOR_MODE tab_layout_indicator_mode private static final String KEY_NAV_VIEW_MODE nav_view_mode private static final String KEY_BOTTOM_NAV_BG_MODE bottom_nav_bg_mode private static final String KEY_BOTTOM_NAV_ICONTEXT_MODE bottom_nav_icontext_mode private static final String KEY_CARD_VIEW_BG_COLOR card_view_bg_color private static final String KEY_ICON_TITLE_ACTIVE_COLOR icon_title_active_color private static final String KEY_ICON_TITLE_INACTIVE_COLOR icon_title_inactive_color private static final String KEY_SNACKBAR_TEXT snackbar_text_color private static final String KEY_SNACKBAR_ACTION_TEXT snackbar_action_text_color @SuppressLint StaticFieldLeak private static Aesthetic instance private final ArrayMap String List ViewObservablePair backgroundSubscriberViews private final ArrayMap String Integer lastActivityThemes private CompositeDisposable backgroundSubscriptions private CompositeDisposable subs private AppCompatActivity context private SharedPreferences prefs private SharedPreferences Editor editor private RxSharedPreferences rxPrefs private boolean isResumed @SuppressLint CommitPrefEdits private Aesthetic AppCompatActivity context this context context prefs context getApplicationContext getSharedPreferences PREFS_NAME Context MODE_PRIVATE editor prefs edit rxPrefs RxSharedPreferences create prefs backgroundSubscriberViews new ArrayMap 0 lastActivityThemes new ArrayMap 2 private static String key @Nullable AppCompatActivity activity String key if activity instanceof AestheticKeyProvider key AestheticKeyProvider activity key else key default if key null key default return key @NonNull public static Aesthetic attach @NonNull AppCompatActivity activity if instance null instance new Aesthetic activity instance isResumed false instance context activity LayoutInflater li activity getLayoutInflater Util setInflaterFactory li activity String activityThemeKey String format KEY_ACTIVITY_THEME key activity int latestActivityTheme instance prefs getInt activityThemeKey 0 instance lastActivityThemes put instance context getClass getName latestActivityTheme if latestActivityTheme 0 activity setTheme latestActivityTheme return instance private static int getLastActivityTheme @Nullable Context forContext if forContext null instance null return 0 Integer lastActivityTheme instance lastActivityThemes get forContext getClass getName if lastActivityTheme null return 0 return lastActivityTheme @NonNull @CheckResult public static Aesthetic get if instance null throw new IllegalStateException Not attached return instance public static void pause @NonNull AppCompatActivity activity if instance null return instance isResumed false if instance subs null instance subs clear if instance backgroundSubscriptions null instance backgroundSubscriptions clear if activity isFinishing instance backgroundSubscriberViews remove activity getClass getName if instance context null instance context getClass getName equals activity getClass getName instance context null public static void resume @NonNull AppCompatActivity activity if instance null return instance context activity instance isResumed true if instance subs null instance subs clear instance subs new CompositeDisposable subscribeBackgroundListeners instance subs add instance colorPrimary compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @io reactivex annotations NonNull Integer color Util setTaskDescriptionColor instance context color onErrorLogAndRethrow instance subs add instance activityTheme compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @io reactivex annotations NonNull Integer themeId if getLastActivityTheme instance context themeId return instance lastActivityThemes put instance context getClass getName themeId instance context recreate onErrorLogAndRethrow instance subs add Observable combineLatest instance colorStatusBar instance lightStatusBarMode new BiFunction Integer Integer Pair Integer Integer @Override public Pair Integer Integer apply Integer integer Integer integer2 return Pair create integer integer2 compose Rx Pair Integer Integer distinctToMainThread subscribe new Consumer Pair Integer Integer @Override public void accept @io reactivex annotations NonNull Pair Integer Integer result instance invalidateStatusBar onErrorLogAndRethrow instance subs add instance colorNavigationBar compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @io reactivex annotations NonNull Integer color setNavBarColorCompat instance context color onErrorLogAndRethrow instance subs add instance colorWindowBackground compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @io reactivex annotations NonNull Integer color instance context getWindow setBackgroundDrawable new ColorDrawable color onErrorLogAndRethrow public static boolean isFirstTime boolean firstTime instance prefs getBoolean KEY_FIRST_TIME true instance editor putBoolean KEY_FIRST_TIME false commit return firstTime private static void subscribeBackgroundListeners if instance backgroundSubscriptions null instance backgroundSubscriptions clear instance backgroundSubscriptions new CompositeDisposable if instance backgroundSubscriberViews size 0 List ViewObservablePair pairs instance backgroundSubscriberViews get instance context getClass getName if pairs null for ViewObservablePair pair pairs instance backgroundSubscriptions add pair observable compose Rx Integer distinctToMainThread subscribeWith ViewBackgroundSubscriber create pair view void addBackgroundSubscriber @NonNull View view @NonNull Observable Integer colorObservable List ViewObservablePair subscribers backgroundSubscriberViews get instance context getClass getName if subscribers null subscribers new ArrayList 1 backgroundSubscriberViews put instance context getClass getName subscribers subscribers add ViewObservablePair create view colorObservable if isResumed instance backgroundSubscriptions add colorObservable compose Rx Integer distinctToMainThread subscribeWith ViewBackgroundSubscriber create view private void invalidateStatusBar String key String format KEY_STATUS_BAR_COLOR key context final int color prefs getInt key resolveColor context R attr colorPrimaryDark ViewGroup rootView Util getRootView context if rootView instanceof DrawerLayout setLightStatusBarCompat context false Util setStatusBarColorCompat context ContextCompat getColor context android R color transparent DrawerLayout rootView setStatusBarBackgroundColor color else Util setStatusBarColorCompat context color final int mode prefs getInt KEY_LIGHT_STATUS_MODE AutoSwitchMode AUTO switch mode case AutoSwitchMode OFF setLightStatusBarCompat context false break case AutoSwitchMode ON setLightStatusBarCompat context true break default setLightStatusBarCompat context isColorLight color break @CheckResult public Aesthetic activityTheme @StyleRes int theme String key String format KEY_ACTIVITY_THEME key context editor putInt key theme return this @CheckResult public Observable Integer activityTheme String key String format KEY_ACTIVITY_THEME key context return rxPrefs getInteger key 0 asObservable filter new Predicate Integer @Override public boolean test @io reactivex annotations NonNull Integer next throws Exception return next 0 next getLastActivityTheme instance context @CheckResult public Aesthetic isDark boolean isDark editor putBoolean KEY_IS_DARK isDark commit return this @CheckResult public Observable Boolean isDark return rxPrefs getBoolean KEY_IS_DARK false asObservable @CheckResult public Aesthetic colorPrimary @ColorInt int color editor putInt KEY_PRIMARY_COLOR color commit return this @CheckResult public Aesthetic colorPrimaryRes @ColorRes int color return colorPrimary ContextCompat getColor context color @CheckResult public Observable Integer colorPrimary return rxPrefs getInteger KEY_PRIMARY_COLOR resolveColor context R attr colorPrimary asObservable @CheckResult public Aesthetic colorPrimaryDark @ColorInt int color editor putInt KEY_PRIMARY_DARK_COLOR color commit return this @CheckResult public Aesthetic colorPrimaryDarkRes @ColorRes int color return colorPrimaryDark ContextCompat getColor context color @CheckResult public Observable Integer colorPrimaryDark return rxPrefs getInteger KEY_PRIMARY_DARK_COLOR resolveColor context R attr colorPrimaryDark asObservable @CheckResult public Aesthetic colorAccent @ColorInt int color editor putInt KEY_ACCENT_COLOR color commit return this @CheckResult public Aesthetic colorAccentRes @ColorRes int color return colorAccent ContextCompat getColor context color @CheckResult public Observable Integer colorAccent return rxPrefs getInteger KEY_ACCENT_COLOR resolveColor context R attr colorAccent asObservable @CheckResult public Aesthetic textColorPrimary @ColorInt int color editor putInt KEY_PRIMARY_TEXT_COLOR color return this @CheckResult public Aesthetic textColorPrimaryRes @ColorRes int color return textColorPrimary ContextCompat getColor context color @CheckResult public Observable Integer textColorPrimary return rxPrefs getInteger KEY_PRIMARY_TEXT_COLOR resolveColor context android R attr textColorPrimary asObservable @CheckResult public Aesthetic textColorSecondary @ColorInt int color editor putInt KEY_SECONDARY_TEXT_COLOR color return this @CheckResult public Aesthetic textColorSecondaryRes @ColorRes int color return textColorSecondary ContextCompat getColor context color @CheckResult public Observable Integer textColorSecondary return rxPrefs getInteger KEY_SECONDARY_TEXT_COLOR resolveColor context android R attr textColorSecondary asObservable @CheckResult public Aesthetic textColorPrimaryInverse @ColorInt int color editor putInt KEY_PRIMARY_TEXT_INVERSE_COLOR color return this @CheckResult public Aesthetic textColorPrimaryInverseRes @ColorRes int color return textColorPrimaryInverse ContextCompat getColor context color @CheckResult public Observable Integer textColorPrimaryInverse return rxPrefs getInteger KEY_PRIMARY_TEXT_INVERSE_COLOR resolveColor context android R attr textColorPrimaryInverse asObservable @CheckResult public Aesthetic textColorSecondaryInverse @ColorInt int color editor putInt KEY_SECONDARY_TEXT_INVERSE_COLOR color return this @CheckResult public Aesthetic textColorSecondaryInverseRes @ColorRes int color return textColorSecondaryInverse ContextCompat getColor context color @CheckResult public Observable Integer textColorSecondaryInverse return rxPrefs getInteger KEY_SECONDARY_TEXT_INVERSE_COLOR resolveColor context android R attr textColorSecondaryInverse asObservable @CheckResult public Aesthetic colorWindowBackground @ColorInt int color editor putInt KEY_WINDOW_BG_COLOR color commit return this @CheckResult public Aesthetic colorWindowBackgroundRes @ColorRes int color return colorWindowBackground ContextCompat getColor context color @CheckResult public Observable Integer colorWindowBackground return rxPrefs getInteger KEY_WINDOW_BG_COLOR resolveColor context android R attr windowBackground asObservable @CheckResult public Aesthetic colorStatusBar @ColorInt int color String key String format KEY_STATUS_BAR_COLOR key context editor putInt key color return this @CheckResult public Aesthetic colorStatusBarRes @ColorRes int color return colorStatusBar ContextCompat getColor context color @CheckResult public Aesthetic colorStatusBarAuto String key String format KEY_STATUS_BAR_COLOR key context editor putInt key Util darkenColor prefs getInt KEY_PRIMARY_COLOR resolveColor context R attr colorPrimary return this @CheckResult public Observable Integer colorStatusBar return colorPrimaryDark flatMap new Function Integer ObservableSource Integer @Override public ObservableSource Integer apply @io reactivex annotations NonNull Integer primaryDarkColor throws Exception String key String format KEY_STATUS_BAR_COLOR key context return rxPrefs getInteger key primaryDarkColor asObservable @CheckResult public Aesthetic colorNavigationBar @ColorInt int color String key String format KEY_NAV_BAR_COLOR key context editor putInt key color return this @CheckResult public Aesthetic colorNavigationBarRes @ColorRes int color return colorNavigationBar ContextCompat getColor context color @CheckResult public Aesthetic colorNavigationBarAuto int color prefs getInt KEY_PRIMARY_COLOR resolveColor context R attr colorPrimary String key String format KEY_NAV_BAR_COLOR key context editor putInt key isColorLight color Color BLACK color return this @CheckResult public Observable Integer colorNavigationBar String key String format KEY_NAV_BAR_COLOR key context return rxPrefs getInteger key Color BLACK asObservable @CheckResult public Aesthetic lightStatusBarMode @AutoSwitchMode int mode editor putInt KEY_LIGHT_STATUS_MODE mode return this @CheckResult public Observable Integer lightStatusBarMode return rxPrefs getInteger KEY_LIGHT_STATUS_MODE AutoSwitchMode AUTO asObservable @CheckResult public Aesthetic tabLayoutIndicatorMode @TabLayoutIndicatorMode int mode editor putInt KEY_TAB_LAYOUT_INDICATOR_MODE mode commit return this @CheckResult public Observable Integer tabLayoutIndicatorMode return rxPrefs getInteger KEY_TAB_LAYOUT_INDICATOR_MODE TabLayoutIndicatorMode ACCENT asObservable @CheckResult public Aesthetic tabLayoutBackgroundMode @TabLayoutBgMode int mode editor putInt KEY_TAB_LAYOUT_BG_MODE mode commit return this @CheckResult public Observable Integer tabLayoutBackgroundMode return rxPrefs getInteger KEY_TAB_LAYOUT_BG_MODE TabLayoutBgMode PRIMARY asObservable @CheckResult public Aesthetic navigationViewMode @NavigationViewMode int mode editor putInt KEY_NAV_VIEW_MODE mode commit return this @CheckResult public Observable Integer navigationViewMode return rxPrefs getInteger KEY_NAV_VIEW_MODE NavigationViewMode SELECTED_PRIMARY asObservable @CheckResult public Aesthetic bottomNavigationBackgroundMode @BottomNavBgMode int mode editor putInt KEY_BOTTOM_NAV_BG_MODE mode commit return this @CheckResult public Observable Integer bottomNavigationBackgroundMode return rxPrefs getInteger KEY_BOTTOM_NAV_BG_MODE BottomNavBgMode BLACK_WHITE_AUTO asObservable @CheckResult public Aesthetic bottomNavigationIconTextMode @BottomNavIconTextMode int mode editor putInt KEY_BOTTOM_NAV_ICONTEXT_MODE mode commit return this @CheckResult public Observable Integer bottomNavigationIconTextMode return rxPrefs getInteger KEY_BOTTOM_NAV_ICONTEXT_MODE BottomNavIconTextMode SELECTED_ACCENT asObservable @CheckResult public Observable Integer colorCardViewBackground return isDark flatMap new Function Boolean ObservableSource Integer @Override public ObservableSource Integer apply @io reactivex annotations NonNull Boolean isDark throws Exception return rxPrefs getInteger KEY_CARD_VIEW_BG_COLOR ContextCompat getColor context isDark R color ate_cardview_bg_dark R color ate_cardview_bg_light asObservable @CheckResult public Aesthetic colorCardViewBackground @ColorInt int color editor putInt KEY_CARD_VIEW_BG_COLOR color return this @CheckResult public Aesthetic colorCardViewBackgroundRes @ColorRes int color return colorCardViewBackground ContextCompat getColor context color @CheckResult public Observable ActiveInactiveColors colorIconTitle @Nullable Observable Integer backgroundObservable if backgroundObservable null backgroundObservable Aesthetic get colorPrimary return backgroundObservable flatMap new Function Integer ObservableSource ActiveInactiveColors @Override public ObservableSource ActiveInactiveColors apply @io reactivex annotations NonNull Integer primaryColor throws Exception final boolean isDark isColorLight primaryColor return Observable zip rxPrefs getInteger KEY_ICON_TITLE_ACTIVE_COLOR ContextCompat getColor context isDark R color ate_icon_dark R color ate_icon_light asObservable rxPrefs getInteger KEY_ICON_TITLE_INACTIVE_COLOR ContextCompat getColor context isDark R color ate_icon_dark_inactive R color ate_icon_light_inactive asObservable new BiFunction Integer Integer ActiveInactiveColors @Override public ActiveInactiveColors apply @io reactivex annotations NonNull Integer integer @io reactivex annotations NonNull Integer integer2 throws Exception return ActiveInactiveColors create integer integer2 @CheckResult public Aesthetic colorIconTitleActive @ColorInt int color editor putInt KEY_ICON_TITLE_ACTIVE_COLOR color return this @CheckResult public Aesthetic colorIconTitleActiveRes @ColorRes int color return colorIconTitleActive ContextCompat getColor context color @CheckResult public Aesthetic colorIconTitleInactive @ColorInt int color editor putInt KEY_ICON_TITLE_INACTIVE_COLOR color return this @CheckResult public Aesthetic colorIconTitleInactiveRes @ColorRes int color return colorIconTitleActive ContextCompat getColor context color @CheckResult public Observable Integer snackbarTextColor return isDark flatMap new Function Boolean ObservableSource Integer @Override public ObservableSource Integer apply @io reactivex annotations NonNull Boolean isDark throws Exception return isDark textColorPrimary textColorPrimaryInverse flatMap new Function Integer ObservableSource Integer @Override public ObservableSource Integer apply @io reactivex annotations NonNull Integer defaultTextColor throws Exception return rxPrefs getInteger KEY_SNACKBAR_TEXT defaultTextColor asObservable @CheckResult public Aesthetic snackbarTextColor @ColorInt int color editor putInt KEY_SNACKBAR_TEXT color return this @CheckResult public Aesthetic snackbarTextColorRes @ColorRes int color return colorCardViewBackground ContextCompat getColor context color @CheckResult public Observable Integer snackbarActionTextColor return colorAccent flatMap new Function Integer ObservableSource Integer @Override public ObservableSource Integer apply @io reactivex annotations NonNull Integer accentColor throws Exception return rxPrefs getInteger KEY_SNACKBAR_ACTION_TEXT accentColor asObservable @CheckResult public Aesthetic snackbarActionTextColor @ColorInt int color editor putInt KEY_SNACKBAR_ACTION_TEXT color return this @CheckResult public Aesthetic snackbarActionTextColorRes @ColorRes int color return colorCardViewBackground ContextCompat getColor context color public void apply editor @@@ 1 2
package com afollestad aesthetic import android content Context import android content res ColorStateList import android graphics drawable Drawable import android support v7 view menu ActionMenuItemView import android util AttributeSet import io reactivex android schedulers AndroidSchedulers import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic TintHelper createTintedDrawable @SuppressWarnings RestrictedApi final class AestheticActionMenuItemView extends ActionMenuItemView private Drawable icon private Disposable subscription public AestheticActionMenuItemView Context context super context public AestheticActionMenuItemView Context context AttributeSet attrs super context attrs public AestheticActionMenuItemView Context context AttributeSet attrs int defStyle super context attrs defStyle @Override public void setIcon final Drawable icon super setIcon icon Aesthetic get colorIconTitle null observeOn AndroidSchedulers mainThread take 1 subscribe new Consumer ActiveInactiveColors @Override public void accept @NonNull ActiveInactiveColors colors setIcon icon colors toEnabledSl onErrorLogAndRethrow public void setIcon final Drawable icon ColorStateList colors this icon icon super setIcon createTintedDrawable icon colors @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorIconTitle null compose Rx ActiveInactiveColors distinctToMainThread subscribe new Consumer ActiveInactiveColors @Override public void accept @NonNull ActiveInactiveColors colors if icon null setIcon icon colors toEnabledSl onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 3
package com afollestad aesthetic import android os Bundle import android support annotation Nullable import android support v7 app AppCompatActivity public class AestheticActivity extends AppCompatActivity implements AestheticKeyProvider @Override protected void onCreate @Nullable Bundle savedInstanceState Aesthetic attach this super onCreate savedInstanceState @Override protected void onResume super onResume Aesthetic resume this @Override protected void onPause Aesthetic pause this super onPause @Nullable @Override public String key return @@@ 1 4
package com afollestad aesthetic import android content Context import android content res ColorStateList import android graphics Color import android support annotation ColorInt import android support design widget BottomNavigationView import android support v4 content ContextCompat import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables CompositeDisposable import io reactivex disposables Disposable import io reactivex functions Consumer import io reactivex functions Function3 import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticBottomNavigationView extends BottomNavigationView private Disposable modesSubscription private CompositeDisposable colorSubscriptions private int lastTextIconColor public AestheticBottomNavigationView Context context super context public AestheticBottomNavigationView Context context AttributeSet attrs super context attrs public AestheticBottomNavigationView Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void invalidateIconTextColor int backgroundColor int selectedColor int baseColor ContextCompat getColor getContext Util isColorLight backgroundColor R color ate_icon_light R color ate_icon_dark int unselectedIconTextColor Util adjustAlpha baseColor 87f ColorStateList iconColor new ColorStateList new int new int android R attr state_checked new int android R attr state_checked new int unselectedIconTextColor selectedColor ColorStateList textColor new ColorStateList new int new int android R attr state_checked new int android R attr state_checked new int unselectedIconTextColor selectedColor setItemIconTintList iconColor setItemTextColor textColor @Override public void setBackgroundColor @ColorInt int color super setBackgroundColor color if lastTextIconColor Color TRANSPARENT lastTextIconColor Util isColorLight color Color BLACK Color WHITE invalidateIconTextColor color lastTextIconColor private void onState State state if colorSubscriptions null colorSubscriptions clear colorSubscriptions new CompositeDisposable switch state iconTextMode case BottomNavIconTextMode SELECTED_PRIMARY colorSubscriptions add Aesthetic get colorPrimary compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color lastTextIconColor color onErrorLogAndRethrow break case BottomNavIconTextMode SELECTED_ACCENT colorSubscriptions add Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color lastTextIconColor color onErrorLogAndRethrow break case BottomNavIconTextMode BLACK_WHITE_AUTO lastTextIconColor Color TRANSPARENT break default throw new IllegalStateException Unknown bottom nav icon text mode state iconTextMode switch state bgMode case BottomNavBgMode PRIMARY colorSubscriptions add Aesthetic get colorPrimary compose Rx Integer distinctToMainThread subscribe ViewBackgroundAction create this onErrorLogAndRethrow break case BottomNavBgMode PRIMARY_DARK colorSubscriptions add Aesthetic get colorStatusBar compose Rx Integer distinctToMainThread subscribe ViewBackgroundAction create this onErrorLogAndRethrow break case BottomNavBgMode ACCENT colorSubscriptions add Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe ViewBackgroundAction create this onErrorLogAndRethrow break case BottomNavBgMode BLACK_WHITE_AUTO setBackgroundColor ContextCompat getColor getContext state isDark R color ate_bottom_nav_default_dark_bg R color ate_bottom_nav_default_light_bg break default throw new IllegalStateException Unknown bottom nav bg mode state bgMode @Override protected void onAttachedToWindow super onAttachedToWindow modesSubscription Observable combineLatest Aesthetic get bottomNavigationBackgroundMode Aesthetic get bottomNavigationIconTextMode Aesthetic get isDark State creator compose Rx State distinctToMainThread subscribe new Consumer State @Override public void accept @android support annotation NonNull State state onState state onErrorLogAndRethrow @Override protected void onDetachedFromWindow modesSubscription dispose colorSubscriptions clear super onDetachedFromWindow private static class State @BottomNavBgMode private final int bgMode @BottomNavIconTextMode private final int iconTextMode private final boolean isDark private State int bgMode int iconTextMode boolean isDark this bgMode bgMode this iconTextMode iconTextMode this isDark isDark static State create @BottomNavBgMode int bgMode @BottomNavIconTextMode int iconTextMode boolean isDark return new State bgMode iconTextMode isDark static Function3 Integer Integer Boolean State creator return new Function3 Integer Integer Boolean State @Override public State apply Integer integer Integer integer2 Boolean aBoolean return State create integer integer2 @@@ 1 5
package com afollestad aesthetic import android content Context import android content res ColorStateList import android graphics Color import android support v7 widget AppCompatButton import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticButton extends AppCompatButton private Disposable subscription private int backgroundResId public AestheticButton Context context super context public AestheticButton Context context AttributeSet attrs super context attrs init context attrs public AestheticButton Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state TintHelper setTintAuto this state color true state isDark ColorStateList textColorSl new ColorStateList new int new int android R attr state_enabled new int android R attr state_enabled new int Util isColorLight state color Color BLACK Color WHITE state isDark Color WHITE Color BLACK setTextColor textColorSl @Override protected void onAttachedToWindow super onAttachedToWindow subscription Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 6
package com afollestad aesthetic import android content Context import android support annotation Nullable import android support v7 widget CardView import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticCardView extends CardView private Disposable bgSubscription private int backgroundResId public AestheticCardView Context context super context public AestheticCardView Context context @Nullable AttributeSet attrs super context attrs init context attrs public AestheticCardView Context context @Nullable AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs R attr cardBackgroundColor @Override protected void onAttachedToWindow super onAttachedToWindow Observable Integer obs ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorCardViewBackground bgSubscription obs compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer bgColor throws Exception setCardBackgroundColor bgColor onErrorLogAndRethrow @Override protected void onDetachedFromWindow if bgSubscription null bgSubscription dispose super @@@ 1 7
package com afollestad aesthetic import android content Context import android support v7 widget AppCompatCheckBox import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables CompositeDisposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticCheckBox extends AppCompatCheckBox private CompositeDisposable subscriptions private int backgroundResId public AestheticCheckBox Context context super context public AestheticCheckBox Context context AttributeSet attrs super context attrs init context attrs public AestheticCheckBox Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state TintHelper setTint this state color state isDark @Override protected void onAttachedToWindow super onAttachedToWindow subscriptions new CompositeDisposable subscriptions add Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow subscriptions add Aesthetic get textColorPrimary compose Rx Integer distinctToMainThread subscribe ViewTextColorAction create this @Override protected void onDetachedFromWindow subscriptions clear super @@@ 1 8
package com afollestad aesthetic import android content Context import android graphics Color import android graphics PorterDuff import android graphics PorterDuffColorFilter import android graphics drawable ColorDrawable import android graphics drawable Drawable import android support annotation NonNull import android support annotation Nullable import android support design widget AppBarLayout import android support design widget CollapsingToolbarLayout import android support design widget CoordinatorLayout import android support v4 util Pair import android support v7 view menu ActionMenuItemView import android support v7 widget ActionMenuView import android support v7 widget Toolbar import android util AttributeSet import android view Menu import android view View import java lang reflect Field import io reactivex Observable import io reactivex disposables Disposable import io reactivex functions BiFunction import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticCoordinatorLayout extends CoordinatorLayout implements AppBarLayout OnOffsetChangedListener private Disposable toolbarColorSubscription private Disposable statusBarColorSubscription private AppBarLayout appBarLayout private View colorView private AestheticToolbar toolbar private CollapsingToolbarLayout collapsingToolbarLayout private int toolbarColor private ActiveInactiveColors iconTextColors private int lastOffset 1 public AestheticCoordinatorLayout Context context super context public AestheticCoordinatorLayout Context context AttributeSet attrs super context attrs public AestheticCoordinatorLayout Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr @SuppressWarnings unchecked private static void tintMenu @NonNull AestheticToolbar toolbar @Nullable Menu menu final ActiveInactiveColors colors if toolbar getNavigationIcon null toolbar setNavigationIcon toolbar getNavigationIcon colors activeColor Util setOverflowButtonColor toolbar colors activeColor try final Field field Toolbar class getDeclaredField mCollapseIcon field setAccessible true Drawable collapseIcon Drawable field get toolbar if collapseIcon null field set toolbar TintHelper createTintedDrawable collapseIcon colors toEnabledSl catch Exception e e printStackTrace final PorterDuffColorFilter colorFilter new PorterDuffColorFilter colors activeColor PorterDuff Mode SRC_IN for int i 0 i toolbar getChildCount i final View v toolbar getChildAt i if v instanceof ActionMenuView for int j 0 j ActionMenuView v getChildCount j final View innerView ActionMenuView v getChildAt j if innerView instanceof ActionMenuItemView int drawablesCount ActionMenuItemView innerView getCompoundDrawables length for int k 0 k drawablesCount k if ActionMenuItemView innerView getCompoundDrawables k null ActionMenuItemView innerView getCompoundDrawables k setColorFilter colorFilter if menu null menu toolbar getMenu ViewUtil tintToolbarMenu toolbar menu colors @Override public void onAttachedToWindow super onAttachedToWindow if getChildCount 0 getChildAt 0 instanceof AppBarLayout appBarLayout AppBarLayout getChildAt 0 if appBarLayout getChildCount 0 appBarLayout getChildAt 0 instanceof CollapsingToolbarLayout collapsingToolbarLayout CollapsingToolbarLayout appBarLayout getChildAt 0 for int i 0 i collapsingToolbarLayout getChildCount i if this toolbar null this colorView null break View child collapsingToolbarLayout getChildAt i if child instanceof AestheticToolbar this toolbar AestheticToolbar child else if child getBackground null child getBackground instanceof ColorDrawable this colorView child if toolbar null colorView null this appBarLayout addOnOffsetChangedListener this toolbarColorSubscription Observable combineLatest toolbar colorUpdated Aesthetic get colorIconTitle toolbar colorUpdated new BiFunction Integer ActiveInactiveColors Pair Integer ActiveInactiveColors @Override public Pair Integer ActiveInactiveColors apply Integer integer ActiveInactiveColors activeInactiveColors return Pair create integer activeInactiveColors compose Rx Pair Integer ActiveInactiveColors distinctToMainThread subscribe new Consumer Pair Integer ActiveInactiveColors @Override public void accept @NonNull Pair Integer ActiveInactiveColors result toolbarColor result first iconTextColors result second invalidateColors onErrorLogAndRethrow if collapsingToolbarLayout null statusBarColorSubscription Aesthetic get colorStatusBar compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @io reactivex annotations NonNull Integer color collapsingToolbarLayout setContentScrimColor color collapsingToolbarLayout setStatusBarScrimColor color onErrorLogAndRethrow @Override public void onDetachedFromWindow if toolbarColorSubscription null toolbarColorSubscription dispose if statusBarColorSubscription null statusBarColorSubscription dispose if this appBarLayout null this appBarLayout removeOnOffsetChangedListener this this appBarLayout null this toolbar null this colorView null super onDetachedFromWindow @Override public void onOffsetChanged AppBarLayout appBarLayout int verticalOffset if lastOffset Math abs verticalOffset return lastOffset Math abs verticalOffset invalidateColors private void invalidateColors if iconTextColors null return final int maxOffset appBarLayout getMeasuredHeight toolbar getMeasuredHeight final float ratio float lastOffset float maxOffset final int colorViewColor ColorDrawable colorView getBackground getColor final int blendedColor Util blendColors colorViewColor toolbarColor ratio final int collapsedTitleColor iconTextColors activeColor final int expandedTitleColor Util isColorLight colorViewColor Color BLACK Color WHITE final int blendedTitleColor Util blendColors expandedTitleColor collapsedTitleColor ratio toolbar setBackgroundColor blendedColor collapsingToolbarLayout setCollapsedTitleTextColor collapsedTitleColor collapsingToolbarLayout setExpandedTitleColor expandedTitleColor tintMenu toolbar toolbar getMenu ActiveInactiveColors create blendedTitleColor Util adjustAlpha blendedColor 0 @@@ 1 9
package com afollestad aesthetic import android content Context import android support v7 widget AppCompatButton import android util AttributeSet import io reactivex disposables Disposable final class AestheticDialogButton extends AppCompatButton private Disposable subscription public AestheticDialogButton Context context super context public AestheticDialogButton Context context AttributeSet attrs super context attrs public AestheticDialogButton Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe ViewTextColorAction create this @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 10
package com afollestad aesthetic import android content Context import android support annotation NonNull import android support v4 widget DrawerLayout import android support v7 app ActionBarDrawerToggle import android support v7 graphics drawable DrawerArrowDrawable import android util AttributeSet import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticDrawerLayout extends DrawerLayout private ActiveInactiveColors lastState private DrawerArrowDrawable arrowDrawable private Disposable subscription public AestheticDrawerLayout Context context super context public AestheticDrawerLayout Context context AttributeSet attrs super context attrs public AestheticDrawerLayout Context context AttributeSet attrs int defStyle super context attrs defStyle private void invalidateColor ActiveInactiveColors colors if colors null return this lastState colors if this arrowDrawable null this arrowDrawable setColor lastState activeColor @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorIconTitle null compose Rx ActiveInactiveColors distinctToMainThread subscribe new Consumer ActiveInactiveColors @Override public void accept @io reactivex annotations NonNull ActiveInactiveColors colors invalidateColor colors onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super onDetachedFromWindow @Override public void addDrawerListener @NonNull DrawerListener listener super addDrawerListener listener if listener instanceof ActionBarDrawerToggle this arrowDrawable ActionBarDrawerToggle listener getDrawerArrowDrawable invalidateColor lastState @SuppressWarnings deprecation @Override public void setDrawerListener DrawerListener listener super setDrawerListener listener if listener instanceof ActionBarDrawerToggle this arrowDrawable ActionBarDrawerToggle listener getDrawerArrowDrawable invalidateColor @@@ 1 11
package com afollestad aesthetic import android content Context import android content res TypedArray import android support v7 widget AppCompatEditText import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables CompositeDisposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticEditText extends AppCompatEditText private CompositeDisposable subscriptions private int backgroundResId private int textColorResId private int textColorHintResId public AestheticEditText Context context super context public AestheticEditText Context context AttributeSet attrs super context attrs init context attrs public AestheticEditText Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null int attrsArray new int android R attr background android R attr textColor android R attr textColorHint TypedArray ta context obtainStyledAttributes attrs attrsArray backgroundResId ta getResourceId 0 0 textColorResId ta getResourceId 1 0 textColorHintResId ta getResourceId 2 0 ta recycle private void invalidateColors ColorIsDarkState state TintHelper setTintAuto this state color true state isDark TintHelper setCursorTint this state color @SuppressWarnings ConstantConditions @Override protected void onAttachedToWindow super onAttachedToWindow subscriptions new CompositeDisposable subscriptions add Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow subscriptions add ViewUtil getObservableForResId getContext textColorResId Aesthetic get textColorPrimary compose Rx Integer distinctToMainThread subscribe ViewTextColorAction create this onErrorLogAndRethrow subscriptions add ViewUtil getObservableForResId getContext textColorHintResId Aesthetic get textColorSecondary compose Rx Integer distinctToMainThread subscribe ViewHintTextColorAction create this onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscriptions clear super @@@ 1 12
package com afollestad aesthetic import android content Context import android graphics Color import android graphics drawable Drawable import android support annotation Nullable import android support design widget FloatingActionButton import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticFab extends FloatingActionButton private Disposable subscription private int backgroundResId private int iconColor public AestheticFab Context context super context public AestheticFab Context context AttributeSet attrs super context attrs init context attrs public AestheticFab Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state TintHelper setTintAuto this state color true state isDark iconColor Util isColorLight state color Color BLACK Color WHITE setImageDrawable getDrawable @Override public void setImageDrawable @Nullable Drawable drawable super setImageDrawable TintHelper createTintedDrawable drawable iconColor @Override protected void onAttachedToWindow super onAttachedToWindow subscription Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 13
package com afollestad aesthetic import android content Context import android support annotation Nullable import android support v7 widget AppCompatImageButton import android util AttributeSet import io reactivex Observable import io reactivex disposables Disposable import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticImageButton extends AppCompatImageButton private Disposable bgSubscription private int backgroundResId public AestheticImageButton Context context super context public AestheticImageButton Context context @Nullable AttributeSet attrs super context attrs init context attrs public AestheticImageButton Context context @Nullable AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background @Override protected void onAttachedToWindow super onAttachedToWindow Observable Integer obs ViewUtil getObservableForResId getContext backgroundResId null if obs null bgSubscription obs compose Rx Integer distinctToMainThread subscribe ViewBackgroundAction create this onErrorLogAndRethrow @Override protected void onDetachedFromWindow if bgSubscription null bgSubscription dispose super @@@ 1 14
package com afollestad aesthetic import android content Context import android support annotation Nullable import android support v7 widget AppCompatImageView import android util AttributeSet import io reactivex Observable import io reactivex disposables Disposable import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticImageView extends AppCompatImageView private Disposable bgSubscription private int backgroundResId public AestheticImageView Context context super context public AestheticImageView Context context @Nullable AttributeSet attrs super context attrs init context attrs public AestheticImageView Context context @Nullable AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background @Override protected void onAttachedToWindow super onAttachedToWindow Observable Integer obs ViewUtil getObservableForResId getContext backgroundResId null if obs null bgSubscription obs compose Rx Integer distinctToMainThread subscribe ViewBackgroundAction create this onErrorLogAndRethrow @Override protected void onDetachedFromWindow if bgSubscription null bgSubscription dispose super @@@ 1 15
package com afollestad aesthetic import android support annotation Nullable @SuppressWarnings WeakerAccess public interface AestheticKeyProvider @Nullable String @@@ 1 16
package com afollestad aesthetic import android content Context import android util AttributeSet import android widget ListView import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticListView extends ListView private Disposable subscription public AestheticListView Context context super context public AestheticListView Context context AttributeSet attrs super context attrs public AestheticListView Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void invalidateColors int color EdgeGlowUtil setEdgeGlowColor this color @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color invalidateColors color onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 17
package com afollestad aesthetic import android content Context import android content res ColorStateList import android graphics Color import android graphics drawable ColorDrawable import android graphics drawable StateListDrawable import android support design widget NavigationView import android support v4 content ContextCompat import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow @SuppressWarnings RestrictedApi public class AestheticNavigationView extends NavigationView private Disposable modeSubscription private Disposable colorSubscription public AestheticNavigationView Context context super context public AestheticNavigationView Context context AttributeSet attrs super context attrs public AestheticNavigationView Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void invalidateColors ColorIsDarkState state int selectedColor state color boolean isDark state isDark int baseColor isDark Color WHITE Color BLACK int unselectedIconColor Util adjustAlpha baseColor 54f int unselectedTextColor Util adjustAlpha baseColor 87f int selectedItemBgColor ContextCompat getColor getContext isDark R color ate_navigation_drawer_selected_dark R color ate_navigation_drawer_selected_light final ColorStateList iconSl new ColorStateList new int new int android R attr state_checked new int android R attr state_checked new int unselectedIconColor selectedColor final ColorStateList textSl new ColorStateList new int new int android R attr state_checked new int android R attr state_checked new int unselectedTextColor selectedColor setItemTextColor textSl setItemIconTintList iconSl StateListDrawable bgDrawable new StateListDrawable bgDrawable addState new int android R attr state_checked new ColorDrawable selectedItemBgColor setItemBackground bgDrawable @Override protected void onAttachedToWindow super onAttachedToWindow modeSubscription Aesthetic get navigationViewMode compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer mode switch mode case NavigationViewMode SELECTED_PRIMARY colorSubscription Observable combineLatest Aesthetic get colorPrimary Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow break case NavigationViewMode SELECTED_ACCENT colorSubscription Observable combineLatest Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow break default throw new IllegalStateException Unknown nav view mode mode onErrorLogAndRethrow @Override protected void onDetachedFromWindow if modeSubscription null modeSubscription dispose if colorSubscription null colorSubscription dispose super @@@ 1 18
package com afollestad aesthetic import android content Context import android support v4 widget NestedScrollView import android util AttributeSet import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticNestedScrollView extends NestedScrollView private Disposable subscription public AestheticNestedScrollView Context context super context public AestheticNestedScrollView Context context AttributeSet attrs super context attrs public AestheticNestedScrollView Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void invalidateColors int color EdgeGlowUtil setEdgeGlowColor this color @Override public void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color invalidateColors color onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 19
package com afollestad aesthetic import android content Context import android util AttributeSet import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import me zhanghai android materialprogressbar MaterialProgressBar import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticProgressBar extends MaterialProgressBar private Disposable subscription public AestheticProgressBar Context context super context public AestheticProgressBar Context context AttributeSet attrs super context attrs public AestheticProgressBar Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void invalidateColors int color TintHelper setTint this color @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color invalidateColors color onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 20
package com afollestad aesthetic import android content Context import android support v7 widget AppCompatRadioButton import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables CompositeDisposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticRadioButton extends AppCompatRadioButton private CompositeDisposable subscriptions private int backgroundResId public AestheticRadioButton Context context super context public AestheticRadioButton Context context AttributeSet attrs super context attrs init context attrs public AestheticRadioButton Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state TintHelper setTint this state color state isDark @Override protected void onAttachedToWindow super onAttachedToWindow subscriptions new CompositeDisposable subscriptions add Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow subscriptions add Aesthetic get textColorPrimary compose Rx Integer distinctToMainThread subscribe ViewTextColorAction create this @Override protected void onDetachedFromWindow subscriptions clear super @@@ 1 21
package com afollestad aesthetic import android content Context import android support v7 widget RecyclerView import android util AttributeSet import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticRecyclerView extends RecyclerView private Disposable subscription public AestheticRecyclerView Context context super context public AestheticRecyclerView Context context AttributeSet attrs super context attrs public AestheticRecyclerView Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void invalidateColors int color EdgeGlowUtil setEdgeGlowColor this color null @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color invalidateColors color onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 22
package com afollestad aesthetic import android content Context import android util AttributeSet import android widget ScrollView import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticScrollView extends ScrollView private Disposable subscription public AestheticScrollView Context context super context public AestheticScrollView Context context AttributeSet attrs super context attrs public AestheticScrollView Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void invalidateColors int color EdgeGlowUtil setEdgeGlowColor this color @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color invalidateColors color onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 23
package com afollestad aesthetic import android content Context import android support v7 widget AppCompatSeekBar import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticSeekBar extends AppCompatSeekBar private Disposable subscription private int backgroundResId public AestheticSeekBar Context context super context public AestheticSeekBar Context context AttributeSet attrs super context attrs init context attrs public AestheticSeekBar Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state TintHelper setTint this state color state isDark @Override protected void onAttachedToWindow super onAttachedToWindow subscription Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 24
package com afollestad aesthetic import android content Context import android support v7 widget AppCompatButton import android util AttributeSet import io reactivex disposables Disposable final class AestheticSnackBarButton extends AppCompatButton private Disposable subscription public AestheticSnackBarButton Context context super context public AestheticSnackBarButton Context context AttributeSet attrs super context attrs public AestheticSnackBarButton Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get snackbarActionTextColor compose Rx Integer distinctToMainThread subscribe ViewTextColorAction create this @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 25
package com afollestad aesthetic import android content Context import android support v7 widget AppCompatTextView import android util AttributeSet import io reactivex disposables Disposable import static com afollestad aesthetic Rx onErrorLogAndRethrow final class AestheticSnackBarTextView extends AppCompatTextView private Disposable subscription public AestheticSnackBarTextView Context context super context public AestheticSnackBarTextView Context context AttributeSet attrs super context attrs public AestheticSnackBarTextView Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get snackbarTextColor compose Rx Integer distinctToMainThread subscribe ViewTextColorAction create this onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 26
package com afollestad aesthetic import android content Context import android support v7 widget AppCompatSpinner import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticSpinner extends AppCompatSpinner private Disposable subscription private int backgroundResId public AestheticSpinner Context context super context public AestheticSpinner Context context AttributeSet attrs super context attrs init context attrs public AestheticSpinner Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state TintHelper setTintAuto this state color true state isDark @Override protected void onAttachedToWindow super onAttachedToWindow subscription Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 27
package com afollestad aesthetic import android content Context import android util AttributeSet import android widget Switch import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticSwitch extends Switch private Disposable subscription private int backgroundResId public AestheticSwitch Context context super context public AestheticSwitch Context context AttributeSet attrs super context attrs init context attrs public AestheticSwitch Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state TintHelper setTint this state color state isDark @Override protected void onAttachedToWindow super onAttachedToWindow subscription Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState state invalidateColors state onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 28
package com afollestad aesthetic import android content Context import android support v7 widget SwitchCompat import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticSwitchCompat extends SwitchCompat private Disposable subscription private int backgroundResId public AestheticSwitchCompat Context context super context public AestheticSwitchCompat Context context AttributeSet attrs super context attrs init context attrs public AestheticSwitchCompat Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state TintHelper setTint this state color state isDark @Override protected void onAttachedToWindow super onAttachedToWindow subscription Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 29
package com afollestad aesthetic import android content Context import android content res ColorStateList import android support annotation ColorInt import android support design widget TabLayout import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic TintHelper createTintedDrawable import static com afollestad aesthetic Util adjustAlpha public class AestheticTabLayout extends TabLayout private static final float UNFOCUSED_ALPHA 0 5f private Disposable indicatorModeSubscription private Disposable bgModeSubscription private Disposable indicatorColorSubscription private Disposable bgColorSubscription public AestheticTabLayout Context context super context public AestheticTabLayout Context context AttributeSet attrs super context attrs public AestheticTabLayout Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void setIconsColor int color final ColorStateList sl new ColorStateList new int new int android R attr state_selected new int android R attr state_selected new int adjustAlpha color UNFOCUSED_ALPHA color for int i 0 i getTabCount i final TabLayout Tab tab getTabAt i if tab null tab getIcon null tab setIcon createTintedDrawable tab getIcon sl @Override public void setBackgroundColor @ColorInt int color super setBackgroundColor color Aesthetic get colorIconTitle Observable just color take 1 subscribe new Consumer ActiveInactiveColors @Override public void accept @NonNull ActiveInactiveColors activeInactiveColors setIconsColor activeInactiveColors activeColor setTabTextColors adjustAlpha activeInactiveColors inactiveColor UNFOCUSED_ALPHA activeInactiveColors activeColor @Override protected void onAttachedToWindow super onAttachedToWindow bgModeSubscription Aesthetic get tabLayoutBackgroundMode compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer mode if bgColorSubscription null bgColorSubscription dispose switch mode case TabLayoutIndicatorMode PRIMARY bgColorSubscription Aesthetic get colorPrimary compose Rx Integer distinctToMainThread subscribe ViewBackgroundAction create AestheticTabLayout this onErrorLogAndRethrow break case TabLayoutIndicatorMode ACCENT bgColorSubscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe ViewBackgroundAction create AestheticTabLayout this onErrorLogAndRethrow break default throw new IllegalStateException Unimplemented bg mode mode onErrorLogAndRethrow indicatorModeSubscription Aesthetic get tabLayoutIndicatorMode compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer mode if indicatorColorSubscription null indicatorColorSubscription dispose switch mode case TabLayoutIndicatorMode PRIMARY indicatorColorSubscription Aesthetic get colorPrimary compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color setSelectedTabIndicatorColor color onErrorLogAndRethrow break case TabLayoutIndicatorMode ACCENT indicatorColorSubscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color setSelectedTabIndicatorColor color onErrorLogAndRethrow break default throw new IllegalStateException Unimplemented bg mode mode onErrorLogAndRethrow @Override protected void onDetachedFromWindow if bgModeSubscription null bgModeSubscription dispose if indicatorModeSubscription null indicatorModeSubscription dispose if bgColorSubscription null bgColorSubscription dispose if indicatorColorSubscription null indicatorColorSubscription dispose super @@@ 1 30
package com afollestad aesthetic import android content Context import android support design widget TextInputEditText import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables CompositeDisposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticTextInputEditText extends TextInputEditText private CompositeDisposable subs private int backgroundResId private ColorIsDarkState lastState public AestheticTextInputEditText Context context super context public AestheticTextInputEditText Context context AttributeSet attrs super context attrs init context attrs public AestheticTextInputEditText Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors ColorIsDarkState state this lastState state TintHelper setTintAuto this state color true state isDark TintHelper setCursorTint this state color @Override protected void onAttachedToWindow super onAttachedToWindow subs new CompositeDisposable subs add Aesthetic get textColorPrimary compose Rx Integer distinctToMainThread subscribe ViewTextColorAction create this onErrorLogAndRethrow subs add Aesthetic get textColorSecondary compose Rx Integer distinctToMainThread subscribe ViewHintTextColorAction create this onErrorLogAndRethrow subs add Observable combineLatest ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent Aesthetic get isDark ColorIsDarkState creator compose Rx ColorIsDarkState distinctToMainThread subscribe new Consumer ColorIsDarkState @Override public void accept @NonNull ColorIsDarkState colorIsDarkState invalidateColors colorIsDarkState onErrorLogAndRethrow @Override protected void onDetachedFromWindow subs clear super onDetachedFromWindow @Override public void refreshDrawableState super refreshDrawableState if lastState null post new Runnable @Override public void run invalidateColors @@@ 1 31
package com afollestad aesthetic import android content Context import android support design widget TextInputLayout import android util AttributeSet import io reactivex annotations NonNull import io reactivex disposables CompositeDisposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util adjustAlpha import static com afollestad aesthetic Util resolveResId public class AestheticTextInputLayout extends TextInputLayout private CompositeDisposable subs private int backgroundResId public AestheticTextInputLayout Context context super context public AestheticTextInputLayout Context context AttributeSet attrs super context attrs init context attrs public AestheticTextInputLayout Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null backgroundResId resolveResId context attrs android R attr background private void invalidateColors int color TextInputLayoutUtil setAccent this color @SuppressWarnings ConstantConditions @Override protected void onAttachedToWindow super onAttachedToWindow subs new CompositeDisposable subs add Aesthetic get textColorSecondary compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color TextInputLayoutUtil setHint AestheticTextInputLayout this adjustAlpha color 0 7f onErrorLogAndRethrow subs add ViewUtil getObservableForResId getContext backgroundResId Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color invalidateColors color onErrorLogAndRethrow @Override protected void onDetachedFromWindow subs clear super @@@ 1 32
package com afollestad aesthetic import android content Context import android support v7 widget AppCompatTextView import android util AttributeSet import io reactivex Observable import io reactivex disposables Disposable import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic Util resolveResId public class AestheticTextView extends AppCompatTextView private Disposable subscription private int textColorResId public AestheticTextView Context context super context public AestheticTextView Context context AttributeSet attrs super context attrs init context attrs public AestheticTextView Context context AttributeSet attrs int defStyleAttr super context attrs defStyleAttr init context attrs private void init Context context AttributeSet attrs if attrs null textColorResId resolveResId context attrs android R attr textColor @Override protected void onAttachedToWindow super onAttachedToWindow Observable Integer obs ViewUtil getObservableForResId getContext textColorResId Aesthetic get textColorSecondary subscription obs compose Rx Integer distinctToMainThread subscribe ViewTextColorAction create this onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 33
package com afollestad aesthetic import android content Context import android graphics drawable Drawable import android support annotation ColorInt import android support annotation Nullable import android support v7 widget Toolbar import android util AttributeSet import io reactivex Observable import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import io reactivex subjects PublishSubject import static com afollestad aesthetic Rx onErrorLogAndRethrow import static com afollestad aesthetic TintHelper createTintedDrawable import static com afollestad aesthetic Util setOverflowButtonColor public class AestheticToolbar extends Toolbar private BgIconColorState lastState private Disposable subscription private PublishSubject Integer onColorUpdated public AestheticToolbar Context context super context public AestheticToolbar Context context @Nullable AttributeSet attrs super context attrs public AestheticToolbar Context context @Nullable AttributeSet attrs int defStyleAttr super context attrs defStyleAttr private void invalidateColors BgIconColorState state lastState state setBackgroundColor state bgColor setTitleTextColor state iconTitleColor activeColor setOverflowButtonColor this state iconTitleColor activeColor if getNavigationIcon null setNavigationIcon getNavigationIcon onColorUpdated onNext state bgColor ViewUtil tintToolbarMenu this getMenu state iconTitleColor public Observable Integer colorUpdated return onColorUpdated @Override public void setNavigationIcon @Nullable Drawable icon if lastState null super setNavigationIcon icon return super setNavigationIcon createTintedDrawable icon lastState iconTitleColor toEnabledSl public void setNavigationIcon @Nullable Drawable icon @ColorInt int color if lastState null super setNavigationIcon icon return super setNavigationIcon createTintedDrawable icon color @SuppressWarnings ConstantConditions @Override protected void onAttachedToWindow super onAttachedToWindow onColorUpdated PublishSubject create subscription Observable combineLatest Aesthetic get colorPrimary Aesthetic get colorIconTitle null BgIconColorState creator compose Rx BgIconColorState distinctToMainThread subscribe new Consumer BgIconColorState @Override public void accept @NonNull BgIconColorState bgIconColorState invalidateColors bgIconColorState onErrorLogAndRethrow @Override protected void onDetachedFromWindow lastState null onColorUpdated null subscription dispose super @@@ 1 34
package com afollestad aesthetic import android content Context import android support v4 view ViewPager import android util AttributeSet import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer import static com afollestad aesthetic Rx onErrorLogAndRethrow public class AestheticViewPager extends ViewPager private Disposable subscription public AestheticViewPager Context context super context public AestheticViewPager Context context AttributeSet attrs super context attrs private void invalidateColors int color EdgeGlowUtil setEdgeGlowColor this color @Override protected void onAttachedToWindow super onAttachedToWindow subscription Aesthetic get colorAccent compose Rx Integer distinctToMainThread subscribe new Consumer Integer @Override public void accept @NonNull Integer color invalidateColors color onErrorLogAndRethrow @Override protected void onDetachedFromWindow subscription dispose super @@@ 1 35
package com afollestad aesthetic import android support annotation IntDef import java lang annotation Retention import static com afollestad aesthetic AutoSwitchMode AUTO import static com afollestad aesthetic AutoSwitchMode OFF import static com afollestad aesthetic AutoSwitchMode ON import static java lang annotation RetentionPolicy SOURCE @SuppressWarnings WeakerAccess @Retention SOURCE @IntDef value OFF ON AUTO public @interface AutoSwitchMode int OFF 0 int ON 1 int AUTO @@@ 1 36
package com afollestad aesthetic import android support annotation ColorInt import android support annotation Nullable import android support annotation RestrictTo import io reactivex annotations NonNull import io reactivex functions BiFunction import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class BgIconColorState @ColorInt private final int bgColor private final ActiveInactiveColors iconTitleColor private BgIconColorState @ColorInt int bgColor ActiveInactiveColors iconTitleColor this bgColor bgColor this iconTitleColor iconTitleColor static BgIconColorState create @ColorInt int color ActiveInactiveColors iconTitleColors return new BgIconColorState color iconTitleColors static BiFunction Integer ActiveInactiveColors BgIconColorState creator return new BiFunction Integer ActiveInactiveColors BgIconColorState @Override public BgIconColorState apply @NonNull Integer integer ActiveInactiveColors activeInactiveColors return BgIconColorState create integer activeInactiveColors @ColorInt int bgColor return bgColor @Nullable ActiveInactiveColors iconTitleColor return @@@ 1 37
package com afollestad aesthetic import android support annotation IntDef import java lang annotation Retention import static com afollestad aesthetic BottomNavBgMode ACCENT import static com afollestad aesthetic BottomNavBgMode BLACK_WHITE_AUTO import static com afollestad aesthetic BottomNavBgMode PRIMARY import static com afollestad aesthetic BottomNavBgMode PRIMARY_DARK import static java lang annotation RetentionPolicy SOURCE @SuppressWarnings WeakerAccess @Retention SOURCE @IntDef value BLACK_WHITE_AUTO PRIMARY PRIMARY_DARK ACCENT public @interface BottomNavBgMode int BLACK_WHITE_AUTO 0 int PRIMARY 1 int PRIMARY_DARK 2 int ACCENT @@@ 1 38
package com afollestad aesthetic import android support annotation IntDef import java lang annotation Retention import static com afollestad aesthetic BottomNavIconTextMode BLACK_WHITE_AUTO import static com afollestad aesthetic BottomNavIconTextMode SELECTED_ACCENT import static com afollestad aesthetic BottomNavIconTextMode SELECTED_PRIMARY import static java lang annotation RetentionPolicy SOURCE @SuppressWarnings WeakerAccess @Retention SOURCE @IntDef value SELECTED_PRIMARY SELECTED_ACCENT BLACK_WHITE_AUTO public @interface BottomNavIconTextMode int SELECTED_PRIMARY 0 int SELECTED_ACCENT 1 int BLACK_WHITE_AUTO @@@ 1 39
package com afollestad aesthetic import android support annotation ColorInt import android support annotation RestrictTo import io reactivex functions BiFunction import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class ColorIsDarkState @ColorInt private final int color private final boolean isDark private ColorIsDarkState @ColorInt int color boolean isDark this color color this isDark isDark static ColorIsDarkState create @ColorInt int color boolean isDark return new ColorIsDarkState color isDark static BiFunction Integer Boolean ColorIsDarkState creator return new BiFunction Integer Boolean ColorIsDarkState @Override public ColorIsDarkState apply Integer integer Boolean aBoolean return ColorIsDarkState create integer aBoolean @ColorInt int color return color boolean isDark return @@@ 1 40
package com afollestad aesthetic import android annotation TargetApi import android graphics PorterDuff import android graphics drawable Drawable import android os Build import android support annotation ColorInt import android support annotation NonNull import android support annotation Nullable import android support annotation RestrictTo import android support v4 view ViewPager import android support v4 widget EdgeEffectCompat import android support v4 widget NestedScrollView import android support v7 widget RecyclerView import android widget AbsListView import android widget EdgeEffect import android widget ScrollView import java lang reflect Field import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class EdgeGlowUtil private static Field EDGE_GLOW_FIELD_EDGE private static Field EDGE_GLOW_FIELD_GLOW private static Field EDGE_EFFECT_COMPAT_FIELD_EDGE_EFFECT private static Field SCROLL_VIEW_FIELD_EDGE_GLOW_TOP private static Field SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM private static Field NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_TOP private static Field NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM private static Field LIST_VIEW_FIELD_EDGE_GLOW_TOP private static Field LIST_VIEW_FIELD_EDGE_GLOW_BOTTOM private static Field RECYCLER_VIEW_FIELD_EDGE_GLOW_TOP private static Field RECYCLER_VIEW_FIELD_EDGE_GLOW_LEFT private static Field RECYCLER_VIEW_FIELD_EDGE_GLOW_RIGHT private static Field RECYCLER_VIEW_FIELD_EDGE_GLOW_BOTTOM private static Field VIEW_PAGER_FIELD_EDGE_GLOW_LEFT private static Field VIEW_PAGER_FIELD_EDGE_GLOW_RIGHT private static void invalidateEdgeEffectFields if EDGE_GLOW_FIELD_EDGE null EDGE_GLOW_FIELD_GLOW null EDGE_EFFECT_COMPAT_FIELD_EDGE_EFFECT null EDGE_GLOW_FIELD_EDGE setAccessible true EDGE_GLOW_FIELD_GLOW setAccessible true EDGE_EFFECT_COMPAT_FIELD_EDGE_EFFECT setAccessible true return if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP Field edge null Field glow null for Field f EdgeEffect class getDeclaredFields switch f getName case mEdge f setAccessible true edge f break case mGlow f setAccessible true glow f break EDGE_GLOW_FIELD_EDGE edge EDGE_GLOW_FIELD_GLOW glow else EDGE_GLOW_FIELD_EDGE null EDGE_GLOW_FIELD_GLOW null Field efc null try efc EdgeEffectCompat class getDeclaredField mEdgeEffect catch NoSuchFieldException e if BuildConfig DEBUG e printStackTrace EDGE_EFFECT_COMPAT_FIELD_EDGE_EFFECT efc private static void invalidateScrollViewFields if SCROLL_VIEW_FIELD_EDGE_GLOW_TOP null SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM null SCROLL_VIEW_FIELD_EDGE_GLOW_TOP setAccessible true SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM setAccessible true return final Class cls ScrollView class for Field f cls getDeclaredFields switch f getName case mEdgeGlowTop f setAccessible true SCROLL_VIEW_FIELD_EDGE_GLOW_TOP f break case mEdgeGlowBottom f setAccessible true SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM f break private static void invalidateNestedScrollViewFields if NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_TOP null NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM null NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_TOP setAccessible true NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM setAccessible true return Class cls NestedScrollView class for Field f cls getDeclaredFields switch f getName case mEdgeGlowTop f setAccessible true NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_TOP f break case mEdgeGlowBottom f setAccessible true NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM f break private static void invalidateListViewFields if LIST_VIEW_FIELD_EDGE_GLOW_TOP null LIST_VIEW_FIELD_EDGE_GLOW_BOTTOM null LIST_VIEW_FIELD_EDGE_GLOW_TOP setAccessible true LIST_VIEW_FIELD_EDGE_GLOW_BOTTOM setAccessible true return final Class cls AbsListView class for Field f cls getDeclaredFields switch f getName case mEdgeGlowTop f setAccessible true LIST_VIEW_FIELD_EDGE_GLOW_TOP f break case mEdgeGlowBottom f setAccessible true LIST_VIEW_FIELD_EDGE_GLOW_BOTTOM f break private static void invalidateRecyclerViewFields if RECYCLER_VIEW_FIELD_EDGE_GLOW_TOP null RECYCLER_VIEW_FIELD_EDGE_GLOW_LEFT null RECYCLER_VIEW_FIELD_EDGE_GLOW_RIGHT null RECYCLER_VIEW_FIELD_EDGE_GLOW_BOTTOM null RECYCLER_VIEW_FIELD_EDGE_GLOW_TOP setAccessible true RECYCLER_VIEW_FIELD_EDGE_GLOW_LEFT setAccessible true RECYCLER_VIEW_FIELD_EDGE_GLOW_RIGHT setAccessible true RECYCLER_VIEW_FIELD_EDGE_GLOW_BOTTOM setAccessible true return Class cls RecyclerView class for Field f cls getDeclaredFields switch f getName case mTopGlow f setAccessible true RECYCLER_VIEW_FIELD_EDGE_GLOW_TOP f break case mBottomGlow f setAccessible true RECYCLER_VIEW_FIELD_EDGE_GLOW_BOTTOM f break case mLeftGlow f setAccessible true RECYCLER_VIEW_FIELD_EDGE_GLOW_LEFT f break case mRightGlow f setAccessible true RECYCLER_VIEW_FIELD_EDGE_GLOW_RIGHT f break private static void invalidateViewPagerFields if VIEW_PAGER_FIELD_EDGE_GLOW_LEFT null VIEW_PAGER_FIELD_EDGE_GLOW_RIGHT null VIEW_PAGER_FIELD_EDGE_GLOW_LEFT setAccessible true VIEW_PAGER_FIELD_EDGE_GLOW_RIGHT setAccessible true return Class cls ViewPager class for Field f cls getDeclaredFields switch f getName case mLeftEdge f setAccessible true VIEW_PAGER_FIELD_EDGE_GLOW_LEFT f break case mRightEdge f setAccessible true VIEW_PAGER_FIELD_EDGE_GLOW_RIGHT f break static void setEdgeGlowColor @NonNull ScrollView scrollView @ColorInt int color invalidateScrollViewFields try Object ee ee SCROLL_VIEW_FIELD_EDGE_GLOW_TOP get scrollView setEffectColor ee color ee SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM get scrollView setEffectColor ee color catch Exception ex if BuildConfig DEBUG ex printStackTrace static void setEdgeGlowColor @NonNull NestedScrollView scrollView @ColorInt int color invalidateNestedScrollViewFields try Object ee NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_TOP get scrollView setEffectColor ee color ee NESTED_SCROLL_VIEW_FIELD_EDGE_GLOW_BOTTOM get scrollView setEffectColor ee color catch Exception ex if BuildConfig DEBUG ex printStackTrace static void setEdgeGlowColor @NonNull AbsListView listView @ColorInt int color invalidateListViewFields try Object ee LIST_VIEW_FIELD_EDGE_GLOW_TOP get listView setEffectColor ee color ee LIST_VIEW_FIELD_EDGE_GLOW_BOTTOM get listView setEffectColor ee color catch Exception ex if BuildConfig DEBUG ex printStackTrace static void setEdgeGlowColor @NonNull RecyclerView scrollView final @ColorInt int color @Nullable RecyclerView OnScrollListener scrollListener invalidateRecyclerViewFields invalidateRecyclerViewFields if scrollListener null scrollListener new RecyclerView OnScrollListener @Override public void onScrollStateChanged RecyclerView recyclerView int newState super onScrollStateChanged recyclerView newState EdgeGlowUtil setEdgeGlowColor recyclerView color this scrollView addOnScrollListener scrollListener try Object ee RECYCLER_VIEW_FIELD_EDGE_GLOW_TOP get scrollView setEffectColor ee color ee RECYCLER_VIEW_FIELD_EDGE_GLOW_BOTTOM get scrollView setEffectColor ee color ee RECYCLER_VIEW_FIELD_EDGE_GLOW_LEFT get scrollView setEffectColor ee color ee RECYCLER_VIEW_FIELD_EDGE_GLOW_RIGHT get scrollView setEffectColor ee color catch Exception ex if BuildConfig DEBUG ex printStackTrace static void setEdgeGlowColor @NonNull ViewPager pager @ColorInt int color invalidateViewPagerFields try Object ee VIEW_PAGER_FIELD_EDGE_GLOW_LEFT get pager setEffectColor ee color ee VIEW_PAGER_FIELD_EDGE_GLOW_RIGHT get pager setEffectColor ee color catch Exception ex if BuildConfig DEBUG ex printStackTrace @TargetApi Build VERSION_CODES LOLLIPOP private static void setEffectColor Object edgeEffect @ColorInt int color invalidateEdgeEffectFields if edgeEffect instanceof EdgeEffectCompat try EDGE_EFFECT_COMPAT_FIELD_EDGE_EFFECT setAccessible true edgeEffect EDGE_EFFECT_COMPAT_FIELD_EDGE_EFFECT get edgeEffect catch IllegalAccessException e e printStackTrace return if edgeEffect null return if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP try EDGE_GLOW_FIELD_EDGE setAccessible true final Drawable mEdge Drawable EDGE_GLOW_FIELD_EDGE get edgeEffect EDGE_GLOW_FIELD_GLOW setAccessible true final Drawable mGlow Drawable EDGE_GLOW_FIELD_GLOW get edgeEffect mEdge setColorFilter color PorterDuff Mode SRC_IN mGlow setColorFilter color PorterDuff Mode SRC_IN mEdge setCallback null mGlow setCallback null catch Exception ex ex printStackTrace else EdgeEffect edgeEffect setColor @@@ 1 41
package com afollestad aesthetic import android content Context import android content res TypedArray import android support annotation NonNull import android support annotation Nullable import android support annotation RestrictTo import android support v4 view LayoutInflaterFactory import android support v7 app AppCompatActivity import android support v7 app AppCompatDelegate import android support v7 view ContextThemeWrapper import android util AttributeSet import android util Log import android view LayoutInflater import android view View import android widget LinearLayout import java lang reflect Field import java lang reflect Method import io reactivex Observable import static android support annotation RestrictTo Scope LIBRARY_GROUP import static com afollestad aesthetic Util resolveResId @RestrictTo LIBRARY_GROUP final class InflationInterceptor implements LayoutInflaterFactory private final Method onCreateViewMethod private final Method createViewMethod private final Field constructorArgsField private final AppCompatActivity keyContext @NonNull private final LayoutInflater layoutInflater @Nullable private final AppCompatDelegate delegate private int ATTRS_THEME InflationInterceptor @Nullable AppCompatActivity keyContext @NonNull LayoutInflater li @Nullable AppCompatDelegate delegate this keyContext keyContext layoutInflater li this delegate delegate try onCreateViewMethod LayoutInflater class getDeclaredMethod onCreateView View class String class AttributeSet class catch NoSuchMethodException e throw new IllegalStateException Failed to retrieve the onCreateView method e try createViewMethod LayoutInflater class getDeclaredMethod createView String class String class AttributeSet class catch NoSuchMethodException e throw new IllegalStateException Failed to retrieve the createView method e try constructorArgsField LayoutInflater class getDeclaredField mConstructorArgs catch NoSuchFieldException e throw new IllegalStateException Failed to retrieve the mConstructorArgs field e try final Field attrsThemeField LayoutInflater class getDeclaredField ATTRS_THEME attrsThemeField setAccessible true ATTRS_THEME int attrsThemeField get null catch Throwable t t printStackTrace Log d InflationInterceptor Failed to get the value of static field ATTRS_THEME t getMessage onCreateViewMethod setAccessible true createViewMethod setAccessible true constructorArgsField setAccessible true private static void log String msg Object args if args null Log d InflationInterceptor String format msg args else Log d InflationInterceptor msg private boolean isBlackListedForApply String name return android support design internal NavigationMenuItemView equals name ViewStub equals name fragment equals name include equals name @Override public View onCreateView View parent final String name Context context AttributeSet attrs View view null final int viewId resolveResId context attrs android R attr id switch name case ImageView case android support v7 widget AppCompatImageView view new AestheticImageView context attrs break case ImageButton case android support v7 widget AppCompatImageButton view new AestheticImageButton context attrs break case android support v4 widget DrawerLayout view new AestheticDrawerLayout context attrs break case Toolbar case android support v7 widget Toolbar view new AestheticToolbar context attrs break case android support v7 widget AppCompatTextView case TextView if viewId R id snackbar_text view new AestheticSnackBarTextView context attrs else view new AestheticTextView context attrs if parent instanceof LinearLayout view getId android R id message view null break case Button case android support v7 widget AppCompatButton if viewId android R id button1 viewId android R id button2 viewId android R id button3 view new AestheticDialogButton context attrs else if viewId R id snackbar_action view new AestheticSnackBarButton context attrs else view new AestheticButton context attrs break case android support v7 widget AppCompatCheckBox case CheckBox view new AestheticCheckBox context attrs break case android support v7 widget AppCompatRadioButton case RadioButton view new AestheticRadioButton context attrs break case android support v7 widget AppCompatEditText case EditText view new AestheticEditText context attrs break case Switch view new AestheticSwitch context attrs break case android support v7 widget SwitchCompat view new AestheticSwitchCompat context attrs break case android support v7 widget AppCompatSeekBar case SeekBar view new AestheticSeekBar context attrs break case ProgressBar view new AestheticProgressBar context attrs break case android support v7 view menu ActionMenuItemView view new AestheticActionMenuItemView context attrs break case android support v7 widget RecyclerView view new AestheticRecyclerView context attrs break case android support v4 widget NestedScrollView view new AestheticNestedScrollView context attrs break case ListView view new AestheticListView context attrs break case ScrollView view new AestheticScrollView context attrs break case android support v4 view ViewPager view new AestheticViewPager context attrs break case Spinner case android support v7 widget AppCompatSpinner view new AestheticSpinner context attrs break case android support design widget TextInputLayout view new AestheticTextInputLayout context attrs break case android support design widget TextInputEditText view new AestheticTextInputEditText context attrs break case android support v7 widget CardView view new AestheticCardView context attrs break case android support design widget TabLayout view new AestheticTabLayout context attrs break case android support design widget NavigationView view new AestheticNavigationView context attrs break case android support design widget BottomNavigationView view new AestheticBottomNavigationView context attrs break case android support design widget FloatingActionButton view new AestheticFab context attrs break case android support design widget CoordinatorLayout view new AestheticCoordinatorLayout context attrs break int viewBackgroundRes 0 if view null view getTag null aesthetic_ignore equals view getTag view null else if attrs null viewBackgroundRes resolveResId context attrs android R attr background if view null if delegate null view delegate createView parent name context attrs if view null view keyContext onCreateView parent name context attrs else view null else view null if isBlackListedForApply name return view if view null try Context viewContext layoutInflater getContext if ATTRS_THEME null final TypedArray ta viewContext obtainStyledAttributes attrs ATTRS_THEME final int themeResId ta getResourceId 0 0 if themeResId 0 viewContext new ContextThemeWrapper viewContext themeResId ta recycle Object constructorArgs try constructorArgs Object constructorArgsField get layoutInflater catch IllegalAccessException e throw new IllegalStateException Failed to retrieve the mConstructorArgsField field e final Object lastContext constructorArgs 0 constructorArgs 0 viewContext try if 1 name indexOf view View onCreateViewMethod invoke layoutInflater parent name attrs else view View createViewMethod invoke layoutInflater name null attrs catch Exception e log Failed to inflate s s name e getMessage e printStackTrace finally constructorArgs 0 lastContext catch Throwable t throw new RuntimeException String format An error occurred while inflating View s s name t getMessage t if view null if viewBackgroundRes 0 Observable Integer obs obs ViewUtil getObservableForResId view getContext viewBackgroundRes null if obs null Aesthetic get addBackgroundSubscriber view obs String idName try idName context getResources getResourceName view getId catch Throwable ignored log Inflated s s idName view getClass getName return @@@ 1 42
package com afollestad aesthetic import android support annotation IntDef import java lang annotation Retention import static com afollestad aesthetic NavigationViewMode SELECTED_ACCENT import static com afollestad aesthetic NavigationViewMode SELECTED_PRIMARY import static java lang annotation RetentionPolicy SOURCE @SuppressWarnings WeakerAccess @Retention SOURCE @IntDef value SELECTED_PRIMARY SELECTED_ACCENT public @interface NavigationViewMode int SELECTED_PRIMARY 0 int SELECTED_ACCENT @@@ 1 43
package com afollestad aesthetic import android support annotation RestrictTo import io reactivex Observable import io reactivex ObservableSource import io reactivex ObservableTransformer import io reactivex android schedulers AndroidSchedulers import io reactivex annotations NonNull import io reactivex exceptions Exceptions import io reactivex functions Consumer import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class Rx static Consumer Throwable onErrorLogAndRethrow return new Consumer Throwable @Override public void accept @NonNull Throwable throwable throws Exception throwable printStackTrace throw Exceptions propagate throwable static T ObservableTransformer T T distinctToMainThread return new ObservableTransformer T T @Override public ObservableSource T apply @NonNull Observable T obs return obs observeOn AndroidSchedulers mainThread @@@ 1 44
package com afollestad aesthetic import android support annotation IntDef import java lang annotation Retention import static com afollestad aesthetic TabLayoutBgMode ACCENT import static com afollestad aesthetic TabLayoutBgMode PRIMARY import static java lang annotation RetentionPolicy SOURCE @SuppressWarnings WeakerAccess @Retention SOURCE @IntDef value PRIMARY ACCENT public @interface TabLayoutBgMode int PRIMARY 0 int ACCENT @@@ 1 45
package com afollestad aesthetic import android support annotation IntDef import java lang annotation Retention import static com afollestad aesthetic TabLayoutIndicatorMode ACCENT import static com afollestad aesthetic TabLayoutIndicatorMode PRIMARY import static java lang annotation RetentionPolicy SOURCE @SuppressWarnings WeakerAccess @Retention SOURCE @IntDef value PRIMARY ACCENT public @interface TabLayoutIndicatorMode int PRIMARY 0 int ACCENT @@@ 1 46
package com afollestad aesthetic import android content res ColorStateList import android support annotation ColorInt import android support annotation NonNull import android support annotation RestrictTo import android support design widget TextInputLayout import java lang reflect Field import java lang reflect Method import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class TextInputLayoutUtil static void setHint @NonNull TextInputLayout view @ColorInt int hintColor try final Field mDefaultTextColorField TextInputLayout class getDeclaredField mDefaultTextColor mDefaultTextColorField setAccessible true mDefaultTextColorField set view ColorStateList valueOf hintColor final Method updateLabelStateMethod TextInputLayout class getDeclaredMethod updateLabelState boolean class boolean class updateLabelStateMethod setAccessible true updateLabelStateMethod invoke view false true catch Throwable t throw new IllegalStateException Failed to set TextInputLayout hint collapsed color t getLocalizedMessage t static void setAccent @NonNull TextInputLayout view @ColorInt int accentColor try final Field mFocusedTextColorField TextInputLayout class getDeclaredField mFocusedTextColor mFocusedTextColorField setAccessible true mFocusedTextColorField set view ColorStateList valueOf accentColor final Method updateLabelStateMethod TextInputLayout class getDeclaredMethod updateLabelState boolean class boolean class updateLabelStateMethod setAccessible true updateLabelStateMethod invoke view false true catch Throwable t throw new IllegalStateException Failed to set TextInputLayout accent expanded color t getLocalizedMessage @@@ 1 47
package com afollestad aesthetic import android annotation SuppressLint import android content Context import android content res ColorStateList import android graphics PorterDuff import android graphics drawable Drawable import android graphics drawable RippleDrawable import android os Build import android support annotation CheckResult import android support annotation ColorInt import android support annotation NonNull import android support annotation Nullable import android support annotation RestrictTo import android support design widget FloatingActionButton import android support design widget TextInputEditText import android support v4 content ContextCompat import android support v4 graphics drawable DrawableCompat import android support v4 view TintableBackgroundView import android support v4 view ViewCompat import android support v7 widget SwitchCompat import android view View import android widget Button import android widget CheckBox import android widget EditText import android widget ImageView import android widget ProgressBar import android widget RadioButton import android widget SeekBar import android widget Switch import android widget TextView import java lang reflect Field import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class TintHelper @SuppressLint PrivateResource @ColorInt private static int getDefaultRippleColor @NonNull Context context boolean useDarkRipple return ContextCompat getColor context useDarkRipple R color ripple_material_light R color ripple_material_dark @NonNull private static ColorStateList getDisabledColorStateList @ColorInt int normal @ColorInt int disabled return new ColorStateList new int new int android R attr state_enabled new int android R attr state_enabled new int disabled normal @SuppressWarnings deprecation private static void setTintSelector @NonNull View view @ColorInt final int color final boolean darker final boolean useDarkTheme final boolean isColorLight Util isColorLight color final int disabled ContextCompat getColor view getContext useDarkTheme R color ate_button_disabled_dark R color ate_button_disabled_light final int pressed Util shiftColor color darker 0 9f 1 1f final int activated Util shiftColor color darker 1 1f 0 9f final int rippleColor getDefaultRippleColor view getContext isColorLight final int textColor ContextCompat getColor view getContext isColorLight R color ate_primary_text_light R color ate_primary_text_dark final ColorStateList sl if view instanceof Button sl getDisabledColorStateList color disabled if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP view getBackground instanceof RippleDrawable RippleDrawable rd RippleDrawable view getBackground rd setColor ColorStateList valueOf rippleColor final Button button Button view button setTextColor getDisabledColorStateList textColor ContextCompat getColor view getContext useDarkTheme R color ate_button_text_disabled_dark R color ate_button_text_disabled_light else if view instanceof FloatingActionButton sl new ColorStateList new int new int android R attr state_pressed new int android R attr state_pressed new int color pressed final FloatingActionButton fab FloatingActionButton view fab setRippleColor rippleColor fab setBackgroundTintList sl if fab getDrawable null fab setImageDrawable createTintedDrawable fab getDrawable textColor return else sl new ColorStateList new int new int android R attr state_enabled new int android R attr state_enabled new int android R attr state_enabled android R attr state_pressed new int android R attr state_enabled android R attr state_activated new int android R attr state_enabled android R attr state_checked new int disabled color pressed activated activated Drawable drawable view getBackground if drawable null drawable createTintedDrawable drawable sl Util setBackgroundCompat view drawable if view instanceof TextView view instanceof Button final TextView tv TextView view tv setTextColor getDisabledColorStateList textColor ContextCompat getColor view getContext isColorLight R color ate_text_disabled_light R color ate_text_disabled_dark @SuppressWarnings deprecation @SuppressLint PrivateResource static void setTintAuto final @NonNull View view final @ColorInt int color boolean background final boolean isDark if background if view instanceof RadioButton setTint RadioButton view color isDark else if view instanceof SeekBar setTint SeekBar view color isDark else if view instanceof ProgressBar setTint ProgressBar view color else if view instanceof EditText setTint EditText view color isDark else if view instanceof CheckBox setTint CheckBox view color isDark else if view instanceof ImageView setTint ImageView view color else if view instanceof Switch setTint Switch view color isDark else if view instanceof SwitchCompat setTint SwitchCompat view color isDark else background true if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP background view getBackground instanceof RippleDrawable RippleDrawable rd RippleDrawable view getBackground final int unchecked ContextCompat getColor view getContext isDark R color ripple_material_dark R color ripple_material_light final int checked Util adjustAlpha color 0 4f final ColorStateList sl new ColorStateList new int new int android R attr state_activated android R attr state_checked new int android R attr state_activated new int android R attr state_checked new int unchecked checked checked rd setColor sl if background if view instanceof FloatingActionButton view instanceof Button setTintSelector view color false isDark else if view getBackground null Drawable drawable view getBackground if drawable null if view instanceof TextInputEditText drawable setColorFilter color PorterDuff Mode SRC_IN else drawable createTintedDrawable drawable color Util setBackgroundCompat view drawable static void setTint @NonNull RadioButton radioButton @ColorInt int color boolean useDarker ColorStateList sl new ColorStateList new int new int android R attr state_enabled new int android R attr state_enabled android R attr state_checked new int android R attr state_enabled android R attr state_checked new int Util stripAlpha ContextCompat getColor radioButton getContext useDarker R color ate_control_disabled_dark R color ate_control_disabled_light ContextCompat getColor radioButton getContext useDarker R color ate_control_normal_dark R color ate_control_normal_light color if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP radioButton setButtonTintList sl else @SuppressLint PrivateResource Drawable d createTintedDrawable ContextCompat getDrawable radioButton getContext R drawable abc_btn_radio_material sl radioButton setButtonDrawable d static void setTint @NonNull SeekBar seekBar @ColorInt int color boolean useDarker final ColorStateList s1 getDisabledColorStateList color ContextCompat getColor seekBar getContext useDarker R color ate_control_disabled_dark R color ate_control_disabled_light if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP seekBar setThumbTintList s1 seekBar setProgressTintList s1 else Drawable progressDrawable createTintedDrawable seekBar getProgressDrawable s1 seekBar setProgressDrawable progressDrawable if Build VERSION SDK_INT Build VERSION_CODES JELLY_BEAN Drawable thumbDrawable createTintedDrawable seekBar getThumb s1 seekBar setThumb thumbDrawable static void setTint @NonNull ProgressBar progressBar @ColorInt int color setTint progressBar color false private static void setTint @NonNull ProgressBar progressBar @ColorInt int color boolean skipIndeterminate ColorStateList sl ColorStateList valueOf color if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP progressBar setProgressTintList sl progressBar setSecondaryProgressTintList sl if skipIndeterminate progressBar setIndeterminateTintList sl else PorterDuff Mode mode PorterDuff Mode SRC_IN if skipIndeterminate progressBar getIndeterminateDrawable null progressBar getIndeterminateDrawable setColorFilter color mode if progressBar getProgressDrawable null progressBar getProgressDrawable setColorFilter color mode private static void setTint @NonNull EditText editText @ColorInt int color boolean useDarker final ColorStateList editTextColorStateList new ColorStateList new int new int android R attr state_enabled new int android R attr state_enabled android R attr state_pressed android R attr state_focused new int new int ContextCompat getColor editText getContext useDarker R color ate_text_disabled_dark R color ate_text_disabled_light ContextCompat getColor editText getContext useDarker R color ate_control_normal_dark R color ate_control_normal_light color if editText instanceof TintableBackgroundView ViewCompat setBackgroundTintList editText editTextColorStateList else if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP editText setBackgroundTintList editTextColorStateList setCursorTint editText color static void setTint @NonNull CheckBox box @ColorInt int color boolean useDarker ColorStateList sl new ColorStateList new int new int android R attr state_enabled new int android R attr state_enabled android R attr state_checked new int android R attr state_enabled android R attr state_checked new int ContextCompat getColor box getContext useDarker R color ate_control_disabled_dark R color ate_control_disabled_light ContextCompat getColor box getContext useDarker R color ate_control_normal_dark R color ate_control_normal_light color if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP box setButtonTintList sl else @SuppressLint PrivateResource Drawable drawable createTintedDrawable ContextCompat getDrawable box getContext R drawable abc_btn_check_material sl box setButtonDrawable drawable private static void setTint @NonNull ImageView image @ColorInt int color image setColorFilter color PorterDuff Mode SRC_ATOP private static Drawable modifySwitchDrawable @NonNull Context context @NonNull Drawable from @ColorInt int tint boolean thumb boolean compatSwitch boolean useDarker if useDarker tint Util shiftColor tint 1 1f tint Util adjustAlpha tint compatSwitch thumb 0 5f 1 0f int disabled int normal if thumb disabled ContextCompat getColor context useDarker R color ate_switch_thumb_disabled_dark R color ate_switch_thumb_disabled_light normal ContextCompat getColor context useDarker R color ate_switch_thumb_normal_dark R color ate_switch_thumb_normal_light else disabled ContextCompat getColor context useDarker R color ate_switch_track_disabled_dark R color ate_switch_track_disabled_light normal ContextCompat getColor context useDarker R color ate_switch_track_normal_dark R color ate_switch_track_normal_light if compatSwitch normal Util stripAlpha normal final ColorStateList sl new ColorStateList new int new int android R attr state_enabled new int android R attr state_enabled android R attr state_activated android R attr state_checked new int android R attr state_enabled android R attr state_activated new int android R attr state_enabled android R attr state_checked new int disabled normal tint tint return createTintedDrawable from sl static void setTint @NonNull Switch switchView @ColorInt int color boolean useDarker if switchView getTrackDrawable null switchView setTrackDrawable modifySwitchDrawable switchView getContext switchView getTrackDrawable color false false useDarker if switchView getThumbDrawable null switchView setThumbDrawable modifySwitchDrawable switchView getContext switchView getThumbDrawable color true false useDarker static void setTint @NonNull SwitchCompat switchView @ColorInt int color boolean useDarker if switchView getTrackDrawable null switchView setTrackDrawable modifySwitchDrawable switchView getContext switchView getTrackDrawable color false true useDarker if switchView getThumbDrawable null switchView setThumbDrawable modifySwitchDrawable switchView getContext switchView getThumbDrawable color true true useDarker @CheckResult @Nullable static Drawable createTintedDrawable @Nullable Drawable drawable @ColorInt int color if drawable null return null drawable DrawableCompat wrap drawable mutate DrawableCompat setTintMode drawable PorterDuff Mode SRC_IN DrawableCompat setTint drawable color return drawable @CheckResult @Nullable static Drawable createTintedDrawable @Nullable Drawable drawable @NonNull ColorStateList sl if drawable null return null drawable DrawableCompat wrap drawable mutate DrawableCompat setTintList drawable sl return drawable static void setCursorTint @NonNull EditText editText @ColorInt int color try Field fCursorDrawableRes TextView class getDeclaredField mCursorDrawableRes fCursorDrawableRes setAccessible true int mCursorDrawableRes fCursorDrawableRes getInt editText Field fEditor TextView class getDeclaredField mEditor fEditor setAccessible true Object editor fEditor get editText Class clazz editor getClass Field fCursorDrawable clazz getDeclaredField mCursorDrawable fCursorDrawable setAccessible true Drawable drawables new Drawable 2 drawables 0 ContextCompat getDrawable editText getContext mCursorDrawableRes drawables 0 createTintedDrawable drawables 0 color drawables 1 ContextCompat getDrawable editText getContext mCursorDrawableRes drawables 1 createTintedDrawable drawables 1 color fCursorDrawable set editor drawables catch Exception e e @@@ 1 48
package com afollestad aesthetic import android annotation SuppressLint import android annotation TargetApi import android app Activity import android app ActivityManager import android content Context import android content res TypedArray import android graphics Bitmap import android graphics Color import android graphics drawable BitmapDrawable import android graphics drawable Drawable import android os Build import android support annotation AttrRes import android support annotation ColorInt import android support annotation FloatRange import android support annotation IdRes import android support annotation NonNull import android support annotation Nullable import android support annotation RestrictTo import android support v4 view LayoutInflaterCompat import android support v7 app AppCompatActivity import android support v7 widget AppCompatImageView import android support v7 widget Toolbar import android util AttributeSet import android view LayoutInflater import android view View import android view ViewGroup import java util ArrayList import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class Util static void setInflaterFactory @NonNull LayoutInflater li @NonNull AppCompatActivity activity LayoutInflaterCompat setFactory li new InflationInterceptor activity li activity getDelegate static int blendColors int color1 int color2 float ratio final float inverseRatio 1f ratio float a Color alpha color1 inverseRatio Color alpha color2 ratio float r Color red color1 inverseRatio Color red color2 ratio float g Color green color1 inverseRatio Color green color2 ratio float b Color blue color1 inverseRatio Color blue color2 ratio return Color argb int a int r int g int b @SuppressWarnings deprecation static void setBackgroundCompat @NonNull View view @Nullable Drawable drawable if Build VERSION SDK_INT Build VERSION_CODES JELLY_BEAN view setBackground drawable else view setBackgroundDrawable drawable static void setStatusBarColorCompat @NonNull AppCompatActivity activity @ColorInt int color if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP activity getWindow setStatusBarColor color static void setNavBarColorCompat @NonNull AppCompatActivity activity @ColorInt int color if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP activity getWindow setNavigationBarColor color static int stripAlpha @ColorInt int color return Color rgb Color red color Color green color Color blue color @ColorInt static int resolveColor Context context @AttrRes int attr return resolveColor context attr 0 @ColorInt static int resolveColor Context context @AttrRes int attr int fallback TypedArray a context getTheme obtainStyledAttributes new int attr try return a getColor 0 fallback catch Throwable ignored return fallback finally a recycle @IdRes static int resolveResId Context context @AttrRes int attr int fallback TypedArray a context getTheme obtainStyledAttributes new int attr try return a getResourceId 0 fallback finally a recycle static int resolveResId Context context AttributeSet attrs @AttrRes int attrId TypedArray ta context obtainStyledAttributes attrs new int attrId int result ta getResourceId 0 0 ta recycle return result @ColorInt static int adjustAlpha @ColorInt int color @SuppressWarnings SameParameterValue float factor int alpha Math round Color alpha color factor int red Color red color int green Color green color int blue Color blue color return Color argb alpha red green blue static void setOverflowButtonColor @NonNull final Toolbar toolbar final @ColorInt int color @SuppressLint PrivateResource final String overflowDescription toolbar getResources getString R string abc_action_menu_overflow_description final ArrayList View outViews new ArrayList toolbar findViewsWithText outViews overflowDescription View FIND_VIEWS_WITH_CONTENT_DESCRIPTION if outViews isEmpty return final AppCompatImageView overflow AppCompatImageView outViews get 0 overflow setImageDrawable TintHelper createTintedDrawable overflow getDrawable color @ColorInt static int shiftColor @ColorInt int color @FloatRange from 0 0f to 2 0f float by if by 1f return color float hsv new float 3 Color colorToHSV color hsv hsv 2 by return Color HSVToColor hsv @ColorInt static int darkenColor @ColorInt int color return shiftColor color 0 9f static boolean isColorLight @ColorInt int color if color Color BLACK return false else if color Color WHITE color Color TRANSPARENT return true final double darkness 1 0 299 Color red color 0 587 Color green color 0 114 Color blue color 255 return darkness 0 4 static boolean isColorLight @ColorInt int color @ColorInt int bgColor if Color alpha color 128 return isColorLight bgColor return isColorLight color static void setLightStatusBarCompat @NonNull AppCompatActivity activity boolean lightMode final View view activity getWindow getDecorView if Build VERSION SDK_INT Build VERSION_CODES M int flags view getSystemUiVisibility if lightMode flags View SYSTEM_UI_FLAG_LIGHT_STATUS_BAR else flags View SYSTEM_UI_FLAG_LIGHT_STATUS_BAR view setSystemUiVisibility flags @TargetApi Build VERSION_CODES LOLLIPOP static void setTaskDescriptionColor @NonNull Activity activity @ColorInt int color if Build VERSION SDK_INT Build VERSION_CODES LOLLIPOP return color stripAlpha color Bitmap icon BitmapDrawable activity getApplicationInfo loadIcon activity getPackageManager getBitmap ActivityManager TaskDescription td new ActivityManager TaskDescription String activity getTitle icon color activity setTaskDescription td @NonNull static ViewGroup getRootView @NonNull Activity activity return ViewGroup ViewGroup activity findViewById android R id content getChildAt @@@ 1 49
package com afollestad aesthetic import android support annotation NonNull import android support annotation RestrictTo import android view View import io reactivex functions Consumer import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP class ViewBackgroundAction implements Consumer Integer private final View view private ViewBackgroundAction View view this view view public static ViewBackgroundAction create @NonNull View view return new ViewBackgroundAction view @Override public void accept @io reactivex annotations NonNull Integer color if view null view setBackgroundColor @@@ 1 50
package com afollestad aesthetic import android support annotation NonNull import android support annotation RestrictTo import android support v7 widget CardView import android view View import io reactivex exceptions Exceptions import io reactivex observers DisposableObserver import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class ViewBackgroundSubscriber extends DisposableObserver Integer private final View view private ViewBackgroundSubscriber @NonNull View view this view view public static ViewBackgroundSubscriber create @NonNull View view return new ViewBackgroundSubscriber view @Override public void onError Throwable e throw Exceptions propagate e @Override public void onComplete @Override public void onNext Integer color if view instanceof CardView CardView view setCardBackgroundColor color else view setBackgroundColor @@@ 1 51
package com afollestad aesthetic import android support annotation NonNull import android support annotation RestrictTo import android widget TextView import io reactivex functions Consumer import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP class ViewHintTextColorAction implements Consumer Integer private final TextView view private ViewHintTextColorAction TextView view this view view public static ViewHintTextColorAction create @NonNull TextView view return new ViewHintTextColorAction view @Override public void accept @io reactivex annotations NonNull Integer color if view null view setHintTextColor @@@ 1 52
package com afollestad aesthetic import android support annotation RestrictTo import android view View import io reactivex Observable import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP final class ViewObservablePair private final View view private final Observable Integer observable private ViewObservablePair View view Observable Integer observable this view view this observable observable static ViewObservablePair create View view Observable Integer observable return new ViewObservablePair view observable View view return view Observable Integer observable return @@@ 1 53
package com afollestad aesthetic import android support annotation NonNull import android support annotation RestrictTo import android widget TextView import io reactivex functions Consumer import static android support annotation RestrictTo Scope LIBRARY_GROUP @RestrictTo LIBRARY_GROUP class ViewTextColorAction implements Consumer Integer private final TextView view private ViewTextColorAction TextView view this view view public static ViewTextColorAction create @NonNull TextView view return new ViewTextColorAction view @Override public void accept @io reactivex annotations NonNull Integer color if view null view setTextColor @@@ 1 54
package com afollestad aesthetic import android content Context import android graphics drawable Drawable import android support annotation IdRes import android support annotation NonNull import android support annotation Nullable import android support annotation RestrictTo import android support v7 widget SearchView import android support v7 widget Toolbar import android view Menu import android view MenuItem import android view View import android widget EditText import android widget ImageView import java lang reflect Field import io reactivex Observable import static android support annotation RestrictTo Scope LIBRARY_GROUP import static com afollestad aesthetic TintHelper createTintedDrawable import static com afollestad aesthetic Util isColorLight import static com afollestad aesthetic Util resolveResId @RestrictTo LIBRARY_GROUP final class ViewUtil @Nullable static Observable Integer getObservableForResId @NonNull Context context @IdRes int resId @Nullable Observable Integer fallback if resId 0 return fallback else if resId resolveResId context R attr colorPrimary 0 return Aesthetic get colorPrimary else if resId resolveResId context R attr colorPrimaryDark 0 return Aesthetic get colorPrimaryDark else if resId resolveResId context android R attr statusBarColor 0 return Aesthetic get colorStatusBar else if resId resolveResId context R attr colorAccent 0 return Aesthetic get colorAccent else if resId resolveResId context android R attr windowBackground 0 return Aesthetic get colorWindowBackground else if resId resolveResId context android R attr textColorPrimary 0 return Aesthetic get textColorPrimary else if resId resolveResId context android R attr textColorPrimaryInverse 0 return Aesthetic get textColorPrimaryInverse else if resId resolveResId context android R attr textColorSecondary 0 return Aesthetic get textColorSecondary else if resId resolveResId context android R attr textColorSecondaryInverse 0 return Aesthetic get textColorSecondaryInverse return fallback static void tintToolbarMenu @NonNull Toolbar toolbar @NonNull Menu menu ActiveInactiveColors titleIconColors try final Field field Toolbar class getDeclaredField mCollapseIcon field setAccessible true Drawable collapseIcon Drawable field get toolbar if collapseIcon null field set toolbar createTintedDrawable collapseIcon titleIconColors toEnabledSl catch Exception e e printStackTrace for int i 0 i menu size i MenuItem item menu getItem i if item getActionView instanceof SearchView themeSearchView titleIconColors SearchView item getActionView private static void themeSearchView ActiveInactiveColors tintColors SearchView view final Class cls view getClass try final Field mSearchSrcTextViewField cls getDeclaredField mSearchSrcTextView mSearchSrcTextViewField setAccessible true final EditText mSearchSrcTextView EditText mSearchSrcTextViewField get view mSearchSrcTextView setTextColor tintColors activeColor mSearchSrcTextView setHintTextColor tintColors inactiveColor TintHelper setCursorTint mSearchSrcTextView tintColors activeColor Field field cls getDeclaredField mSearchButton tintImageView view field tintColors field cls getDeclaredField mGoButton tintImageView view field tintColors field cls getDeclaredField mCloseButton tintImageView view field tintColors field cls getDeclaredField mVoiceButton tintImageView view field tintColors field cls getDeclaredField mSearchPlate field setAccessible true TintHelper setTintAuto View field get view tintColors activeColor true isColorLight tintColors activeColor field cls getDeclaredField mSearchHintIcon field setAccessible true field set view createTintedDrawable Drawable field get view tintColors toEnabledSl catch Exception e e printStackTrace private static void tintImageView Object target Field field ActiveInactiveColors tintColors throws Exception field setAccessible true final ImageView imageView ImageView field get target if imageView getDrawable null imageView setImageDrawable createTintedDrawable imageView getDrawable tintColors @@@ 1 55
package com afollestad aestheticsample import android os Bundle import android support annotation Nullable import android support v7 widget Toolbar import android view View import com afollestad aesthetic AestheticActivity import butterknife BindView import butterknife ButterKnife import butterknife Unbinder public class BottomNavActivity extends AestheticActivity @BindView R id toolbar Toolbar toolbar private Unbinder unbinder @Override protected void onCreate @Nullable Bundle savedInstanceState super onCreate savedInstanceState setContentView R layout activity_bottom_nav unbinder ButterKnife bind this toolbar setNavigationOnClickListener new View OnClickListener @Override public void onClick View view finish @Override protected void onDestroy unbinder unbind super @@@ 1 56
package com afollestad aestheticsample import android os Bundle import android support annotation Nullable import android support v7 widget Toolbar import android view View import com afollestad aesthetic AestheticActivity import butterknife BindView import butterknife ButterKnife import butterknife Unbinder public class CoordinatorLayoutActivity extends AestheticActivity @BindView R id toolbar Toolbar toolbar private Unbinder unbinder @Override protected void onCreate @Nullable Bundle savedInstanceState super onCreate savedInstanceState setContentView R layout activity_collapsing_appbar unbinder ButterKnife bind this toolbar inflateMenu R menu coordinatorlayout toolbar setNavigationOnClickListener new View OnClickListener @Override public void onClick View view finish @Override protected void onDestroy unbinder unbind super @@@ 1 57
package com afollestad aestheticsample import android content res Configuration import android os Bundle import android support annotation Nullable import android support design widget NavigationView import android support v4 widget DrawerLayout import android support v7 app ActionBarDrawerToggle import android support v7 widget Toolbar import android view MenuItem import com afollestad aesthetic Aesthetic import com afollestad aesthetic AestheticActivity import butterknife BindView import butterknife ButterKnife import butterknife Unbinder public class DrawerActivity extends AestheticActivity @BindView R id toolbar Toolbar toolbar @BindView R id drawer_layout DrawerLayout drawerLayout @BindView R id navigation_view NavigationView navigationView private Unbinder unbinder private ActionBarDrawerToggle drawerToggle @Override protected void onCreate @Nullable Bundle savedInstanceState super onCreate savedInstanceState setContentView R layout activity_drawer unbinder ButterKnife bind this setSupportActionBar toolbar drawerToggle new ActionBarDrawerToggle this drawerLayout toolbar R string open_drawer R string close_drawer drawerLayout addDrawerListener drawerToggle getSupportActionBar setDisplayHomeAsUpEnabled true getSupportActionBar setHomeButtonEnabled true navigationView post new Runnable @Override public void run navigationView setCheckedItem R id item_three @Override protected void onPostCreate Bundle savedInstanceState super onPostCreate savedInstanceState drawerToggle syncState @Override public void onConfigurationChanged Configuration newConfig super onConfigurationChanged newConfig drawerToggle onConfigurationChanged newConfig @Override public boolean onOptionsItemSelected MenuItem item return drawerToggle onOptionsItemSelected item super onOptionsItemSelected item @Override protected void onDestroy unbinder unbind super @@@ 1 58
package com afollestad aestheticsample import android graphics Color import android os Bundle import android support design widget TabLayout import android support v4 view MenuItemCompat import android support v4 view ViewPager import android support v7 widget SearchView import android support v7 widget Toolbar import android view MenuItem import com afollestad aesthetic Aesthetic import com afollestad aesthetic AestheticActivity import com afollestad aesthetic BottomNavBgMode import com afollestad aesthetic BottomNavIconTextMode import com afollestad aesthetic NavigationViewMode import butterknife BindView import butterknife ButterKnife import butterknife Unbinder public class MainActivity extends AestheticActivity @BindView R id toolbar Toolbar toolbar @BindView R id pager ViewPager pager @BindView R id tabs TabLayout tabs private Unbinder unbinder @Override protected void onCreate Bundle savedInstanceState super onCreate savedInstanceState setContentView R layout activity_main unbinder ButterKnife bind this toolbar inflateMenu R menu main final MenuItem searchItem toolbar getMenu findItem R id search final SearchView searchView SearchView MenuItemCompat getActionView searchItem searchView setQueryHint getString R string search_view_example if Aesthetic isFirstTime Aesthetic get activityTheme R style AppTheme textColorPrimaryRes R color text_color_primary textColorSecondaryRes R color text_color_secondary colorPrimaryRes R color md_white colorAccentRes R color md_blue colorStatusBarAuto colorNavigationBarAuto textColorPrimary Color BLACK navigationViewMode NavigationViewMode SELECTED_ACCENT bottomNavigationBackgroundMode BottomNavBgMode PRIMARY bottomNavigationIconTextMode BottomNavIconTextMode SELECTED_ACCENT apply pager setAdapter new MainPagerAdapter this getSupportFragmentManager tabs setupWithViewPager pager @Override protected void onDestroy unbinder unbind super @@@ 1 59
package com afollestad aestheticsample import android annotation SuppressLint import android support v7 widget RecyclerView import android view LayoutInflater import android view View import android view ViewGroup import android widget TextView import butterknife BindView import butterknife ButterKnife class MainAdapter extends RecyclerView Adapter MainAdapter ViewHolder @Override public ViewHolder onCreateViewHolder ViewGroup parent int viewType View view LayoutInflater from parent getContext inflate R layout list_item_rv parent false return new ViewHolder view @SuppressLint SetTextI18n @Override public void onBindViewHolder ViewHolder holder int position holder title setText Item position holder subtitle setText R string hello_world @Override public int getItemCount return 20 static class ViewHolder extends RecyclerView ViewHolder @BindView R id title TextView title @BindView R id subtitle TextView subtitle ViewHolder View itemView super itemView ButterKnife bind this @@@ 1 60
package com afollestad aestheticsample import android os Bundle import android support annotation Nullable import android support design widget Snackbar import android support v4 app Fragment import android support v7 widget SwitchCompat import android view LayoutInflater import android view View import android view ViewGroup import android widget ArrayAdapter import android widget FrameLayout import android widget Spinner import com afollestad aesthetic Aesthetic import com afollestad aesthetic BottomNavBgMode import com afollestad aesthetic BottomNavIconTextMode import butterknife BindView import butterknife ButterKnife import butterknife OnClick import butterknife Unbinder import io reactivex annotations NonNull import io reactivex disposables Disposable import io reactivex functions Consumer public class MainFragment extends Fragment @BindView R id root FrameLayout rootView @BindView R id switch_theme SwitchCompat switchThemeView @BindView R id spinner Spinner spinnerView private Snackbar snackbar private Unbinder unbinder private Disposable isDarkSubscription @Nullable @Override public View onCreateView LayoutInflater inflater @Nullable ViewGroup container @Nullable Bundle savedInstanceState return inflater inflate R layout fragment_main container false @Override public void onViewCreated View view @Nullable Bundle savedInstanceState super onViewCreated view savedInstanceState unbinder ButterKnife bind this view isDarkSubscription Aesthetic get isDark subscribe new Consumer Boolean @Override public void accept @NonNull Boolean isDark switchThemeView setChecked isDark ArrayAdapter String spinnerAdapter new ArrayAdapter getContext R layout list_item_spinner new String Spinner One Spinner Two Spinner Three Spinner Four Spinner Five Spinner Six spinnerAdapter setDropDownViewResource R layout list_item_spinner_dropdown spinnerView setAdapter spinnerAdapter @Override public void onDestroyView isDarkSubscription dispose unbinder unbind super onDestroyView @OnClick R id switch_theme public void onThemeChange SwitchCompat switchCompat if switchCompat isChecked Aesthetic get activityTheme R style AppThemeDark isDark true textColorPrimaryRes R color text_color_primary_dark textColorSecondaryRes R color text_color_secondary_dark apply else Aesthetic get activityTheme R style AppTheme isDark false textColorPrimaryRes R color text_color_primary textColorSecondaryRes R color text_color_secondary apply @OnClick R id btn_black R id btn_red R id btn_purple R id btn_blue R id btn_green R id btn_white public void onClickButton View view switch view getId case R id btn_black Aesthetic get colorPrimaryRes R color text_color_primary colorAccentRes R color md_purple colorStatusBarAuto colorNavigationBarAuto bottomNavigationBackgroundMode BottomNavBgMode PRIMARY_DARK bottomNavigationIconTextMode BottomNavIconTextMode BLACK_WHITE_AUTO apply break case R id btn_red Aesthetic get colorPrimaryRes R color md_red colorAccentRes R color md_amber colorStatusBarAuto colorNavigationBarAuto bottomNavigationBackgroundMode BottomNavBgMode PRIMARY_DARK bottomNavigationIconTextMode BottomNavIconTextMode BLACK_WHITE_AUTO apply break case R id btn_purple Aesthetic get colorPrimaryRes R color md_purple colorAccentRes R color md_lime colorStatusBarAuto colorNavigationBarAuto bottomNavigationBackgroundMode BottomNavBgMode PRIMARY_DARK bottomNavigationIconTextMode BottomNavIconTextMode BLACK_WHITE_AUTO apply break case R id btn_blue Aesthetic get colorPrimaryRes R color md_blue colorAccentRes R color md_pink colorStatusBarAuto colorNavigationBarAuto bottomNavigationBackgroundMode BottomNavBgMode PRIMARY_DARK bottomNavigationIconTextMode BottomNavIconTextMode BLACK_WHITE_AUTO apply break case R id btn_green Aesthetic get colorPrimaryRes R color md_green colorAccentRes R color md_blue_grey colorStatusBarAuto colorNavigationBarAuto bottomNavigationBackgroundMode BottomNavBgMode PRIMARY_DARK bottomNavigationIconTextMode BottomNavIconTextMode BLACK_WHITE_AUTO apply break case R id btn_white Aesthetic get colorPrimaryRes R color md_white colorAccentRes R color md_blue colorStatusBarAuto colorNavigationBarAuto bottomNavigationBackgroundMode BottomNavBgMode PRIMARY bottomNavigationIconTextMode BottomNavIconTextMode SELECTED_ACCENT apply break @OnClick R id fab public void onClickFab if snackbar null snackbar dismiss snackbar Snackbar make rootView R string hello_world Snackbar LENGTH_LONG snackbar setAction android R string cancel new View OnClickListener @Override public void onClick View view snackbar @@@ 1 61
package com afollestad aestheticsample import android content Context import android support v4 app Fragment import android support v4 app FragmentManager import android support v4 app FragmentStatePagerAdapter class MainPagerAdapter extends FragmentStatePagerAdapter private final Context context MainPagerAdapter Context context FragmentManager fm super fm this context context @Override public Fragment getItem int position return position 0 new MainFragment new SecondaryFragment @Override public int getCount return 2 @Override public CharSequence getPageTitle int position return context getString position 0 R string main R string @@@ 1 62
package com afollestad aestheticsample import android os Bundle import android support annotation Nullable import android support v7 widget LinearLayoutManager import android support v7 widget RecyclerView import android support v7 widget Toolbar import android view View import com afollestad aesthetic AestheticActivity import butterknife BindView import butterknife ButterKnife import butterknife Unbinder public class RecyclerViewActivity extends AestheticActivity @BindView R id toolbar Toolbar toolbar @BindView R id recycler_view RecyclerView recyclerView private Unbinder unbinder @Override protected void onCreate @Nullable Bundle savedInstanceState super onCreate savedInstanceState setContentView R layout activity_recyclerview unbinder ButterKnife bind this toolbar setNavigationOnClickListener new View OnClickListener @Override public void onClick View view finish recyclerView setLayoutManager new LinearLayoutManager this recyclerView setAdapter new MainAdapter @Override protected void onDestroy unbinder unbind super @@@ 1 63
package com afollestad aestheticsample import android content Intent import android os Bundle import android support annotation Nullable import android support v4 app Fragment import android view LayoutInflater import android view View import android view ViewGroup import butterknife ButterKnife import butterknife OnClick import butterknife Unbinder public class SecondaryFragment extends Fragment private Unbinder unbinder @Nullable @Override public View onCreateView LayoutInflater inflater @Nullable ViewGroup container @Nullable Bundle savedInstanceState return inflater inflate R layout fragment_secondary container false @Override public void onViewCreated View view @Nullable Bundle savedInstanceState super onViewCreated view savedInstanceState unbinder ButterKnife bind this view @Override public void onDestroyView unbinder unbind super onDestroyView @OnClick R id drawer_layout public void onClickDrawerLayout startActivity new Intent getActivity DrawerActivity class @OnClick R id coordinator_layout public void onClickCoordinatorlayout startActivity new Intent getActivity CoordinatorLayoutActivity class @OnClick R id bottom_tabs public void onClickBottomTabs startActivity new Intent getActivity BottomNavActivity class @OnClick R id recycler_view public void onClickRecyclerView startActivity new Intent getActivity RecyclerViewActivity @@@ 1 64
package cn nekocode resinspector example import android content Context import android support v7 app AppCompatActivity import android os Bundle import cn nekocode resinspector ResourceInspector public class MainActivity extends AppCompatActivity @Override protected void onCreate Bundle savedInstanceState super onCreate savedInstanceState setContentView R layout activity_main @Override protected void attachBaseContext Context newBase super attachBaseContext ResourceInspector wrap @@@ 3 65
package cn nekocode resinspector import android content Context public class ResourceInspector public static Context wrap Context base return @@@ 3 66
package cn nekocode resinspector import android content Context import android content res Resources import android graphics Canvas import android graphics Color import android graphics ColorFilter import android graphics Paint import android graphics Path import android graphics PixelFormat import android graphics drawable Drawable import android graphics drawable LayerDrawable import android os Build import android support annotation IntRange import android support annotation LayoutRes import android support annotation NonNull import android support annotation Nullable import android text TextPaint import android view LayoutInflater import android view View import android view ViewGroup public class ResourceInspector public static Context wrap Context base return new ContextWrapper base private static class ContextWrapper extends android content ContextWrapper private InspectorLayoutInflater inflater ContextWrapper Context base super base @Override public Object getSystemService String name if LAYOUT_INFLATER_SERVICE equals name if inflater null inflater new InspectorLayoutInflater LayoutInflater super getSystemService name this return inflater return super getSystemService name private static class InspectorLayoutInflater extends LayoutInflater private final LayoutInflater original private final String appPackageName InspectorLayoutInflater LayoutInflater original Context newContext super original newContext this original original appPackageName getContext getApplicationContext getPackageName @Override public LayoutInflater cloneInContext Context newContext return new InspectorLayoutInflater this original newContext @Override public View inflate @LayoutRes int resource @Nullable ViewGroup root boolean attachToRoot final Resources res getContext getResources final String packageName res getResourcePackageName resource final String resName res getResourceEntryName resource final View view original inflate resource root attachToRoot if appPackageName equals packageName return view View targetView view if root null attachToRoot targetView root getChildAt root getChildCount 1 if Build VERSION SDK_INT Build VERSION_CODES M final Drawable foreground targetView getForeground if foreground null targetView setForeground new TipDrawable resName else targetView setForeground new LayerDrawable new Drawable foreground new TipDrawable resName else final Drawable background targetView getBackground if background null if Build VERSION SDK_INT Build VERSION_CODES JELLY_BEAN targetView setBackground new TipDrawable resName else targetView setBackgroundDrawable new TipDrawable resName else if Build VERSION SDK_INT Build VERSION_CODES JELLY_BEAN targetView setBackground new LayerDrawable new Drawable background new TipDrawable resName else targetView setBackgroundDrawable new LayerDrawable new Drawable background new TipDrawable resName return view private static class TipDrawable extends Drawable private static final float TEXT_SIZE sp2px 10 private static final float PADDING dp2px 4 private static final float BOUNDARY_WIDTH dp2px 2 private static final Paint paint new TextPaint private static final Path path new Path private static final Path path2 new Path private final String text private final float textWidth textHeight private final float tcx tcy private int alpha 200 static paint setAntiAlias true paint setTextSize TEXT_SIZE paint setTextAlign Paint Align CENTER TipDrawable String text this text text final Paint FontMetrics fontMetrics paint getFontMetrics textWidth paint measureText text PADDING 2f textHeight TEXT_SIZE PADDING 2f tcx textWidth 2f tcy textHeight 2f fontMetrics bottom fontMetrics top 2f @Override public void draw @NonNull Canvas canvas final float left 0f top 0f right canvas getWidth bottom canvas getHeight path reset path moveTo left top path lineTo right top path lineTo right bottom path lineTo left bottom path close if Build VERSION SDK_INT Build VERSION_CODES KITKAT path2 reset path2 moveTo left BOUNDARY_WIDTH top BOUNDARY_WIDTH path2 lineTo right BOUNDARY_WIDTH top BOUNDARY_WIDTH path2 lineTo right BOUNDARY_WIDTH bottom BOUNDARY_WIDTH path2 lineTo left BOUNDARY_WIDTH bottom BOUNDARY_WIDTH path2 close path op path2 Path Op DIFFERENCE path2 reset path2 moveTo left top path2 lineTo left textWidth top path2 lineTo left textWidth top textHeight path2 lineTo left top textHeight path2 close path op path2 Path Op UNION paint setColor Color BLACK paint setAlpha int alpha 0 5f paint setStyle Paint Style FILL canvas drawPath path paint else paint setColor Color BLACK paint setAlpha int alpha 0 5f paint setStrokeWidth BOUNDARY_WIDTH 2 paint setStyle Paint Style STROKE canvas drawPath path paint paint setStyle Paint Style FILL canvas drawRect left top left textWidth top textHeight paint paint setColor Color WHITE paint setAlpha alpha canvas drawText text left tcx top tcy paint @Override public void setAlpha @IntRange from 0 to 255 int alpha this alpha alpha @Override public void setColorFilter @Nullable ColorFilter colorFilter @Override public int getOpacity return PixelFormat TRANSLUCENT private static float dp2px float dipValue final float scale Resources getSystem getDisplayMetrics density return dipValue scale 0 5f private static float sp2px float spValue final float fontScale Resources getSystem getDisplayMetrics scaledDensity return spValue fontScale 0 @@@ 3 67
package com jpokemon interactioneditor import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import javax swing JLabel import javax swing JPanel import org jpokemon interaction ActionData import org jpokemon item ItemInfo import org jpokemon item Store import org jpokemon trainer Event import com jpokemon util FeedbackInputField import com jpokemon util ui selector ActionTypeSelector import com jpokemon util ui selector EventSelector import com jpokemon util ui selector ItemSelector import com jpokemon util ui selector StoreSelector public class ActionPanel extends JPanel private ActionData actionData private JPanel extraPanel new JPanel private ActionTypeSelector actionTypeSelector new ActionTypeSelector private boolean atomicOperationFlag false private EventSelector eventSelector private ItemSelector itemSelector private StoreSelector storeSelector private FeedbackInputField extraTextField private static final long serialVersionUID 1L public ActionPanel ActionData a actionData a buildActionTypeSelector add new JLabel actionData getId in actionData getActionsetId add actionTypeSelector add extraPanel onActionTypeChange protected void buildActionTypeSelector actionTypeSelector reload actionTypeSelector setSelectedItem actionData getAction actionTypeSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 if atomicOperationFlag return onActionTypeChange protected void onActionTypeChange String action String actionTypeSelector getSelectedItem actionData setAction action commit extraPanel removeAll if event equals action buildEventAction else if item equals action buildItemAction else if store equals action buildStoreAction else if dresser equals action repaint protected void buildEventAction int eventId 1 try eventId Integer parseInt actionData getOptions catch NumberFormatException e actionData setOptions 1 actionData commit if eventSelector null eventSelector new EventSelector eventSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 if atomicOperationFlag return onEventChange atomicOperationFlag true eventSelector reload eventSelector setSelectedItem Event get eventId atomicOperationFlag false extraPanel add eventSelector protected void onEventChange int eventId Event eventSelector getSelectedItem getNumber actionData setOptions eventId actionData commit protected void buildItemAction int itemId 1 quantity 1 try String pieces actionData getOptions split itemId Integer parseInt pieces 0 quantity Integer parseInt pieces 1 catch Exception e actionData setOptions itemId quantity actionData commit if itemSelector null itemSelector new ItemSelector itemSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 if atomicOperationFlag return onItemChange extraTextField new FeedbackInputField extraTextField setPreferredSize new Dimension 20 20 extraTextField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onQuantityChange atomicOperationFlag true itemSelector reload itemSelector setSelectedItem ItemInfo get itemId extraTextField setSavedValue quantity extraTextField setText quantity atomicOperationFlag false extraPanel add extraTextField extraPanel add new JLabel x extraPanel add itemSelector protected void onItemChange int itemId ItemInfo itemSelector getSelectedItem getId String quantity extraTextField getSavedValue actionData setOptions itemId quantity actionData commit protected void onQuantityChange int quantity 1 try quantity Integer parseInt extraTextField getText catch NumberFormatException e extraTextField setText quantity extraTextField setSavedValue quantity int itemId ItemInfo itemSelector getSelectedItem getId actionData setOptions itemId quantity actionData commit protected void buildStoreAction int storeId 1 try storeId Integer parseInt actionData getOptions catch NumberFormatException e actionData setOptions 1 actionData commit if storeSelector null storeSelector new StoreSelector storeSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 if atomicOperationFlag return onStoreChange atomicOperationFlag true storeSelector reload storeSelector setSelectedItem Store get storeId atomicOperationFlag false extraPanel add storeSelector protected void onStoreChange int storeId Store storeSelector getCurrentElement getId actionData setOptions storeId actionData @@@ 4 68
package com jpokemon interactioneditor import java awt BorderLayout import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import java util ArrayList import java util List import javax swing BoxLayout import javax swing JButton import javax swing JComboBox import javax swing JFrame import javax swing JLabel import javax swing JOptionPane import javax swing JPanel import javax swing JScrollPane import org jpokemon interaction ActionData import org jpokemon interaction ActionSet import org jpokemon interaction RequirementData import com jpokemon util FeedbackInputField public class InteractionEditor extends JFrame private List ActionSet actionSets private boolean atomicOperationFlag false private JLabel actionSetIdsLabel new JLabel ActionSets private JPanel centerPanel new JPanel northPanel new JPanel southPanel new JPanel private JPanel actionsPanel new JPanel private JPanel requirementsPanel new JPanel private FeedbackInputField nameField new FeedbackInputField private JComboBox String contextCombobox new JComboBox String private JComboBox String optionCombobox new JComboBox String private static final String viewAllText Show All private static final long serialVersionUID 1L public InteractionEditor super Interaction Editor buildNorthPanel buildSouthPanel setLayout new BorderLayout add northPanel BorderLayout NORTH add southPanel BorderLayout SOUTH buildCenterPanel JScrollPane scrollPane new JScrollPane centerPanel add scrollPane BorderLayout CENTER pack setVisible true setDefaultCloseOperation DISPOSE_ON_CLOSE protected void buildNorthPanel nameField setPreferredSize new Dimension 120 25 nameField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onNameChange northPanel add new JLabel entity northPanel add nameField contextCombobox setEditable true contextCombobox addActionListener new ActionListener public void actionPerformed ActionEvent arg0 if atomicOperationFlag arg0 getActionCommand equals comboBoxEdited return onContextChange northPanel add new JLabel context northPanel add contextCombobox optionCombobox setEditable true optionCombobox addActionListener new ActionListener public void actionPerformed ActionEvent arg0 if atomicOperationFlag arg0 getActionCommand equals comboBoxEdited return onOptionChange northPanel add new JLabel option name northPanel add optionCombobox protected void onNameChange String name nameField getText nameField setSavedValue name actionSets ActionSet get name atomicOperationFlag true fillContextCombobox fillOptionCombobox atomicOperationFlag false fillActionsAndRequirements protected void onContextChange String name nameField getSavedValue String context String contextCombobox getSelectedItem if context null context isEmpty context equals viewAllText actionSets ActionSet get name else actionSets ActionSet get context name atomicOperationFlag true fillOptionCombobox atomicOperationFlag false fillActionsAndRequirements protected void onOptionChange String name nameField getSavedValue String context String contextCombobox getSelectedItem String option String optionCombobox getSelectedItem if option null option isEmpty optionCombobox setSelectedItem option viewAllText if context null context isEmpty contextCombobox setSelectedItem context viewAllText if viewAllText equals context actionSets ActionSet get context name else actionSets ActionSet get name if viewAllText equals option filterActionSets option if actionSets isEmpty if name null name isEmpty viewAllText equals context return new ActionSet setName name setContext context setOption option commit actionSets ActionSet get context name filterActionSets option fillActionsAndRequirements protected void buildSouthPanel JButton addActionButton new JButton Add Action addActionButton addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onAddAction southPanel add addActionButton JButton addRequirementButton new JButton Add Requirement addRequirementButton addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onAddRequirement southPanel add addRequirementButton protected void onAddAction if actionSets size 1 JOptionPane showMessageDialog this Please filter a single actionset to add this action to return int actionSetId actionSets get 0 getId new ActionData setActionsetId actionSetId setAction undefined commit fillActionsAndRequirements protected void onAddRequirement if actionSets size 1 JOptionPane showMessageDialog this Please filter a single actionset to add this requirement to return int actionSetId actionSets get 0 getId new RequirementData setActionsetId actionSetId setRequirement undefined commit fillActionsAndRequirements protected void buildCenterPanel centerPanel setLayout new BoxLayout centerPanel BoxLayout Y_AXIS centerPanel add actionSetIdsLabel JPanel jp new JPanel jp setLayout new BoxLayout jp BoxLayout X_AXIS centerPanel add jp actionsPanel setLayout new BoxLayout actionsPanel BoxLayout Y_AXIS jp add actionsPanel requirementsPanel setLayout new BoxLayout requirementsPanel BoxLayout Y_AXIS jp add requirementsPanel protected void filterActionSets String option ActionSet foundActionSet null for ActionSet actionSet actionSets if actionSet getOption equals option foundActionSet actionSet break actionSets new ArrayList ActionSet if foundActionSet null actionSets add foundActionSet protected void fillContextCombobox List String contexts new ArrayList String for ActionSet actionSet actionSets if contexts contains actionSet getContext contexts add actionSet getContext contextCombobox removeAllItems contextCombobox addItem viewAllText for String context contexts contextCombobox addItem context protected void fillOptionCombobox optionCombobox removeAllItems optionCombobox addItem viewAllText for ActionSet actionSet actionSets optionCombobox addItem actionSet getOption protected void fillActionsAndRequirements List Integer actionSetIds new ArrayList Integer actionsPanel removeAll actionsPanel add new JLabel Actions requirementsPanel removeAll requirementsPanel add new JLabel Requirements for ActionSet actionSet actionSets for ActionData actionData ActionData get actionSet getId actionsPanel add new ActionPanel actionData for RequirementData requirementData RequirementData get actionSet getId requirementsPanel add new RequirementPanel requirementData actionSetIds add actionSet getId actionSetIdsLabel setText ActionSet IDs actionSetIds @@@ 4 69
package com jpokemon interactioneditor import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import javax swing JLabel import javax swing JPanel import org jpokemon interaction RequirementData import org jpokemon trainer Event import com jpokemon util FeedbackInputField import com jpokemon util ui selector EventSelector import com jpokemon util ui selector RequirementTypeSelector public class RequirementPanel extends JPanel private RequirementData requirementData private JPanel extraPanel new JPanel private RequirementTypeSelector requirementTypeSelector new RequirementTypeSelector private boolean atomicOperationFlag false private EventSelector eventSelector private FeedbackInputField pokedexCountField private static final long serialVersionUID 1L public RequirementPanel RequirementData r requirementData r buildRequirementTypeSelector add new JLabel requirementData getId in requirementData getActionsetId add requirementTypeSelector add extraPanel onRequirementTypeChange protected void buildRequirementTypeSelector requirementTypeSelector reload requirementTypeSelector setSelectedItem requirementData getRequirement requirementTypeSelector addActionListener new ActionListener public void actionPerformed ActionEvent e onRequirementTypeChange protected void onRequirementTypeChange String requirement String requirementTypeSelector getSelectedItem requirementData setRequirement requirement commit extraPanel removeAll if event equals requirement buildEventRequirement else if pokedex equals requirement buildPokedexRequirement revalidate protected void buildEventRequirement int eventId 1 try eventId Integer parseInt requirementData getOptions catch NumberFormatException e requirementData setOptions 1 requirementData commit if eventSelector null eventSelector new EventSelector eventSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 if atomicOperationFlag return onEventChange atomicOperationFlag true eventSelector reload eventSelector setSelectedItem Event get eventId atomicOperationFlag false extraPanel add eventSelector protected void onEventChange int eventId Event eventSelector getSelectedItem getNumber requirementData setOptions eventId requirementData commit protected void buildPokedexRequirement int pokedexCount 0 try pokedexCount Integer parseInt requirementData getOptions catch NumberFormatException e requirementData setOptions 0 requirementData commit if pokedexCountField null pokedexCountField new FeedbackInputField pokedexCountField setPreferredSize new Dimension 40 20 pokedexCountField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onPokedexCountChange pokedexCountField setSavedValue pokedexCount pokedexCountField setText pokedexCount extraPanel add pokedexCountField protected void onPokedexCountChange try int pokedexCount Integer parseInt pokedexCountField getText requirementData setOptions pokedexCount requirementData commit pokedexCountField setSavedValue pokedexCount catch NumberFormatException e pokedexCountField setText pokedexCountField @@@ 4 70
package com jpokemon mapeditor import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import javax swing JButton import javax swing JPanel import javax swing JTextField import org jpokemon trainer Event import com jpokemon util ui button JPokemonButton import com jpokemon util ui selector EventSelector public class EventEditor implements MapEditComponent public static final String BUTTON_NAME Events public EventEditor JButton newEvent new JPokemonButton New newEvent addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onClickNewEvent editorPanel add newEvent eventSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onEventSelect editorPanel add eventSelector descriptionField setPreferredSize new Dimension 160 20 descriptionField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onDescriptionFieldEnter editorPanel add descriptionField @Override public JPanel getEditor readyToEdit false eventSelector reload if eventSelector getCurrentElement null descriptionField setText eventSelector getCurrentElement getDescription readyToEdit true return editorPanel @Override public Dimension getSize return new Dimension 200 100 private void onClickNewEvent Event createNew getEditor private void onEventSelect if readyToEdit return getEditor private void onDescriptionFieldEnter if readyToEdit return Event event eventSelector getCurrentElement String description descriptionField getText event setDescription description event commit getEditor private boolean readyToEdit false private JPanel editorPanel new JPanel private JTextField descriptionField new JTextField private EventSelector eventSelector new @@@ 4 71
package com jpokemon mapeditor import java awt Dimension import javax swing JPanel public interface MapEditComponent public JPanel getEditor public Dimension @@@ 4 72
package com jpokemon mapeditor import java awt BorderLayout import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import java util HashMap import java util Map import javax swing JButton import javax swing JFrame import javax swing JPanel public class MapEditWindow extends JFrame public MapEditWindow components put WildPokemonEditor BUTTON_NAME new WildPokemonEditor components put EventEditor BUTTON_NAME new EventEditor setLayout new BorderLayout JPanel sectionPanel new JPanel for String component components keySet sectionPanel add new ComponentButton component add sectionPanel BorderLayout NORTH setDefaultCloseOperation DISPOSE_ON_CLOSE setSize MINIMUM_WIDTH 80 setVisible true private void onClickComponentButton String name if currentView null remove currentView MapEditComponent mec components get name if mec null currentView mec getEditor add currentView BorderLayout CENTER Dimension d mec getSize d setSize Math max d width MINIMUM_WIDTH d height 80 setSize d repaint private class ComponentButton extends JButton implements ActionListener public ComponentButton String name super name addActionListener this public void actionPerformed ActionEvent arg0 onClickComponentButton getText private static final long serialVersionUID 1L private JPanel currentView null private Map String MapEditComponent components new HashMap String MapEditComponent private static final int MINIMUM_WIDTH 1140 private static final long serialVersionUID @@@ 4 73
package com jpokemon mapeditor import java awt BorderLayout import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import javax swing BoxLayout import javax swing JButton import javax swing JCheckBox import javax swing JLabel import javax swing JPanel import javax swing JTextField import com jpokemon util ui ImageLoader import com jpokemon util ui button JPokemonButton import com jpokemon util ui selector NPCSelector import com jpokemon util ui selector NPCTypeSelector public class NPCEditor implements MapEditComponent public static final String BUTTON_NAME NPCs public NPCEditor JPanel northPanel new JPanel npcSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onClickSelectNPC northPanel add npcSelector JButton newNPC new JPokemonButton New newNPC addActionListener new ActionListener public void actionPerformed ActionEvent arg0 NPCEditor this onClickNewNPC northPanel add newNPC JPanel eastPanel new JPanel eastPanel setLayout new BoxLayout eastPanel BoxLayout Y_AXIS eastPanel add new JPanel npcTypeSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onClickNPCType eastPanel add npcTypeSelector eastPanel add new JPanel JPanel centerPanel new JPanel centerPanel setLayout new BoxLayout centerPanel BoxLayout Y_AXIS centerPanel add new JPanel centerPanel add iconLabel centerPanel add new JPanel JPanel nameAndTypeName new JPanel nameAndTypeName setLayout new BoxLayout nameAndTypeName BoxLayout X_AXIS nameAndTypeName add typeNameLabel nameField setMinimumSize new Dimension 75 16 nameField setMaximumSize new Dimension 75 16 nameField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onEnterNewNPCName nameAndTypeName add nameField useTypePrefix addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onClickUseTypePrefix nameAndTypeName add useTypePrefix centerPanel add nameAndTypeName centerPanel add new JPanel editorPanel setLayout new BorderLayout editorPanel add northPanel BorderLayout NORTH editorPanel add eastPanel BorderLayout EAST editorPanel add centerPanel BorderLayout CENTER @Override public JPanel getEditor readyToEdit false npcSelector reload npcTypeSelector reload iconLabel setIcon ImageLoader npc npcSelector getCurrentElement getIcon if npcSelector getCurrentElement getName contains typename useTypePrefix setSelected true typeNameLabel setText npcSelector getCurrentElement getNPCType getName else useTypePrefix setSelected false typeNameLabel setText null nameField setText npcSelector getCurrentElement getName replaceAll typename readyToEdit true return editorPanel @Override public Dimension getSize return new Dimension 480 120 private void onClickSelectNPC if readyToEdit return getEditor private void onClickNewNPC NPC createNew getEditor private void onEnterNewNPCName if readyToEdit return String name nameField getText if useTypePrefix isSelected name typename name npcSelector getCurrentElement setName name commitChange getEditor private void onClickNPCType if readyToEdit return npcSelector getCurrentElement setType npcTypeSelector getCurrentElement getNumber commitChange getEditor private void onClickUseTypePrefix if readyToEdit return NPC currentNPC npcSelector getCurrentElement if useTypePrefix isSelected currentNPC setName typename currentNPC getName else currentNPC setName currentNPC getName replaceAll typename commitChange getEditor private void commitChange npcSelector getCurrentElement commit private boolean readyToEdit false private JPanel editorPanel new JPanel private JTextField nameField new JTextField private NPCSelector npcSelector new NPCSelector private NPCTypeSelector npcTypeSelector new NPCTypeSelector private JLabel typeNameLabel new JLabel iconLabel new JLabel private JCheckBox useTypePrefix new JCheckBox Use type prefix @@@ 4 74
package com jpokemon mapeditor import java awt BorderLayout import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import java util ArrayList import java util List import javax swing BoxLayout import javax swing JButton import javax swing JComboBox import javax swing JLabel import javax swing JPanel import javax swing JTextField import com jpokemon util ui ImageLoader @SuppressWarnings rawtypes unchecked public class NPCTypeEditor implements MapEditComponent public static final String BUTTON_NAME NPC Types public NPCTypeEditor JPanel northPanel new JPanel npcTypes addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onClickSelectNPCType northPanel add npcTypes JButton newNPCType new JButton New newNPCType addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onClickNewNPCType northPanel add newNPCType JPanel centerPanel new JPanel centerPanel setLayout new BoxLayout centerPanel BoxLayout Y_AXIS centerPanel add icon JPanel nameAndLabel new JPanel nameAndLabel add new JLabel Type name nameField setMinimumSize new Dimension 75 16 nameField setMaximumSize new Dimension 75 16 nameField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onEnterNewName nameAndLabel add nameField centerPanel add nameAndLabel JPanel iconNameAndLabel new JPanel iconNameAndLabel add new JLabel Icon path iconNameField setMinimumSize new Dimension 75 16 iconNameField setMaximumSize new Dimension 75 16 iconNameField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onEnterNewIconPath iconNameAndLabel add iconNameField centerPanel add iconNameAndLabel editorPanel setLayout new BorderLayout editorPanel add northPanel BorderLayout NORTH editorPanel add centerPanel BorderLayout CENTER @Override public JPanel getEditor readyToEdit false NPCType npcType npcTypes removeAllItems allNPCTypes clear for int i 1 npcType NPCType get i null i npcTypes addItem npcType toString allNPCTypes add npcType if allNPCTypes size currentTypeIndex currentNPCType allNPCTypes get currentTypeIndex npcTypes setSelectedIndex currentTypeIndex icon setIcon ImageLoader npc currentNPCType getIcon nameField setText currentNPCType getName iconNameField setText currentNPCType getIcon readyToEdit true return editorPanel @Override public Dimension getSize return new Dimension 460 120 private void onClickSelectNPCType if readyToEdit return currentTypeIndex npcTypes getSelectedIndex getEditor private void onClickNewNPCType currentNPCType NPCType createNew currentTypeIndex npcTypes getItemCount getEditor private void onEnterNewName if readyToEdit return currentNPCType setName nameField getText commitChange getEditor private void onEnterNewIconPath if readyToEdit return currentNPCType setIcon iconNameField getText commitChange getEditor private void commitChange currentNPCType commit private NPCType currentNPCType private int currentTypeIndex 0 private boolean readyToEdit false private JLabel icon new JLabel private JPanel editorPanel new JPanel private JComboBox npcTypes new JComboBox private List NPCType allNPCTypes new ArrayList NPCType private JTextField nameField new JTextField iconNameField new @@@ 4 75
package com jpokemon mapeditor import java awt BorderLayout import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import javax swing BoxLayout import javax swing JButton import javax swing JLabel import javax swing JPanel import javax swing JTextField import org jpokemon overworld WildPokemon import com jpokemon util ui button JPokemonButton import com jpokemon util ui selector PokemonInfoSelector import com njkremer Sqlite DataConnectionException import com njkremer Sqlite SqlStatement public class WildPokemonEditor implements MapEditComponent public static final String BUTTON_NAME Wild Pokemon public WildPokemonEditor JPanel northPanel new JPanel southPanel new JPanel JPanel namePanel new JPanel northPanel add namePanel mapNameTextField setMinimumSize new Dimension 100 16 mapNameTextField setMaximumSize new Dimension 100 16 mapNameTextField setPreferredSize new Dimension 100 16 mapNameTextField addActionListener new LoadAreaHandler namePanel add mapNameTextField JPanel buttonPanel new JPanel buttonPanel setLayout new BoxLayout buttonPanel BoxLayout X_AXIS southPanel add buttonPanel JButton addRow new JPokemonButton Add Row addRow addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onSelectAddRow buttonPanel add addRow editorPanel setLayout new BorderLayout editorPanel add northPanel BorderLayout NORTH editorPanel add childContainer BorderLayout CENTER editorPanel add southPanel BorderLayout SOUTH @Override public JPanel getEditor readyToEdit false mapNameTextField setText currentMapName childContainer removeAll for WildPokemon wildPokemon WildPokemon get currentMapName childContainer add new WildPokemonPanel wildPokemon editorPanel validate readyToEdit true return editorPanel @Override public Dimension getSize return new Dimension 480 480 private void onSelectAddRow if readyToEdit return WildPokemon wildPokemon new WildPokemon wildPokemon setMap currentMapName try SqlStatement insert wildPokemon execute catch DataConnectionException e e printStackTrace getEditor private boolean readyToEdit false private String currentMapName null private JTextField mapNameTextField new JTextField private JPanel editorPanel new JPanel childContainer new JPanel private class LoadAreaHandler implements ActionListener @Override public void actionPerformed ActionEvent e currentMapName mapNameTextField getText getEditor private class WildPokemonPanel extends JPanel public WildPokemonPanel WildPokemon wp wildPokemon wp pokemonInfoSelector reload pokemonInfoSelector setSelectedIndex wp getNumber 1 pokemonInfoSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onSelectPokemonSelector levelMinField setText wp getLevelmin levelMinField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onSelectLevelMinField levelMaxField setText wp getLevelmax levelMaxField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onSelectLevelMaxField flexField setText wp getFlex flexField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onSelectFlexField add pokemonInfoSelector add new JPanel add new JLabel Levels add levelMinField add new JLabel add levelMaxField add new JPanel add new JLabel Flex add flexField private void onSelectPokemonSelector int oldNumber wildPokemon getNumber int newNumber pokemonInfoSelector getCurrentElement getNumber wildPokemon setNumber newNumber try SqlStatement update wildPokemon where map eq wildPokemon getMap and number eq oldNumber execute catch DataConnectionException e e printStackTrace getEditor private void onSelectLevelMinField int newLevelMin Integer parseInt levelMinField getText wildPokemon setLevelmin newLevelMin try SqlStatement update wildPokemon where map eq wildPokemon getMap and number eq wildPokemon getNumber execute catch DataConnectionException e e printStackTrace getEditor private void onSelectLevelMaxField int newLevelMax Integer parseInt levelMaxField getText wildPokemon setLevelmax newLevelMax try SqlStatement update wildPokemon where map eq wildPokemon getMap and number eq wildPokemon getNumber execute catch DataConnectionException e e printStackTrace getEditor private void onSelectFlexField int newFlex Integer parseInt flexField getText wildPokemon setFlex newFlex try SqlStatement update wildPokemon where map eq wildPokemon getMap and number eq wildPokemon getNumber execute catch DataConnectionException e e printStackTrace getEditor private WildPokemon wildPokemon private JTextField flexField new JTextField private JTextField levelMinField new JTextField private JTextField levelMaxField new JTextField private PokemonInfoSelector pokemonInfoSelector new PokemonInfoSelector private static final long serialVersionUID @@@ 4 76
package com jpokemon savefilegenerator import java awt BorderLayout import java awt event MouseAdapter import java awt event MouseEvent import javax swing JLabel import javax swing JPanel import org jpokemon pokemon Pokemon import com jpokemon util ui ImageLoader public class OwnedPokemonPanel extends JPanel public OwnedPokemonPanel PartyEditorPanel pep Pokemon p super new BorderLayout parent pep pokemon p add new JLabel ImageLoader pokemon p number BorderLayout WEST add new JLabel p name Lvl p level BorderLayout CENTER editButton addMouseListener new EditHandler add editButton BorderLayout EAST private Pokemon pokemon private PartyEditorPanel parent private JLabel editButton new JLabel ImageLoader find ui arrow_right private static final long serialVersionUID 1L private class EditHandler extends MouseAdapter @Override public void mouseClicked MouseEvent e parent showEditPokemon @@@ 4 77
package com jpokemon savefilegenerator import java awt BorderLayout import java awt Dimension import java awt event MouseAdapter import java awt event MouseEvent import javax swing BoxLayout import javax swing JLabel import javax swing JPanel import javax swing JScrollPane import org jpokemon pokemon Pokemon import org jpokemon pokemon PokemonInfo import com jpokemon util ui ImageLoader public class PartyEditorPanel extends JPanel public static int defaultlevel 25 public PartyEditorPanel SaveGeneratorWindow sgw super new BorderLayout parent sgw JPanel bodyPanel new JPanel bodyPanel setLayout new BorderLayout bodyPanel setPreferredSize new Dimension 250 300 add bodyPanel BorderLayout CENTER bodyPanel add new JLabel Party BorderLayout NORTH partyPanel setLayout new BoxLayout partyPanel BoxLayout Y_AXIS JScrollPane scrollPane new JScrollPane partyPanel bodyPanel add scrollPane BorderLayout CENTER JPanel southPanel new JPanel bodyPanel add southPanel BorderLayout SOUTH showAddPokemon addMouseListener new AddPokemonHandler southPanel add showAddPokemon public void showEditPokemon Pokemon p remove pokemonSelectorPanel add pokemonDetailsPanel BorderLayout EAST pokemonDetailsPanel show p callParentRefresh public void showAddPokemon remove pokemonDetailsPanel add pokemonSelectorPanel BorderLayout EAST callParentRefresh public void addPokemon PokemonInfo pi Pokemon pokemon new Pokemon pi getNumber defaultlevel parent getPlayer add pokemon callParentRefresh public void removePokemon Pokemon p parent getPlayer party remove p callParentRefresh public void callParentRefresh parent refresh public void refresh partyPanel removeAll for Pokemon p parent getPlayer party partyPanel add new OwnedPokemonPanel this p private SaveGeneratorWindow parent private JPanel partyPanel new JPanel private JLabel showAddPokemon new JLabel ImageLoader find ui plus private PokemonDetailsPanel pokemonDetailsPanel new PokemonDetailsPanel this private PokemonSearchPanel pokemonSelectorPanel new PokemonSearchPanel this public static final long serialVersionUID 1L private class AddPokemonHandler extends MouseAdapter @Override public void mousePressed MouseEvent e @@@ 4 78
package com jpokemon savefilegenerator import java awt Dimension import java awt event MouseAdapter import java awt event MouseEvent import javax swing BoxLayout import javax swing JLabel import javax swing JPanel import com jpokemon util ui ImageLoader public class PlayerDetailsPanel extends JPanel public PlayerDetailsPanel SaveGeneratorWindow sgw super parent sgw setLayout new BoxLayout this BoxLayout Y_AXIS setPreferredSize new Dimension 200 300 add usernameLabel add cashLabel add badgeLabel JPanel playerPanel new JPanel playerPanel setLayout new BoxLayout playerPanel BoxLayout X_AXIS playerPanel add new JLabel Edit player editPlayer addMouseListener new EditPlayerHandler playerPanel add editPlayer add playerPanel JPanel partyPanel new JPanel partyPanel setLayout new BoxLayout partyPanel BoxLayout X_AXIS partyPanel add new JLabel Edit party editParty addMouseListener new EditPartyHandler partyPanel add editParty add partyPanel JPanel downloadPanel new JPanel saveFile addMouseListener new SaveHandler downloadPanel add saveFile add downloadPanel refresh public void refresh usernameLabel setText name parent getPlayer id cashLabel setText cash parent getPlayer getCash badgeLabel setText badges parent getPlayer getBadgeCount private SaveGeneratorWindow parent private JLabel usernameLabel new JLabel private JLabel cashLabel new JLabel private JLabel badgeLabel new JLabel private JLabel editParty new JLabel ImageLoader find ui arrow_right private JLabel editPlayer new JLabel ImageLoader find ui arrow_right private JLabel saveFile new JLabel ImageLoader find ui download public static final long serialVersionUID 1L private class EditPartyHandler extends MouseAdapter @Override public void mouseClicked MouseEvent e parent toggleEditParty private class EditPlayerHandler extends MouseAdapter @Override public void mouseClicked MouseEvent e parent toggleEditPlayer private class SaveHandler extends MouseAdapter @Override public void mouseClicked MouseEvent e parent @@@ 4 79
package com jpokemon savefilegenerator import java awt Dimension import javax swing BoxLayout import javax swing JLabel import javax swing JPanel import javax swing JTextField import com jpokemon savefilegenerator input SetBadgeHandler import com jpokemon savefilegenerator input SetCashHandler import com jpokemon savefilegenerator input SetNameHandler public class PlayerEditorPanel extends JPanel public PlayerEditorPanel SaveGeneratorWindow sgw super setLayout new BoxLayout this BoxLayout Y_AXIS setPreferredSize new Dimension 200 300 JPanel namePanel new JPanel namePanel setLayout new BoxLayout namePanel BoxLayout X_AXIS namePanel add new JLabel Username JTextField nameField new JTextField nameField setMinimumSize new Dimension 100 16 nameField setMaximumSize new Dimension 100 16 nameField getDocument addDocumentListener new SetNameHandler sgw nameField namePanel add nameField add namePanel JPanel cashPanel new JPanel cashPanel setLayout new BoxLayout cashPanel BoxLayout X_AXIS cashPanel add new JLabel Cash JTextField cashField new JTextField cashField setMinimumSize new Dimension 100 16 cashField setMaximumSize new Dimension 100 16 cashField getDocument addDocumentListener new SetCashHandler sgw cashField cashPanel add cashField add cashPanel JPanel badgePanel new JPanel badgePanel setLayout new BoxLayout badgePanel BoxLayout X_AXIS badgePanel add new JLabel Badges JTextField badgeField new JTextField badgeField setMinimumSize new Dimension 100 16 badgeField setMaximumSize new Dimension 100 16 badgeField getDocument addDocumentListener new SetBadgeHandler sgw badgeField badgePanel add badgeField add badgePanel public static final long serialVersionUID @@@ 4 80
package com jpokemon savefilegenerator import java awt BorderLayout import java awt Component import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import java awt event MouseAdapter import java awt event MouseEvent import javax swing BoxLayout import javax swing JLabel import javax swing JPanel import javax swing JTextField import org jpokemon pokemon Pokemon import org jpokemon pokemon move MoveBlock import org jpokemon pokemon move MoveInfo import org jpokemon pokemon move MoveMap import com jpokemon util ui ImageLoader import com jpokemon util ui JPokemonSelector public class PokemonDetailsPanel extends JPanel public PokemonDetailsPanel PartyEditorPanel pep super new BorderLayout parent pep JPanel detailsPanel new JPanel detailsPanel setLayout new BoxLayout detailsPanel BoxLayout Y_AXIS add detailsPanel BorderLayout CENTER detailsPanel add new JPanel JPanel namePanel new JPanel namePanel setLayout new BoxLayout namePanel BoxLayout X_AXIS namePanel add new JLabel Name nameField setPreferredSize new Dimension 100 16 nameField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 setName namePanel add nameField detailsPanel add namePanel detailsPanel add new JPanel JPanel levelPanel new JPanel levelPanel setLayout new BoxLayout levelPanel BoxLayout X_AXIS levelPanel add new JLabel Level levelField setPreferredSize new Dimension 100 16 levelField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 setLevel levelPanel add levelField detailsPanel add levelPanel detailsPanel add new JPanel movePanel setLayout new BoxLayout movePanel BoxLayout Y_AXIS detailsPanel add movePanel detailsPanel add new JPanel JPanel southPanel new JPanel add southPanel BorderLayout SOUTH deletePokemon addMouseListener new DeletePokemonHandler southPanel add deletePokemon public void show Pokemon p pokemon p nameField setText pokemon name levelField setText pokemon level movePanel removeAll AvailableMoveSelector ams MoveInfo amsValue for int i 0 i MoveBlock movecount i ams new AvailableMoveSelector ams reload amsValue null if i pokemon moveCount amsValue MoveInfo get pokemon move i number ams setSelectedItem amsValue ams addActionListener new ActionListener public void actionPerformed ActionEvent arg0 setMoves movePanel add ams private void setName if pokemon null return String name nameField getText if name isEmpty name null pokemon name name parent callParentRefresh private void setLevel if pokemon null return String level levelField getText if level isEmpty return pokemon level Integer parseInt level parent callParentRefresh private void setMoves pokemon removeAllMoves MoveInfo mi AvailableMoveSelector ams for Component c movePanel getComponents if c instanceof AvailableMoveSelector continue ams AvailableMoveSelector c mi ams getCurrentElement if mi null continue try pokemon addMove mi getNumber catch IllegalArgumentException e ams setSelectedItem null private Pokemon pokemon private PartyEditorPanel parent private JPanel movePanel new JPanel private JTextField nameField new JTextField private JTextField levelField new JTextField private JLabel deletePokemon new JLabel ImageLoader find ui minus private class DeletePokemonHandler extends MouseAdapter @Override public void mouseClicked MouseEvent e parent removePokemon pokemon private class AvailableMoveSelector extends JPokemonSelector MoveInfo @Override protected void reloadItems removeAllItems for MoveMap movemap MoveMap get pokemon number addElementToModel MoveInfo get movemap getMove_number protected void renderElement Component c MoveInfo element JLabel c setText element getName private static final long serialVersionUID 1L private static final long serialVersionUID @@@ 4 81
package com jpokemon savefilegenerator import java awt BorderLayout import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import java awt event FocusEvent import java awt event FocusListener import javax swing BoxLayout import javax swing JPanel import javax swing JScrollPane import javax swing JTextField import javax swing event DocumentEvent import javax swing event DocumentListener import org jpokemon pokemon PokemonInfo import org jpokemon pokemon Type import com jpokemon util ui selector TypeSelector public class PokemonSearchPanel extends JPanel private static final String nameFieldDefault Search by name public PokemonSearchPanel PartyEditorPanel pep super new BorderLayout parent pep setPreferredSize new Dimension 250 300 setFocusable true searchFieldPanel setFocusable true searchFieldPanel setLayout new BorderLayout add searchFieldPanel BorderLayout NORTH nameField setPreferredSize new Dimension 100 16 nameField addFocusListener new FieldFocuser nameField nameFieldDefault nameField getDocument addDocumentListener new DocumentListener public void changedUpdate DocumentEvent arg0 nameFieldSearch public void insertUpdate DocumentEvent arg0 nameFieldSearch public void removeUpdate DocumentEvent arg0 nameFieldSearch searchFieldPanel add nameField BorderLayout WEST typeSelector reload typeSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 typeSelectorSearch searchFieldPanel add typeSelector BorderLayout EAST searchResultsPanel setLayout new BoxLayout searchResultsPanel BoxLayout Y_AXIS JScrollPane scrollPane new JScrollPane searchResultsPanel add scrollPane BorderLayout CENTER public void selectPokemon PokemonInfo pi parent addPokemon pi private void nameFieldSearch String nameFieldText nameField getText toLowerCase if nameFieldText equals nameFieldDefault toLowerCase return searchResultsPanel removeAll typeSelector setSelectedItem null PokemonInfo pokemonInfo for int i 1 pokemonInfo PokemonInfo get i null i if pokemonInfo getName toLowerCase contains nameFieldText searchResultsPanel add new SelectablePokemonPanel this pokemonInfo parent validate parent repaint private void typeSelectorSearch Type selectedType typeSelector getCurrentElement if selectedType null return searchResultsPanel removeAll nameField setText nameFieldDefault Type t1 t2 PokemonInfo pokemonInfo for int i 1 pokemonInfo PokemonInfo get i null i t1 Type valueOf pokemonInfo getType1 t2 Type valueOf pokemonInfo getType2 if selectedType t1 selectedType t2 searchResultsPanel add new SelectablePokemonPanel this pokemonInfo parent validate parent repaint private PartyEditorPanel parent private JPanel searchFieldPanel new JPanel private JPanel searchResultsPanel new JPanel private JTextField nameField new JTextField nameFieldDefault private TypeSelector typeSelector new TypeSelector private static class FieldFocuser implements FocusListener public FieldFocuser JTextField jtf String s field jtf blankText s @Override public void focusGained FocusEvent arg0 if field getText equals blankText field setText @Override public void focusLost FocusEvent arg0 if field getText isEmpty field setText blankText private String blankText private JTextField field public static final long serialVersionUID @@@ 4 82
package com jpokemon savefilegenerator import java awt BorderLayout import java awt Component import java io BufferedWriter import java io File import java io FileNotFoundException import java io IOException import java io PrintWriter import java io Writer import javax swing JFrame import javax swing JOptionPane import org jpokemon trainer Player import org zachtaylor jnodalxml XmlParser public class SaveGeneratorWindow extends JFrame public SaveGeneratorWindow super setLayout new BorderLayout add playerDetailsPanel BorderLayout CENTER setVisible true setDefaultCloseOperation DISPOSE_ON_CLOSE refresh public Player getPlayer return player public void loadOrSetName String name File file new File name jpkmn if file exists player new Player undefined try player loadXML XmlParser parse file get 0 catch FileNotFoundException e else player getLocation setMap house public void savePlayer String playerName player id if playerName null playerName length 0 JOptionPane showMessageDialog this You haven t yet provided a name for the player Can t Save Player JOptionPane WARNING_MESSAGE return File file new File player id jpkmn try Writer writer new BufferedWriter new PrintWriter file writer write player toXml printToString 0 writer close catch IOException e e printStackTrace public void toggleEditParty boolean containsEditorPanel false remove playerEditorPanel for Component c getContentPane getComponents if c partyEditorPanel containsEditorPanel true break if containsEditorPanel remove partyEditorPanel else add partyEditorPanel BorderLayout EAST refresh public void toggleEditPlayer boolean containsEditorPanel false remove partyEditorPanel for Component c getContentPane getComponents if c playerEditorPanel containsEditorPanel true break if containsEditorPanel remove playerEditorPanel else add playerEditorPanel BorderLayout EAST refresh public void refresh playerDetailsPanel refresh partyEditorPanel refresh pack repaint private Player player new Player undefined private PlayerDetailsPanel playerDetailsPanel new PlayerDetailsPanel this private PartyEditorPanel partyEditorPanel new PartyEditorPanel this private PlayerEditorPanel playerEditorPanel new PlayerEditorPanel this public static final long serialVersionUID @@@ 4 83
package com jpokemon savefilegenerator import java awt BorderLayout import java awt event MouseAdapter import java awt event MouseEvent import javax swing JLabel import javax swing JPanel import org jpokemon pokemon PokemonInfo import com jpokemon util ui ImageLoader public class SelectablePokemonPanel extends JPanel public SelectablePokemonPanel PokemonSearchPanel psp PokemonInfo pi super new BorderLayout parent psp pokemonInfo pi add new JLabel ImageLoader pokemon pi getNumber BorderLayout WEST add new JLabel pi getName BorderLayout CENTER addButton addMouseListener new MouseHandler add addButton BorderLayout EAST private PokemonInfo pokemonInfo private PokemonSearchPanel parent private JLabel addButton new JLabel ImageLoader find ui plus private static final long serialVersionUID 1L private class MouseHandler extends MouseAdapter @Override public void mouseClicked MouseEvent e parent selectPokemon @@@ 4 84
package com jpokemon savefilegenerator input import javax swing JTextField import javax swing event DocumentEvent import javax swing event DocumentListener import com jpokemon savefilegenerator SaveGeneratorWindow public abstract class AbstractInputHandler implements DocumentListener protected JTextField boundTextField protected SaveGeneratorWindow boundWindow public AbstractInputHandler SaveGeneratorWindow window JTextField textField this boundWindow window this boundTextField textField @Override public void insertUpdate DocumentEvent e updateParent @Override public void removeUpdate DocumentEvent e updateParent @Override public void changedUpdate DocumentEvent e protected abstract void @@@ 4 85
package com jpokemon savefilegenerator input import javax swing JTextField import com jpokemon savefilegenerator SaveGeneratorWindow public class SetBadgeHandler extends AbstractInputHandler public SetBadgeHandler SaveGeneratorWindow window JTextField textField super window textField @Override public void updateParent String badgeText this boundTextField getText Integer badgeVal Integer parseInt badgeText this boundWindow getPlayer setBadgeCount badgeVal this boundWindow @@@ 4 86
package com jpokemon savefilegenerator input import javax swing JTextField import com jpokemon savefilegenerator SaveGeneratorWindow public class SetCashHandler extends AbstractInputHandler public SetCashHandler SaveGeneratorWindow window JTextField textField super window textField @Override public void updateParent String cashText this boundTextField getText Integer cashVal Integer parseInt cashText this boundWindow getPlayer setCash cashVal this boundWindow @@@ 4 87
package com jpokemon savefilegenerator input import javax swing JTextField import com jpokemon savefilegenerator SaveGeneratorWindow public class SetNameHandler extends AbstractInputHandler public SetNameHandler SaveGeneratorWindow window JTextField textField super window textField @Override public void updateParent this boundWindow loadOrSetName this boundTextField getText this boundWindow @@@ 4 88
package com jpokemon storeeditor import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import javax swing JLabel import javax swing JPanel import org jpokemon item Inventory import com jpokemon util FeedbackInputField import com jpokemon util ui selector ItemSelector public class InventoryPanel extends JPanel private Inventory inventory private ItemSelector itemSelector new ItemSelector private FeedbackInputField priceField new FeedbackInputField private FeedbackInputField availableField new FeedbackInputField private FeedbackInputField denominationField new FeedbackInputField private FeedbackInputField purchaseField new FeedbackInputField private static final long serialVersionUID 1L public InventoryPanel Inventory i inventory i buildItemSelector buildPriceField buildPurchaseField buildDenominationField buildAvailableField protected void buildItemSelector itemSelector reload itemSelector setSelectedIndex inventory getItem 1 itemSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onItemSelect add itemSelector protected void onItemSelect int newItemId itemSelector getCurrentElement getId inventory setItem newItemId inventory commit revalidate protected void buildPriceField String priceString inventory getPrice priceField setText priceString priceField setSavedValue priceString priceField setPreferredSize new Dimension 40 20 priceField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onPriceChange add new JLabel Price add priceField protected void onPriceChange try int newPrice Integer parseInt priceField getText priceField setSavedValue newPrice inventory setPrice newPrice inventory commit validate catch NumberFormatException e priceField setText priceField getSavedValue protected void buildPurchaseField String purchaseString inventory getPurchaseprice purchaseField setText purchaseString purchaseField setSavedValue purchaseString purchaseField setPreferredSize new Dimension 40 20 purchaseField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onPurchaseChange add new JLabel Purchase add purchaseField protected void onPurchaseChange try int newPurchase Integer parseInt purchaseField getText purchaseField setSavedValue newPurchase inventory setPurchaseprice newPurchase inventory commit validate catch NumberFormatException e purchaseField setText purchaseField getSavedValue protected void buildDenominationField String denominationString inventory getDenomination denominationField setText denominationString denominationField setSavedValue denominationString denominationField setPreferredSize new Dimension 40 20 denominationField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onDenominationChange add new JLabel Per add denominationField protected void onDenominationChange try int newDenomination Integer parseInt denominationField getText denominationField setSavedValue newDenomination inventory setDenomination newDenomination inventory commit validate catch NumberFormatException e denominationField setText denominationField getSavedValue protected void buildAvailableField String availableString inventory getAvailable availableField setText availableString availableField setSavedValue availableString availableField setPreferredSize new Dimension 40 20 availableField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onAvailableChange add new JLabel Available add availableField protected void onAvailableChange try int newAvailable Integer parseInt availableField getText availableField setSavedValue newAvailable inventory setAvailable newAvailable inventory commit validate catch NumberFormatException e availableField setText availableField @@@ 4 89
package com jpokemon storeeditor import java awt BorderLayout import java awt Dimension import java awt event ActionEvent import java awt event ActionListener import javax swing BoxLayout import javax swing JButton import javax swing JFrame import javax swing JPanel import javax swing JScrollPane import org jpokemon item Inventory import org jpokemon item Store import com jpokemon util FeedbackInputField import com jpokemon util ui selector StoreSelector public class StoreEditor extends JFrame private boolean readyToEdit false private StoreSelector storeSelector new StoreSelector private FeedbackInputField storeNameTextField new FeedbackInputField private JPanel centerPanel new JPanel northPanel new JPanel southPanel new JPanel private static final long serialVersionUID 1L public StoreEditor super Store Editor buildNorthPanel buildSouthPanel setLayout new BorderLayout add northPanel BorderLayout NORTH add southPanel BorderLayout SOUTH centerPanel setLayout new BoxLayout centerPanel BoxLayout Y_AXIS JScrollPane scrollPane new JScrollPane centerPanel add scrollPane BorderLayout CENTER pack setVisible true setDefaultCloseOperation DISPOSE_ON_CLOSE readyToEdit true protected void buildNorthPanel storeSelector reload storeSelector setSelectedItem null storeSelector addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onStoreSelect northPanel add storeSelector storeNameTextField setPreferredSize new Dimension 120 25 storeNameTextField addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onStoreRename northPanel add storeNameTextField protected void onStoreSelect if readyToEdit return Store store storeSelector getCurrentElement storeNameTextField setText store getName storeNameTextField setSavedValue store getName fillInventory protected void onStoreRename String newStoreName storeNameTextField getText if newStoreName null newStoreName isEmpty storeNameTextField setText storeNameTextField getSavedValue return Store store storeSelector getCurrentElement if store null return store setName newStoreName store commit storeNameTextField setSavedValue newStoreName storeSelector repaint protected void buildSouthPanel southPanel setLayout new BoxLayout southPanel BoxLayout X_AXIS JButton addStore new JButton Add Store addStore addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onAddStore southPanel add addStore JButton addRow new JButton Add Inventory addRow addActionListener new ActionListener public void actionPerformed ActionEvent arg0 onAddInventory southPanel add addRow protected void onAddStore new Store commit readyToEdit false storeSelector reload readyToEdit true storeSelector setSelectedIndex storeSelector getModel getSize 1 fillInventory protected void onAddInventory int storeIndex storeSelector getSelectedIndex int storeId storeSelector getCurrentElement getId Inventory inventory new Inventory inventory setStore storeId inventory commit readyToEdit false storeSelector reload storeSelector setSelectedIndex storeIndex readyToEdit true fillInventory protected void fillInventory Store store storeSelector getCurrentElement if store null return centerPanel removeAll for Inventory inventory store getInventory centerPanel add new InventoryPanel inventory revalidate @@@ 4 90
package com jpokemon util import java awt Color import javax swing BorderFactory import javax swing JTextField import javax swing event DocumentEvent import javax swing event DocumentListener public class FeedbackInputField extends JTextField implements DocumentListener private String savedValue private static final long serialVersionUID 1L public FeedbackInputField getDocument addDocumentListener this public String getSavedValue return savedValue public void setSavedValue String s savedValue s colorBorder public void colorBorder String currentValue getText if savedValue null savedValue equals currentValue setBorder BorderFactory createLineBorder Color black else setBorder BorderFactory createLineBorder Color red @Override public void changedUpdate DocumentEvent e @Override public void insertUpdate DocumentEvent e colorBorder @Override public void removeUpdate DocumentEvent e @@@ 4 91
package com jpokemon util public class UtilMain public static void main String args new @@@ 4 92
package com jpokemon util import java awt FlowLayout import java awt event ActionEvent import java awt event ActionListener import javax swing JButton import javax swing JFrame import com jpokemon interactioneditor InteractionEditor import com jpokemon mapeditor MapEditWindow import com jpokemon savefilegenerator SaveGeneratorWindow import com jpokemon storeeditor StoreEditor public class UtilWindow extends JFrame public UtilWindow super JPokemon Server Utilities setDefaultCloseOperation EXIT_ON_CLOSE setLayout new FlowLayout JButton mapEditor new JButton Open Map Editor mapEditor addActionListener new ActionListener public void actionPerformed ActionEvent arg0 new MapEditWindow add mapEditor JButton storeEditor new JButton Open Store Editor storeEditor addActionListener new ActionListener public void actionPerformed ActionEvent arg0 new StoreEditor add storeEditor JButton interactionEditor new JButton Open Interaction Editor interactionEditor addActionListener new ActionListener public void actionPerformed ActionEvent arg0 new InteractionEditor add interactionEditor JButton saveFileEditor new JButton Open Save File Editor saveFileEditor addActionListener new ActionListener public void actionPerformed ActionEvent arg0 new SaveGeneratorWindow add saveFileEditor pack setVisible true private static final long serialVersionUID @@@ 4 93
package com jpokemon util ui import javax swing ImageIcon import org jpokemon server JPokemonServer public class ImageLoader public static ImageIcon find String name String path JPokemonServer imagepath name png ImageIcon icon new ImageIcon path return icon public static ImageIcon pokemon String number String path JPokemonServer imagepath pokemon number png ImageIcon icon new ImageIcon path return icon public static ImageIcon item String type String name String path JPokemonServer imagepath item type toLowerCase if type equalsIgnoreCase ball type equalsIgnoreCase potion type equals stone path name substring 0 1 toLowerCase path png ImageIcon icon new ImageIcon path return icon public static ImageIcon npc String type String path JPokemonServer imagepath npc type toLowerCase png ImageIcon icon new ImageIcon path return @@@ 4 94
package com jpokemon util ui import java awt Component import javax swing DefaultComboBoxModel import javax swing DefaultListCellRenderer import javax swing JComboBox import javax swing JLabel import javax swing JList @SuppressWarnings unchecked rawtypes public abstract class JPokemonSelector E extends JComboBox private DefaultComboBoxModel model new DefaultComboBoxModel private static final long serialVersionUID 1L public JPokemonSelector setModel model setRenderer new JPokemonCellRenderer public E getCurrentElement return E model getSelectedItem public void reload int selectedIndex getSelectedIndex if selectedIndex 0 selectedIndex 0 reloadItems if model getSize selectedIndex setSelectedIndex selectedIndex protected abstract void reloadItems protected void addElementToModel E element model addElement element protected void renderElement Component c E element JLabel c setText element toString private class JPokemonCellRenderer extends DefaultListCellRenderer @Override public Component getListCellRendererComponent JList list Object o int index boolean isSelected boolean cellHasFocus Component c super getListCellRendererComponent list o index isSelected cellHasFocus E element if index 0 element E model getElementAt index else element E model getSelectedItem if element null renderElement c element return c private static final long serialVersionUID @@@ 4 95
package com jpokemon util ui button import javax swing Icon import javax swing JButton public class JPokemonButton extends JButton public JPokemonButton String s super s this setFocusable false public JPokemonButton Icon icon super icon this setFocusable false private static final long serialVersionUID @@@ 4 96
package com jpokemon util ui selector import com jpokemon util ui JPokemonSelector public class ActionTypeSelector extends JPokemonSelector String @Override @SuppressWarnings unchecked protected void reloadItems removeAllItems addItem undefined addItem event addItem heal addItem item addItem store addItem dresser private static final long serialVersionUID @@@ 4 97
package com jpokemon util ui selector import org jpokemon trainer Event import com jpokemon util ui JPokemonSelector public class EventSelector extends JPokemonSelector Event @Override protected void reloadItems removeAllItems Event event for int i 1 event Event get i null i addElementToModel event private static final long serialVersionUID @@@ 4 98
package com jpokemon util ui selector import java awt Component import javax swing JLabel import org jpokemon item ItemInfo import com jpokemon util ui JPokemonSelector public class ItemSelector extends JPokemonSelector ItemInfo @Override protected void reloadItems removeAllItems ItemInfo item for int i 1 item ItemInfo get i null i addElementToModel item protected void renderElement Component c ItemInfo itemInfo JLabel c setText Item itemInfo getId itemInfo getName private static final long serialVersionUID @@@ 4 99
package com jpokemon util ui selector import org jpokemon pokemon move MoveInfo import com jpokemon util ui JPokemonSelector public class MoveInfoSelector extends JPokemonSelector MoveInfo @Override protected void reloadItems removeAllItems MoveInfo moveInfo for int i 1 moveInfo MoveInfo get i null i addElementToModel moveInfo private static final long serialVersionUID @@@ 4 100
package com jpokemon util ui selector import java util ArrayList import java util List import com jpokemon util ui JPokemonSelector public class NPCActionSetSelector extends JPokemonSelector NPCActionSetMap public NPCActionSetSelector int n npcNumber n public void setNPCNumber int n npcNumber n @Override protected void reloadItems removeAllItems List Integer seenActionSetNumbers new ArrayList Integer for NPCActionSetMap npcActionSetMap NPCActionSetMap getByNPCNumber npcNumber if seenActionSetNumbers contains npcActionSetMap getActionset continue seenActionSetNumbers add npcActionSetMap getActionset addElementToModel npcActionSetMap private int npcNumber private static final long serialVersionUID @@@ 4 101
package com jpokemon util ui selector import com jpokemon util ui JPokemonSelector public class NPCSelector extends JPokemonSelector NPC @Override protected void reloadItems removeAllItems NPC npc for int i 1 npc NPC get i null i addElementToModel npc private static final long serialVersionUID @@@ 4 102
package com jpokemon util ui selector import com jpokemon util ui JPokemonSelector public class NPCTypeSelector extends JPokemonSelector NPCType @Override protected void reloadItems removeAllItems NPCType npcType for int i 1 npcType NPCType get i null i addElementToModel npcType private static final long serialVersionUID @@@ 4 103
package com jpokemon util ui selector import org jpokemon pokemon PokemonInfo import com jpokemon util ui JPokemonSelector public class PokemonInfoSelector extends JPokemonSelector PokemonInfo @Override protected void reloadItems removeAllItems PokemonInfo pokemonInfo for int i 1 pokemonInfo PokemonInfo get i null i addElementToModel pokemonInfo private static final long serialVersionUID @@@ 4 104
package com jpokemon util ui selector import com jpokemon util ui JPokemonSelector public class RequirementTypeSelector extends JPokemonSelector String @Override @SuppressWarnings unchecked protected void reloadItems removeAllItems addItem undefined addItem event addItem pokedex private static final long serialVersionUID @@@ 4 105
package com jpokemon util ui selector import java awt Component import javax swing JLabel import org jpokemon item Store import com jpokemon util ui JPokemonSelector public class StoreSelector extends JPokemonSelector Store @Override protected void reloadItems removeAllItems Store store for int i 1 store Store get i null i addElementToModel store @Override protected void renderElement Component c Store store JLabel c setText Store store getId store getName private static final long serialVersionUID @@@ 4 106
package com jpokemon util ui selector import org jpokemon pokemon Type import com jpokemon util ui JPokemonSelector public class TypeSelector extends JPokemonSelector Type @Override protected void reloadItems removeAllItems for Type type Type values addElementToModel type private static final long serialVersionUID @@@ 4 107
package org jpokemon import java util Calendar import java util HashMap import java util Map import java util PriorityQueue import java util Queue import org zachtaylor myna Myna public class Clock implements Runnable private static final Queue Calendar times new PriorityQueue Calendar private static final Map Calendar Runnable callbacks new HashMap Calendar Runnable private static final Calendar clockStart Calendar getInstance public static int timespeed 1 static Myna configure Clock class org jpokemon server time new Thread new Clock start private Clock public static void timeout int seconds Runnable callback Calendar time getGameTime time add Calendar SECOND seconds schedule time callback public static void schedule Calendar time Runnable callback synchronized times times add time callbacks put time callback public static Calendar getGameTime Calendar realTime Calendar getInstance int timeDiff int realTime getTimeInMillis clockStart getTimeInMillis timespeed Calendar gameTime Calendar clockStart clone gameTime add Calendar MILLISECOND timeDiff return gameTime @Override public void run for synchronized times while times isEmpty times peek getTimeInMillis getGameTime getTimeInMillis new Thread callbacks remove times remove start try Thread sleep 1000 timespeed catch InterruptedException @@@ 4 108
package org jpokemon activity import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONObject public interface Activity public void onAdd Player player throws ServiceException public void logout Player player public void onReturn Activity activity Player player public void serve JSONObject request Player player throws @@@ 4 109
package org jpokemon activity import java util ArrayList import java util List import org jpokemon pokemon Pokemon import org jpokemon pokemon move Move import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class SelectMoveFromPokemonActivity implements Activity private Pokemon pokemon private int moveIndex 1 public SelectMoveFromPokemonActivity Pokemon p pokemon p public int getMoveIndex return moveIndex @Override public void onAdd Player player throws ServiceException JSONObject json new JSONObject List JSONObject moves new ArrayList JSONObject try json put action selectmove json put pokemon pokemon name for int i 0 i pokemon moveCount i JSONObject moveJson new JSONObject Move move pokemon move i moveJson put name move name moveJson put pp move pp moveJson put ppMax move ppMax moves add moveJson json put moves new JSONArray moves toString catch JSONException e PlayerManager pushJson player json @Override public void logout Player player @Override public void onReturn Activity activity Player player @Override public void serve JSONObject request Player player throws ServiceException try if request has moveIndex moveIndex request getInt moveIndex PlayerManager popActivity player this else throw new ServiceException Expected move index catch JSONException e throw new ServiceException Expected move @@@ 4 110
package org jpokemon battle import java util ArrayList import java util HashMap import java util Iterator import java util List import java util Map import java util PriorityQueue import java util Queue import org jpokemon activity Activity import org jpokemon battle activity BuildAttackTurnActivity import org jpokemon battle activity BuildRunTurnActivity import org jpokemon battle activity BuildSwapTurnActivity import org jpokemon battle activity BuildTurnActivity import org jpokemon battle slot Slot import org jpokemon battle turn AttackTurn import org jpokemon battle turn SwapTurn import org jpokemon battle turn Turn import org jpokemon pokemon ConditionEffect import org jpokemon pokemon Pokemon import org jpokemon pokemon Type import org jpokemon pokemon move Move import org jpokemon pokemon move MoveStyle import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org jpokemon trainer PokemonTrainer import org jpokemon trainer Trainer import org json JSONArray import org json JSONException import org json JSONObject import org zachtaylor myna Myna public class Battle implements Activity Iterable Slot public static double stab 1 5 public static double typeadvantage 2 0 public static double typedisadvantage 5 static Myna configure Battle class org jpokemon battle private List String log new ArrayList String private Map String Slot slots new HashMap String Slot private Map String Turn turns new HashMap String Turn public Battle PokemonTrainer trainers System out println this created for int i 0 i trainers length i PokemonTrainer trainer trainers i addTrainer trainer i doTrainerAttacks public void addTrainer PokemonTrainer trainer int team if contains trainer throw new IllegalArgumentException Duplicate trainer trainer slots put trainer id new Slot trainer team System out println this trainer added trainer public int getTrainerCount return slots size public Slot getSlot String trainerId return slots get trainerId public boolean contains PokemonTrainer trainer return slots get trainer id null public void remove PokemonTrainer trainer System out println toString remove trainer trainer id if trainer party awake 0 if trainer instanceof Trainer addTrainerToPlayerHistory trainer id else if trainer instanceof Player if trainer instanceof Player Player player Player trainer pushLog false JSONObject json new JSONObject try json put action battle json put visible false catch JSONException e PlayerManager pushJson player json PlayerManager popActivity player this slots remove trainer id verifyTeamCount public void addTurn Turn turn turns put turn slot trainer id turn System out println toString turn set turn slot trainer id t turn toString if turns size slots size executeRound @Override public void onAdd Player player throws ServiceException PlayerManager pushJson player generateJson @Override public void logout Player player @Override public void onReturn Activity activity Player player if activity instanceof BuildTurnActivity BuildTurnActivity bta BuildTurnActivity activity Turn turn bta getTurn addTurn turn JSONObject json generateJson for Slot slot this if slot trainer instanceof Player player Player slot trainer PlayerManager pushJson player json @Override public void serve JSONObject request Player player throws ServiceException if turns get player id null return try if request has turn String turn request getString turn if attack equals turn PlayerManager addActivity player new BuildAttackTurnActivity this else if item equals turn else if swap equals turn PlayerManager addActivity player new BuildSwapTurnActivity this else if run equals turn PlayerManager addActivity player new BuildRunTurnActivity this catch JSONException e public void log String message log add message public void pushLog boolean clear JSONObject json new JSONObject try json put action battlelog json put logs new JSONArray log json put clear clear catch JSONException e e printStackTrace for Slot slot this if slot trainer instanceof Player Player player Player slot trainer PlayerManager pushJson player json @Override public Iterator Slot iterator return slots values iterator public String toString return Battle@ hashCode private void executeRound Queue Turn turnQueue new PriorityQueue Turn Map String Turn currentRoundTurns turns turns new HashMap String Turn for Turn turn currentRoundTurns values turnQueue add turn while turnQueue isEmpty Turn turn turnQueue remove turn execute if turn target leader awake log turn target trainer id s turn target leader name fainted Turn turnToRemove currentRoundTurns get turn target trainer id boolean turnWasRemoved turnQueue remove turnToRemove if turn target party awake 0 log turn target trainer id lost remove turn target trainer else if turnWasRemoved log turn target trainer id will auto swap to the next available pokemon turnQueue add SwapTurn autoSwapTurn this turn target if turn slot leader awake remove turn slot trainer else if turn reAdd addTurn turn applyEndOfRoundEffects doTrainerAttacks for Slot slot this if slot leader awake if slot party awake 0 if slot trainer instanceof Player log slot trainer id must swap on the next turn PlayerManager addActivity Player slot trainer new BuildSwapTurnActivity this else addTurn SwapTurn autoSwapTurn this slot else remove slot trainer System out println toString logs log toString pushLog true log new ArrayList String private void doTrainerAttacks for Slot slot slots values if slot trainer instanceof Player continue Slot randomSlot do Slot allSlots slots values toArray new Slot slots values size randomSlot allSlots int Math random allSlots length while slot equals randomSlot int randomMoveIndex int Math random slot leader moveCount Move randomMove slot leader move randomMoveIndex addTurn new AttackTurn this slot randomSlot randomMove private void verifyTeamCount int curTeam 1 boolean onlyOneTeamLeft true for Slot s this if curTeam 1 curTeam s team else if curTeam s team onlyOneTeamLeft false break JSONObject json new JSONObject try json put action battle json put visible false catch JSONException e if onlyOneTeamLeft while slots isEmpty String slotKey String slots keySet toArray 0 Slot slot slots remove slotKey if slot trainer instanceof Player Player p Player slot trainer PlayerManager pushJson p json PlayerManager popActivity p this private void applyEndOfRoundEffects for Slot slot this for Iterator ConditionEffect conditionEffectIterator slot leader getConditionEffects iterator conditionEffectIterator hasNext ConditionEffect conditionEffect conditionEffectIterator next if Math random conditionEffect persistanceChance log slot leader name conditionEffect getPersistanceMessage if conditionEffect damagePercentage 0 int damage int slot leader maxHealth conditionEffect damagePercentage slot leader takeDamage damage log slot leader name took damage damage else log slot leader name conditionEffect getDissipationMessage conditionEffectIterator remove slot applySlotEffects private void addTrainerToPlayerHistory String id Player p for Slot s this if s trainer instanceof Player continue p Player s trainer p record putTrainer id private JSONObject generateJson JSONObject json new JSONObject try json put action battle json put visible true Map Integer JSONArray teams new HashMap Integer JSONArray for Slot slot this if teams get slot team null teams put slot team new JSONArray JSONObject opponent new JSONObject opponent put id slot trainer id opponent put turn turns get slot trainer id null ready waiting opponent put pokemonName slot leader name opponent put pokemonLevel slot leader level opponent put pokemonNumber slot leader number opponent put pokemonHealth slot leader health opponent put pokemonMaxHealth slot leader maxHealth JSONArray conditionArray new JSONArray for ConditionEffect conditionEffect slot leader getConditionEffects conditionArray put conditionEffect name opponent put pokemonCondition conditionArray teams get slot team put opponent json put teams new JSONArray teams values catch JSONException e return json public static int computeDamage Pokemon user Move move Pokemon victim double damage 1 0 L user level A 1 0 P move power D 0 E computeEffectiveness move user victim R Math random 15 85 reps move reps if move style MoveStyle SPECIAL A user specattack D victim specdefense else if move style MoveStyle PHYSICAL A user attack D victim defense else if move style MoveStyle OHKO A 10000000 D 1 else if move style MoveStyle DELAYNEXT move style MoveStyle DELAYBEFORE A Math max user attack user specattack D Math max victim defense victim specdefense damage 2 0 L 5 0 2 0 A P D 50 0 2 0 E R reps if damage 1 E 0 damage 1 return int damage public static int confusedDamage Pokemon p double L p level A p attack P 40 D p defense STAB 1 E 1 R 1 00 return int 2 0 L 5 0 2 0 A P D 50 0 2 0 STAB E R private static double computeEffectiveness Move move Pokemon user Pokemon victim double answer 1 0 if move type user type1 move type user type2 answer stab if victim type1 null switch move type effectiveness victim type1 case SUPER answer typeadvantage break case NORMAL answer 1 break case NOT_VERY answer typedisadvantage break case IMMUNE answer 0 break if victim type2 null switch move type effectiveness victim type1 case SUPER answer typeadvantage break case NORMAL answer 1 break case NOT_VERY answer typedisadvantage break case IMMUNE answer 0 break return @@@ 4 111
package org jpokemon battle import java util ArrayList import java util List import org jpokemon battle slot Slot import org jpokemon interaction ActionSet import org jpokemon pokemon EffortValue import org jpokemon pokemon Pokemon import org jpokemon server Message import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org jpokemon trainer PokemonTrainer import org jpokemon trainer Trainer import org jpokemon trainer WildTrainer import org zachtaylor myna Myna public class Reward public static double wildxprate 1 0 public static double npcxprate 1 3 public static double gymxprate 1 6 public static double playerxprate 0 0 public static double otxprate 1 0 public static double nototxprate 1 5 static Myna configure Reward class org jpokemon battle reward public Reward Slot s _pokemon s leader _xp computeXp s trainer _pokemon if s trainer instanceof Player _evs _pokemon effortValues if s party awake 0 public void xp int amount _xp amount public int xp return _xp public void effortValues List EffortValue list _evs list public List EffortValue effortValues return _evs public void pokemon Pokemon p _pokemon p public Pokemon pokemon return _pokemon public void apply Slot s applyXP s if s trainer instanceof Player PlayerManager pushMessage Player s trainer _faintMessage if _defeatMessage null applyDefeat Player s trainer private void applyXP Slot s List Pokemon hitList s removeRival pokemon int xpEach Math max xp hitList size 1 for Pokemon earner hitList if earner hasOriginalTrainer earner xp int earner xp xpEach otxprate else earner xp int earner xp xpEach nototxprate earner addEV effortValues if s trainer instanceof Player s trainer notify private void applyDefeat Player player PlayerManager pushMessage player _defeatMessage private static int computeXp PokemonTrainer trainer Pokemon pokemon double xp pokemon xpYield xp pokemon level xp 7 if trainer instanceof WildTrainer xp wildxprate else if trainer instanceof Trainer if Trainer trainer isGym xp gymxprate else xp npcxprate else if trainer instanceof Player xp playerxprate return int xp private int _xp private Pokemon _pokemon private Message _faintMessage _defeatMessage private ActionSet _actions new ActionSet private List EffortValue _evs new ArrayList @@@ 4 112
package org jpokemon battle public enum Target SELF ENEMY public static Target valueOf int target return target 0 SELF @@@ 4 113
package org jpokemon battle activity import org jpokemon activity Activity import org jpokemon activity SelectMoveFromPokemonActivity import org jpokemon battle Battle import org jpokemon battle slot Slot import org jpokemon battle turn AttackTurn import org jpokemon battle turn Turn import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONObject public class BuildAttackTurnActivity implements BuildTurnActivity private Battle battle private int moveIndex 1 private String slotId targetId public BuildAttackTurnActivity Battle b battle b @Override public void onAdd Player player throws ServiceException slotId player id PlayerManager addActivity player new SelectMoveFromPokemonActivity player party get 0 @Override public void logout Player player @Override public void onReturn Activity activity Player player if activity instanceof SelectMoveFromPokemonActivity SelectMoveFromPokemonActivity smflpa SelectMoveFromPokemonActivity activity moveIndex smflpa getMoveIndex if battle getTrainerCount 2 for Slot slot battle if slot trainer id equals player id continue targetId slot trainer id break PlayerManager popActivity player this else String moveName player party get 0 move moveIndex name PlayerManager addActivity player new SelectTargetForMoveActivity moveName else if activity instanceof SelectTargetForMoveActivity SelectTargetForMoveActivity stfma SelectTargetForMoveActivity activity targetId stfma getTargetId PlayerManager popActivity player this @Override public void serve JSONObject request Player player throws ServiceException throw new ServiceException Cannot serve from BuildTurnActivity @Override public Turn getTurn if moveIndex 1 targetId null return null Slot userSlot battle getSlot slotId Slot targetSlot battle getSlot targetId return new AttackTurn battle userSlot targetSlot userSlot party get 0 move @@@ 4 114
package org jpokemon battle activity import org jpokemon activity Activity import org jpokemon battle Battle import org jpokemon battle slot Slot import org jpokemon battle turn RunTurn import org jpokemon battle turn Turn import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONObject public class BuildRunTurnActivity implements BuildTurnActivity private Battle battle private String slotId public BuildRunTurnActivity Battle b battle b @Override public void onAdd Player player throws ServiceException slotId player id PlayerManager popActivity player this @Override public void logout Player player @Override public void onReturn Activity activity Player player @Override public void serve JSONObject request Player player throws ServiceException @Override public Turn getTurn Slot slot battle getSlot slotId return new RunTurn battle @@@ 4 115
package org jpokemon battle activity import org jpokemon activity Activity import org jpokemon battle Battle import org jpokemon battle slot Slot import org jpokemon battle turn SwapTurn import org jpokemon battle turn Turn import org jpokemon pokemon ConditionEffect import org jpokemon pokemon Pokemon import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class BuildSwapTurnActivity implements BuildTurnActivity private Battle battle private String slotId private int pokemonIndex 1 public BuildSwapTurnActivity Battle b battle b @Override public void onAdd Player player throws ServiceException slotId player id JSONObject json new JSONObject try json put action selectpokemon JSONArray pokemonArray new JSONArray json put pokemon pokemonArray for Pokemon pokemon player party JSONObject pokemonJson new JSONObject pokemonJson put name pokemon name pokemonJson put pokemonNumber pokemon number pokemonJson put level pokemon level pokemonJson put health pokemon health pokemonJson put healthMax pokemon maxHealth JSONArray conditionArray new JSONArray for ConditionEffect conditionEffect pokemon getConditionEffects conditionArray put conditionEffect name pokemonJson put condition conditionArray pokemonArray put pokemonJson catch JSONException e PlayerManager pushJson player json @Override public void logout Player player @Override public void onReturn Activity activity Player player @Override public void serve JSONObject request Player player throws ServiceException try if request has pokemonIndex pokemonIndex request getInt pokemonIndex JSONObject closeJson new JSONObject closeJson put action selectpokemon close PlayerManager pushJson player closeJson PlayerManager popActivity player this return catch JSONException e throw new ServiceException Expected pokemon index @Override public Turn getTurn if pokemonIndex 1 return null Slot userSlot battle getSlot slotId return new SwapTurn battle userSlot @@@ 4 116
package org jpokemon battle activity import org jpokemon activity Activity import org jpokemon battle turn Turn public interface BuildTurnActivity extends Activity public Turn @@@ 4 117
package org jpokemon battle activity import org jpokemon activity Activity import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONException import org json JSONObject public class SelectTargetForMoveActivity implements Activity private String moveName private String targetId public SelectTargetForMoveActivity String name moveName name public String getTargetId return targetId @Override public void onAdd Player player throws ServiceException JSONObject json new JSONObject try json put action battle selecttarget json put moveName moveName catch JSONException e PlayerManager pushJson player json @Override public void logout Player player @Override public void onReturn Activity activity Player player @Override public void serve JSONObject request Player player throws ServiceException try if request has targetId targetId request getString targetId PlayerManager popActivity player this return catch JSONException e e printStackTrace throw new ServiceException targetId @@@ 4 118
package org jpokemon battle lobby import java util ArrayList import java util Collections import java util HashMap import java util List import java util Map public class Lobby private final String host private boolean configuring true private final List List String teams new ArrayList List String private final Map String String responses new HashMap String String public Lobby String h host h reset public String getHost return host public boolean isConfiguring return configuring public void setConfiguring boolean state configuring state if configuring responses clear for List String team teams for String name team if name equals host responses put name yes else responses put name pending public void addTeam teams add new ArrayList String public void removeTeam int team teams remove team public void addPlayer String otherPlayerName int team teams get team add otherPlayerName public void removePlayer String otherPlayerName int team teams get team remove otherPlayerName public void accept String otherPlayerName responses put otherPlayerName yes public void reject String otherPlayerName responses put otherPlayerName no public List List String getTeams List List String copy new ArrayList List String for List String team teams copy add Collections unmodifiableList team return Collections unmodifiableList copy public Map String String getResponses return Collections unmodifiableMap responses public void reset teams clear teams add new ArrayList String teams add new ArrayList String teams get 0 add host responses clear configuring @@@ 4 119
package org jpokemon battle lobby import java util ArrayList import java util HashMap import java util List import java util Map import org jpokemon battle Battle import org jpokemon server JPokemonService import org jpokemon server Message import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class LobbyService implements JPokemonService private static final Map String Lobby lobbies new HashMap String Lobby private static final Map String List String pending new HashMap String List String public void login Player player lobbies put player id new Lobby player id pending put player id new ArrayList String public void logout Player player lobbies remove player id pending remove player id @Override public void serve JSONObject request Player player throws ServiceException try if request has configure configure request player else if request has respond respond request player else if request has search search request player catch JSONException e e printStackTrace @Override public JSONObject load JSONObject request Player player String host player id if request has host try host request getString host catch JSONException e e printStackTrace Lobby lobby lobbies get host JSONObject json generateJson lobby List String pendingList synchronized pending pendingList pending get player id try json put pending new JSONArray pendingList toString catch JSONException e e printStackTrace return json private void configure JSONObject json Player player throws JSONException ServiceException String configure json getString configure Lobby lobby lobbies get player id if configure equals addteam if lobby isConfiguring return lobby addTeam PlayerManager pushJson player load new JSONObject player else if configure equals addplayer String otherPlayerName json getString name int team json getInt team if lobby isConfiguring return if PlayerManager playerIsLoggedIn otherPlayerName Message message new Message otherPlayerName not found PlayerManager pushMessage player message return lobby addPlayer otherPlayerName team PlayerManager pushJson player load new JSONObject player else if configure equals removeplayer String otherPlayerName json getString name int team json getInt team if lobby isConfiguring return lobby removePlayer otherPlayerName team PlayerManager pushJson player load new JSONObject player else if configure equals state String state json getString state if configure equals state clearPending lobby lobby setConfiguring true PlayerManager pushJson player load new JSONObject player else if wait equals state buildPending lobby lobby setConfiguring false pushLobbyToPlayers lobby true else if start equals state clearPending lobby startBattle lobby lobby reset private void respond JSONObject json Player player throws JSONException ServiceException String host json getString host String response json getString respond Lobby lobby lobbies get host if lobby isConfiguring lobby getResponses keySet contains player id return if response equals accept lobby accept player id else if response equals reject lobby reject player id pushLobbyToPlayers lobby false private void search JSONObject json Player player throws JSONException ServiceException String searchTerm json getString search toLowerCase JSONObject response new JSONObject response put action lobby fillSearchResults JSONArray names new JSONArray response put names names if searchTerm isEmpty for String name PlayerManager getOnlinePlayerNames if name equals player id continue if name toLowerCase contains searchTerm player getFriends contains name names put name if names length 9 break PlayerManager pushJson player response private JSONObject generateJson Lobby lobby JSONObject json new JSONObject try json put action lobby json put host lobby getHost json put state lobby isConfiguring configure wait json put teams new JSONArray lobby getTeams toString json put responses new JSONObject lobby getResponses catch JSONException e return json private void buildPending Lobby lobby for List String team lobby getTeams for String name team if name equals lobby getHost continue List String pendingList synchronized pending pendingList pending get name synchronized pendingList pendingList add lobby getHost Player player PlayerManager getPlayer name PlayerManager pushJson player load new JSONObject player private void clearPending Lobby lobby for List String team lobby getTeams for String name team if name equals lobby getHost continue List String pendingList synchronized pending pendingList pending get name synchronized pendingList pendingList remove lobby getHost Player player PlayerManager getPlayer name PlayerManager pushJson player load new JSONObject player private void startBattle Lobby lobby Battle battle new Battle Map String String responses lobby getResponses List Player playersInBattle new ArrayList Player int teamNumber 0 for List String teamMembers lobby getTeams for String teamMember teamMembers if yes equals responses get teamMember Player player PlayerManager getPlayer teamMember battle addTrainer player teamNumber playersInBattle add player teamNumber for Player player playersInBattle PlayerManager addActivity player battle private void pushLobbyToPlayers Lobby lobby boolean sendNewRequestMessage Message message new Message New battle request JSONObject lobbyJson generateJson lobby for List String team lobby getTeams for String name team Player player PlayerManager getPlayer name PlayerManager pushJson player lobbyJson if sendNewRequestMessage PlayerManager pushMessage player @@@ 4 120
package org jpokemon battle slot import java util ArrayList import java util HashMap import java util List import java util Map import org jpokemon pokemon Pokemon import org jpokemon pokemon move Move import org jpokemon pokemon storage PokemonStorageUnit import org jpokemon trainer Player import org jpokemon trainer PokemonTrainer public class Slot public Slot PokemonTrainer trainer int team _trainer trainer _team team public PokemonTrainer trainer return _trainer public PokemonStorageUnit party return _trainer party public int team return _team public Pokemon leader return party get 0 public void addSlotEffect SlotEffect e if _slotEffects contains e _slotEffects remove e _slotEffects add e public String applySlotEffects List String messages new ArrayList String for SlotEffect e _slotEffects String message e apply if message null messages add message messages addAll rollDownEffectDuration return messages toArray new String messages size private List String rollDownEffectDuration List String messages new ArrayList String List SlotEffect nextEffects new ArrayList SlotEffect for SlotEffect e _slotEffects if e reduceDuration nextEffects add e else messages add e name dissipated _slotEffects nextEffects return messages public void takeDamage int damage leader takeDamage damage public double damageModifier Move m double damageModifier 1 0 for SlotEffect e _slotEffects damageModifier e damageModifier m return damageModifier public void addRival Slot s List Pokemon rivalsList rivalsList leader if rivalsList contains s leader rivalsList add s leader if _trainer instanceof Player Player _trainer pokedex saw s leader number public List Pokemon removeRival Pokemon p List Pokemon hitList new ArrayList Pokemon for Pokemon cur _trainer party List Pokemon rivalsList rivalsList cur if rivalsList null rivalsList contains p hitList add cur rivalsList remove p return hitList private List Pokemon rivalsList Pokemon p if _rivalsLists get p null _rivalsLists put p new ArrayList Pokemon return _rivalsLists get p private int _team private PokemonTrainer _trainer private List SlotEffect _slotEffects new ArrayList SlotEffect private Map Pokemon List Pokemon _rivalsLists new HashMap Pokemon List @@@ 4 121
package org jpokemon battle slot import org jpokemon pokemon move Move import org jpokemon pokemon move MoveStyle public class SlotEffect public SlotEffect SlotEffectType t Slot user Slot target _type t _user user _target target if _type hasFiniteDuration _time SlotEffectType shieldturns else _time 0 public String name return _type name public double damageModifier Move m MoveStyle style m style if _type SlotEffectType INVULERNABLE return 0 if style MoveStyle PHYSICAL _type SlotEffectType PHYSICAL_SHIELD return 0 if style MoveStyle SPECIAL _type SlotEffectType SPECIAL_SHIELD return 0 return 1 public String apply switch _type case SEED int d Math max 1 _target leader maxHealth 12 _target takeDamage d _user leader healDamage d return _user leader name healed d from leeching _target leader name default return null public boolean reduceDuration _time return _time 0 public boolean equals Object o if o instanceof SlotEffect return false return SlotEffect o _type _type private int _time private Slot _user _target private SlotEffectType @@@ 4 122
package org jpokemon battle slot import org zachtaylor myna Myna public enum SlotEffectType SEED PHYSICAL_SHIELD SPECIAL_SHIELD INVULERNABLE public static int shieldturns 5 static Myna configure SlotEffectType class org jpokemon battle public boolean hasFiniteDuration return this @@@ 4 123
package org jpokemon battle turn import org jpokemon battle Battle import org jpokemon battle slot Slot import org jpokemon pokemon ConditionEffect import org jpokemon pokemon Pokemon import org jpokemon pokemon move Move import org jpokemon pokemon move MoveStyle public class AttackTurn extends Turn public AttackTurn Battle b Slot user Slot target Move move super b user target _move move _executions 0 @Override public void execute Pokemon leader slot leader _executions if _executions 1 for ConditionEffect conditionEffect leader getConditionEffects if conditionEffect blocksAttack battle log leader name conditionEffect getPersistanceMessage return if _move enabled battle log leader name cannot use _move name It s not enabled return else if _move use battle log leader name tried to use _move name but it missed if _move hurtUserOnMiss int d Battle computeDamage leader _move target leader 8 slot takeDamage d battle log leader name took d recoil damage return battle log slot trainer id s slot leader name used _move name if _move style MoveStyle DELAYNEXT _executions 1 battle log slot trainer id s slot leader name is resting this turn return if _move style MoveStyle DELAYBEFORE _executions _move turns battle log slot trainer id s slot leader name is resting this turn return if _move style MoveStyle OHKO int levelDiff leader level target leader level if levelDiff 0 levelDiff 30 0 100 0 Math random battle log leader name tried to use _move name but it missed return if _move style MoveStyle MISC battle log _move name doesn t work yet Sorry about that return if _move doesDamage calculateDamage battle log target leader name took _damage damage target takeDamage _damage _move applyEffects slot target _damage @Override public boolean reAdd return _executions _move turns @Override public int compareTo Turn t if t instanceof AttackTurn return t slot leader speed slot leader speed return 1 private void calculateDamage if _move damageIsAbsolute _damage _move power else _damage Battle computeDamage slot leader _move target leader _damage target damageModifier _move _damage Math min Math max _damage 1 target leader health private Move _move private int _damage @@@ 4 124
package org jpokemon battle turn import org jpokemon battle Battle import org jpokemon battle slot Slot import org jpokemon item Item import org jpokemon item ItemType import org jpokemon pokemon Pokemon import org jpokemon trainer WildTrainer public class ItemTurn extends Turn public ItemTurn Battle b Slot user Slot target Item item int targetIndex super b user target _targetIndex targetIndex _item item battle log slot trainer id used item name @Override public void execute Pokemon target target party get _targetIndex if _item type ItemType MACHINE battle log Machines aren t allowed in battle else if _item type ItemType STONE battle log Stones aren t allowed in battle else if _item type ItemType POTION _item effect target else if _item type ItemType BALL if target trainer instanceof WildTrainer battle log Cannot use a ball against target name else if _item effect target if slot trainer add target battle log No room for target name else target party remove target battle log target name was caught else battle log target name broke free @Override public boolean reAdd return false @Override public int compareTo Turn turn if turn instanceof AttackTurn return 1 if turn instanceof ItemTurn return 0 return 1 private int _targetIndex private Item @@@ 4 125
package org jpokemon battle turn import org jpokemon battle Battle import org jpokemon battle slot Slot import org jpokemon server PlayerManager import org jpokemon trainer Player public class RunTurn extends Turn public RunTurn Battle b Slot user super b user user @Override public void execute Battle battle Battle PlayerManager getActivity Player slot trainer double chance 100 for Slot s battle if slot leader level s leader level chance 10 s leader level slot leader level else if slot leader level s leader level chance 7 slot leader level s leader level if chance 250 0 Math random battle remove slot trainer else battle log Didn t get away @Override public boolean reAdd return false @Override public int compareTo Turn turn if turn instanceof RunTurn return 0 return @@@ 4 126
package org jpokemon battle turn import org jpokemon battle Battle import org jpokemon battle slot Slot public class SwapTurn extends Turn private int _swapIndex public SwapTurn Battle b Slot user int swapIndex super b user user _swapIndex swapIndex public static SwapTurn autoSwapTurn Battle b Slot user if user party awake 0 return null int autoSwapIndex 0 while autoSwapIndex user party size user party get autoSwapIndex awake autoSwapIndex return new SwapTurn b user autoSwapIndex @Override public void execute slot party swap 0 _swapIndex String trainerName slot trainer id String leaderName slot leader name battle log trainerName sent out leaderName @Override public boolean reAdd return false @Override public int compareTo Turn turn if turn instanceof RunTurn return 1 if turn instanceof SwapTurn return 0 return @@@ 4 127
package org jpokemon battle turn import org jpokemon battle Battle import org jpokemon battle slot Slot public abstract class Turn implements Comparable Turn private Battle battle private Slot slot targetSlot public Turn Battle b Slot user Slot target battle b slot user targetSlot target public Battle battle return battle public Slot slot return slot public Slot target if targetSlot null return slot return targetSlot public abstract void execute public abstract boolean @@@ 4 128
package org jpokemon extra import org jpokemon activity Activity import org jpokemon overworld OverworldService import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class DresserActivity implements Activity @Override public void onAdd Player player throws ServiceException JSONObject json new JSONObject JSONArray avatars new JSONArray for String avatar player getAvatars avatars put avatar try json put action dresser Dresser open json put avatar player getAvatar json put avatars avatars catch JSONException e PlayerManager pushJson player json @Override public void logout Player player @Override public void onReturn Activity activity Player player @Override public void serve JSONObject request Player player throws ServiceException try String nextAvatar request getString avatar if player getAvatar equals nextAvatar return if player getAvatars contains nextAvatar return player setAvatar nextAvatar PlayerManager popActivity player this JSONObject json new JSONObject json put action dresser Dresser close PlayerManager pushJson player json OverworldService overworldService OverworldService PlayerManager getService overworld overworldService teleportPlayer player player getLocation catch JSONException @@@ 4 129
package org jpokemon extra import java util ArrayList import java util HashMap import java util List import java util Map import org jpokemon server JPokemonService import org jpokemon server Message import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class FriendsService implements JPokemonService private static final Map String List String pending new HashMap String List String public void login Player player pending put player id new ArrayList String public void logout Player player pending remove player id @Override public void serve JSONObject json Player player throws ServiceException try if json has configure configure json player PlayerManager pushJson player generateJson player catch JSONException e e printStackTrace @Override public JSONObject load JSONObject request Player player return generateJson player private void configure JSONObject json Player player throws JSONException String configure json getString configure String otherPlayerName json getString name Player otherPlayer PlayerManager getPlayer otherPlayerName if otherPlayer null return if otherPlayer getBlocked contains player id return if configure equals add sendFriendRequest player otherPlayer else if configure equals accept acceptFriendRequest player otherPlayer else if configure equals block blockOtherPlayer player otherPlayer private void sendFriendRequest Player player Player otherPlayer List String pendingList synchronized pending pendingList pending get otherPlayer id synchronized pendingList pendingList add player id PlayerManager pushMessage player new Message Friend request sent PlayerManager pushMessage otherPlayer new Message New friend request PlayerManager pushJson otherPlayer generateJson otherPlayer private void acceptFriendRequest Player player Player otherPlayer List String pendingList synchronized pending pendingList pending get player id synchronized pendingList if pendingList contains otherPlayer id return player addFriend otherPlayer id otherPlayer addFriend player id pendingList remove otherPlayer id Message message new Message Friend request accepted PlayerManager pushMessage player message PlayerManager pushMessage otherPlayer message PlayerManager pushJson otherPlayer generateJson otherPlayer private void blockOtherPlayer Player player Player otherPlayer player addBlocked otherPlayer id otherPlayer removeFriend player id PlayerManager pushMessage player new Message Player blocked private JSONObject generateJson Player player JSONObject json new JSONObject try json put action friends json put friends new JSONArray player getFriends json put blocked new JSONArray player getBlocked List String pendingList synchronized pending pendingList pending get player id synchronized pendingList json put pending new JSONArray pendingList catch JSONException e return @@@ 4 130
package org jpokemon extra import org jpokemon pokemon ConditionEffect import org jpokemon pokemon Pokemon import org jpokemon server JPokemonService import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class PartyService implements JPokemonService @Override public void login Player player @Override public void logout Player player @Override public void serve JSONObject request Player player throws ServiceException try String method request getString method if method equals slide slide request player catch JSONException e e printStackTrace private void slide JSONObject request Player player throws JSONException int indexOld request getInt indexOld int indexNew request getInt indexNew player party slide indexOld indexNew PlayerManager pushJson player load null player @Override public JSONObject load JSONObject request Player player JSONObject json new JSONObject JSONArray pokemonArray new JSONArray try json put action party json put pokemon pokemonArray json put count player party size json put awakecount player party awake for Pokemon pokemon player party JSONObject pokemonJson new JSONObject JSONArray conditionArray new JSONArray pokemonJson put name pokemon name pokemonJson put number pokemon number pokemonJson put health pokemon health pokemonJson put maxhealth pokemon maxHealth pokemonJson put condition conditionArray pokemonJson put level pokemon level for ConditionEffect C pokemon getConditionEffects conditionArray put C name pokemonArray put pokemonJson catch JSONException e return @@@ 4 131
package org jpokemon interaction import org jpokemon server ServiceException import org jpokemon trainer Player public interface Action public void execute Player player throws @@@ 4 132
package org jpokemon interaction import java util ArrayList import java util List import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations AutoIncrement import com njkremer Sqlite Annotations PrimaryKey public class ActionData @PrimaryKey @AutoIncrement private int id 1 private int actionsetId private String action options public static List ActionData get int actionsetId DataConnectionManager init JPokemonServer databasepath try return SqlStatement select ActionData class where actionsetid eq actionsetId getList catch DataConnectionException e e printStackTrace return new ArrayList ActionData public ActionData commit try if id 0 SqlStatement insert this execute else SqlStatement update this where id eq id execute catch DataConnectionException e e printStackTrace return this public int getId return id public void setId int id this id id public int getActionsetId return actionsetId public ActionData setActionsetId int actionsetId this actionsetId actionsetId return this public String getAction return action public ActionData setAction String action this action action return this public String getOptions return options public void setOptions String options this options @@@ 4 133
package org jpokemon interaction public interface ActionFactory public Action buildAction String @@@ 4 134
package org jpokemon interaction import java util HashMap import java util Map import org jpokemon interaction actions public class ActionFactoryRegistry private static Map String ActionFactory factories new HashMap String ActionFactory static registerActionFactory event new EventActionFactory registerActionFactory heal new HealActionFactory registerActionFactory item new ItemActionFactory registerActionFactory store new StoreActionFactory registerActionFactory upgrade new UpgradeActionFactory registerActionFactory map new MapActionFactory registerActionFactory grass new GrassActionFactory registerActionFactory dresser new DresserActionFactory private ActionFactoryRegistry public static void registerActionFactory String action ActionFactory factory factories put action factory public static Action get String action String options ActionFactory actionFactory factories get action if actionFactory null return actionFactory buildAction options return @@@ 4 135
package org jpokemon interaction import java util ArrayList import java util Collections import java util List import org jpokemon server JPokemonServer import org jpokemon server ServiceException import org jpokemon trainer Player import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations AutoIncrement import com njkremer Sqlite Annotations PrimaryKey public class ActionSet @PrimaryKey @AutoIncrement private int id 1 private String context name option private List Action _actions new ArrayList Action private List Requirement _requirements new ArrayList Requirement public static List ActionSet get String name DataConnectionManager init JPokemonServer databasepath try List ActionSet actionSets SqlStatement select ActionSet class where name eq name getList if actionSets null actionSets isEmpty for ActionSet actionSet actionSets fillActionSet actionSet return actionSets catch DataConnectionException e e printStackTrace return new ArrayList ActionSet public static List ActionSet get String context String name DataConnectionManager init JPokemonServer databasepath try List ActionSet actionSets SqlStatement select ActionSet class where context eq context and name eq name getList if actionSets null actionSets isEmpty for ActionSet actionSet actionSets fillActionSet actionSet return actionSets catch DataConnectionException e e printStackTrace return new ArrayList ActionSet private static void fillActionSet ActionSet actionSet for ActionData actionData ActionData get actionSet id Action action ActionFactoryRegistry get actionData getAction actionData getOptions actionSet addAction action for RequirementData requirementData RequirementData get actionSet id Requirement requirement RequirementFactoryRegistry get requirementData getRequirement requirementData getOptions actionSet addRequirement requirement public static ActionSet withAction Action action ActionSet actionSet new ActionSet actionSet addAction action return actionSet public int getId return id public ActionSet setId int id this id id return this public ActionSet commit try if id 0 SqlStatement insert this execute else SqlStatement update this where id eq id execute catch DataConnectionException e e printStackTrace return this public String getContext return context public ActionSet setContext String s context s return this public String getName return name public ActionSet setName String s name s return this public String getOption return option public ActionSet setOption String o option o return this public void execute Player player throws ServiceException if meetsRequirements player throw new ServiceException Requirements not satisfied for actionset id and player toString for Action action _actions action execute player public boolean meetsRequirements Player player for Requirement requirement _requirements if requirement isSatisfied player return false return true public List Action getActions return Collections unmodifiableList _actions public void addAction Action action _actions add action public List Requirement getRequirements return Collections unmodifiableList _requirements public void addRequirement Requirement requirement _requirements add @@@ 4 136
package org jpokemon interaction import org jpokemon trainer Player public interface Requirement public boolean isSatisfied Player @@@ 4 137
package org jpokemon interaction import java util ArrayList import java util List import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations AutoIncrement import com njkremer Sqlite Annotations PrimaryKey public class RequirementData @PrimaryKey @AutoIncrement private int id 1 private int actionsetId private String requirement options public static List RequirementData get int actionsetId DataConnectionManager init JPokemonServer databasepath try return SqlStatement select RequirementData class where actionsetid eq actionsetId getList catch DataConnectionException e e printStackTrace return new ArrayList RequirementData public RequirementData commit try if id 0 SqlStatement insert this execute else SqlStatement update this where id eq id execute catch DataConnectionException e e printStackTrace return this public int getId return id public void setId int id this id id public int getActionsetId return actionsetId public RequirementData setActionsetId int actionsetId this actionsetId actionsetId return this public String getRequirement return requirement public RequirementData setRequirement String requirement this requirement requirement return this public String getOptions return options public void setOptions String options this options @@@ 4 138
package org jpokemon interaction public interface RequirementFactory public Requirement buildRequirement String @@@ 4 139
package org jpokemon interaction import java util HashMap import java util Map import org jpokemon interaction requirements EventRequirementFactory import org jpokemon interaction requirements PokedexRequirementFactory public class RequirementFactoryRegistry private static Map String RequirementFactory factories new HashMap String RequirementFactory static registerRequirementFactory event new EventRequirementFactory registerRequirementFactory pokedex new PokedexRequirementFactory private RequirementFactoryRegistry public static void registerRequirementFactory String requirement RequirementFactory builder factories put requirement builder public static Requirement get String action String options RequirementFactory requirementFactory factories get action if requirementFactory null return requirementFactory buildRequirement options return @@@ 4 140
package org jpokemon interaction actions import java io File import java io FileNotFoundException import org jpokemon battle Battle import org jpokemon interaction Action import org jpokemon server JPokemonServer import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org jpokemon trainer Trainer import org zachtaylor jnodalxml XmlNode import org zachtaylor jnodalxml XmlParser public class BattleAction extends Action public BattleAction String data super data public void execute Player player throws ServiceException String fileName player record replaceMacros getData String filePath JPokemonServer scriptedbattlepath fileName jpkmn XmlNode trainerData try trainerData XmlParser parse new File filePath get 0 catch FileNotFoundException e throw new ServiceException Trainer file not found getData Trainer trainer new Trainer getData trainer loadXml trainerData if player record getTrainer trainer id PlayerManager addActivity player new Battle player @@@ 4 141
package org jpokemon interaction actions import org jpokemon extra DresserActivity import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player public class DresserActionFactory implements ActionFactory @Override public Action buildAction String options return new DresserAction class DresserAction implements Action @Override public void execute Player player throws ServiceException PlayerManager addActivity player new @@@ 4 142
package org jpokemon interaction actions import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon trainer Player public class EventActionFactory implements ActionFactory @Override public Action buildAction String options return null class EventAction implements Action private int eventId public EventAction int eventId this eventId eventId public void execute Player player player record putEvent @@@ 4 143
package org jpokemon interaction actions import java util List import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon overworld WildPokemon import org jpokemon server ServiceException import org jpokemon trainer Player public class GrassActionFactory implements ActionFactory @Override public Action buildAction String options return new GrassAction options class GrassAction implements Action private String mapId public GrassAction String mapId this mapId mapId @Override public void execute Player player throws ServiceException int totalFlex 0 List WildPokemon wildPokemon WildPokemon get mapId for WildPokemon wp wildPokemon totalFlex wp getFlex wildPokemon add wp totalFlex int totalFlex Math random for WildPokemon wp wildPokemon if totalFlex wp getFlex return else totalFlex wp @@@ 4 144
package org jpokemon interaction actions import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon pokemon Pokemon import org jpokemon trainer Player public class HealActionFactory implements ActionFactory @Override public Action buildAction String options return new HealAction class HealAction implements Action @Override public void execute Player player for Pokemon pokemon player party pokemon healDamage pokemon @@@ 4 145
package org jpokemon interaction actions import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon trainer Player public class ItemActionFactory implements ActionFactory @Override public Action buildAction String options String optionsSplit options split int itemId Integer parseInt optionsSplit 0 int quantity Integer parseInt optionsSplit 1 return new ItemAction itemId quantity class ItemAction implements Action int itemId quantity public ItemAction int itemId int quantity this itemId itemId this quantity quantity public void execute Player player player item itemId add @@@ 4 146
package org jpokemon interaction actions import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon overworld Entity import org jpokemon overworld Location import org jpokemon overworld Map import org jpokemon overworld OverworldService import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player public class MapActionFactory implements ActionFactory @Override public Action buildAction String s String options s split String mapId options 0 String nextMapId options 1 return new MapAction mapId nextMapId class MapAction implements Action private String mapId nextMapId public MapAction String mapId String nextMapId this mapId mapId this nextMapId nextMapId @Override public void execute Player player throws ServiceException OverworldService overworldService OverworldService PlayerManager getService overworld Map nextMap overworldService getMap nextMapId Entity nextDoor nextMap getEntity mapId Location nextLocation nextDoor getLocation clone nextLocation setWidth 1 nextLocation setHeight 1 nextLocation setDirection down overworldService teleportPlayer player @@@ 4 147
package org jpokemon interaction actions import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon server ServiceException import org jpokemon trainer Player public class PokemonActionFactory implements ActionFactory @Override public Action buildAction String options return null class PokemonAction implements Action @Override public void execute Player player Pokemon pokemon null String parameters getData split int number Integer parseInt parameters 0 if number 1 for Pokemon cur player party if cur number number pokemon null pokemon cur player party remove pokemon else pokemon new Pokemon number Integer parseInt parameters 1 for int i 2 i parameters length i String parameter parameters i split if parameter 0 equals ot pokemon setTrainerName parameter 1 player add @@@ 4 148
package org jpokemon interaction actions import org jpokemon interaction Action import org jpokemon server Message import org jpokemon server PlayerManager import org jpokemon trainer Player public class SpeechAction extends Action public SpeechAction String data super data public void execute Player @@@ 4 149
package org jpokemon interaction actions import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon item Store import org jpokemon item StoreActivity import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player public class StoreActionFactory implements ActionFactory @Override public Action buildAction String options int storeId Integer parseInt options return new StoreAction storeId class StoreAction implements Action private int storeId public StoreAction int storeId this storeId storeId @Override public void execute Player player throws ServiceException Store store Store get storeId if store null throw new ServiceException Store undefined storeId PlayerManager addActivity player new StoreActivity @@@ 4 150
package org jpokemon interaction actions import org jpokemon interaction Action import org jpokemon interaction ActionFactory import org jpokemon pokemon UpgradeActivity import org jpokemon server PlayerManager import org jpokemon trainer Player public class UpgradeActionFactory implements ActionFactory @Override public Action buildAction String options return new UpgradeAction class UpgradeAction implements Action @Override public void execute Player player PlayerManager addActivity player new @@@ 4 151
package org jpokemon interaction requirements import org jpokemon interaction Requirement import org jpokemon interaction RequirementFactory import org jpokemon trainer Player public class EventRequirementFactory implements RequirementFactory @Override public Requirement buildRequirement String options return new EventRequirement Integer parseInt options class EventRequirement implements Requirement private int eventId public EventRequirement int eventId this eventId eventId @Override public boolean isSatisfied Player player return player record getEvent Math abs eventId eventId @@@ 4 152
package org jpokemon interaction requirements import org jpokemon interaction Requirement import org jpokemon interaction RequirementFactory import org jpokemon trainer Player public class PokedexRequirementFactory implements RequirementFactory @Override public Requirement buildRequirement String options return new PokedexRequirement Integer parseInt options class PokedexRequirement implements Requirement private int pokedexCount public PokedexRequirement int pokedexCount this pokedexCount pokedexCount @Override public boolean isSatisfied Player player return player pokedex count Math abs pokedexCount pokedexCount @@@ 4 153
package org jpokemon item import java util HashMap import java util Iterator import java util Map import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode public class Bag implements Iterable Item public static final String XML_NODE_NAME bag public Item get int itemID Item item _items get itemID if item null _items put itemID item new Item itemID return item @Override public Iterator Item iterator return new BagIterator public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME for Map Entry Integer Item itemEntry _items entrySet node addChild itemEntry getValue toXml return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node for XmlNode itemNode node getChildren Item XML_NODE_NAME Item i get itemNode getIntAttribute number i amount itemNode getIntAttribute quantity private class BagIterator implements Iterator Item @Override public boolean hasNext return index keys length @Override public Item next return Bag this get keys index @Override public void remove private int index 0 private Integer keys Bag this _items keySet toArray new Integer Bag this _items keySet size private Map Integer Item _items new HashMap Integer @@@ 4 154
package org jpokemon item import java util ArrayList import java util List import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations AutoIncrement import com njkremer Sqlite Annotations PrimaryKey public class Inventory @PrimaryKey @AutoIncrement private int id 1 private int store item price purchaseprice denomination available public static List Inventory get int store DataConnectionManager init JPokemonServer databasepath try return SqlStatement select Inventory class where store eq store getList catch DataConnectionException e e printStackTrace return new ArrayList Inventory public void commit try if id 1 SqlStatement insert this execute else SqlStatement update this where id eq id execute catch DataConnectionException e public int getId return id public void setId int i id i public int getStore return store public void setStore int s store s public int getItem return item public void setItem int i item i public int getPrice return price public void setPrice int p price p public int getPurchaseprice return purchaseprice public void setPurchaseprice int p purchaseprice p public int getDenomination return denomination public void setDenomination int d denomination d public int getAvailable return available public void setAvailable int a available @@@ 4 155
package org jpokemon item import org jpokemon battle Target import org jpokemon pokemon Pokemon import org zachtaylor jnodalxml XmlNode public class Item public static final String XML_NODE_NAME item public Item int itemID _info ItemInfo get itemID _type ItemType valueOf _info getType public int number return _info getId public String name return _info getName public ItemType type return _type public Target target return _type target public int amount return _quantity public void amount int quantity _quantity quantity public void add int quantity amount quantity amount public boolean visible return amount 0 public boolean effect Pokemon p if _quantity 1 return false boolean result _type effect p _info if result _quantity return result public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME node setAttribute number _info getId node setAttribute quantity _quantity node setSelfClosing true return node public String toString return _info getId _quantity private int _quantity private ItemInfo _info private ItemType @@@ 4 156
package org jpokemon item import java util HashMap import java util List import java util Map import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations AutoIncrement import com njkremer Sqlite Annotations PrimaryKey public class ItemInfo @PrimaryKey @AutoIncrement private int id 1 private String name private int type data private static Map Integer ItemInfo cache new HashMap Integer ItemInfo public static ItemInfo get int number DataConnectionManager init JPokemonServer databasepath if cache get number null try List ItemInfo info SqlStatement select ItemInfo class where id eq number getList if info isEmpty cache put number info get 0 catch DataConnectionException e e printStackTrace return cache get number public int getId return id public void setId int i id i public int getType return type public void setType int t type t public int getData return data public void setData int d data d public String getName return name public void setName String s name @@@ 4 157
package org jpokemon item import org jpokemon battle Target import org jpokemon pokemon Pokemon import org jpokemon pokemon Type import org jpokemon pokemon move Move import org jpokemon pokemon stat StatType public enum ItemType BALL POTION XSTAT STONE MACHINE KEYITEM public static ItemType valueOf int t return ItemType values t public Target target switch this case POTION case XSTAT case STONE case MACHINE case KEYITEM return Target SELF case BALL return Target ENEMY default return null public boolean effect Pokemon pokemon ItemInfo info switch this case BALL int a int Math random info getData 1 a 3 pokemon maxHealth 2 pokemon health pokemon catchRate a 30 pokemon maxHealth a pokemon catchBonus return a 255 case POTION pokemon healDamage info getData return true case XSTAT pokemon getStat StatType valueOf info getData effect 1 return true case STONE int n pokemon number switch Type valueOf info getData case FIRE if n 37 n 58 pokemon evolve else if n 133 pokemon evolve 136 break case WATER if n 60 n 90 n 120 pokemon evolve else if n 133 pokemon evolve 134 break case ELECTRIC if pokemon number 25 pokemon evolve else if n 133 pokemon evolve 135 break case GRASS if n 44 n 70 n 102 pokemon evolve break case NORMAL if n 30 n 33 n 35 n 39 pokemon evolve break default break return pokemon number n case MACHINE if new Move info getData STAB pokemon 1 return false try pokemon addMove info getData catch IllegalStateException e return false case KEYITEM default return @@@ 4 158
package org jpokemon item import java util Collections import java util List import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations AutoIncrement import com njkremer Sqlite Annotations PrimaryKey public class Store @PrimaryKey @AutoIncrement private int id 1 private String name private List Inventory _inventory public static Store get int number DataConnectionManager init JPokemonServer databasepath Store store null try List Store query SqlStatement select Store class where id eq number getList if query size 0 store query get 0 store _inventory Inventory get store id catch DataConnectionException e return store public void commit try if id 1 SqlStatement insert this execute else SqlStatement update this where id eq id execute catch DataConnectionException e e printStackTrace public int getId return id public void setId int i id i public String getName return name public void setName String n name n public boolean isEmpty return _inventory isEmpty public List Inventory getInventory return Collections unmodifiableList @@@ 4 159
package org jpokemon item import org jpokemon activity Activity import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class StoreActivity implements Activity private Store store public StoreActivity Store s store s @Override public void onAdd Player player @Override public void logout Player player @Override public void onReturn Activity activity Player player @Override public void serve JSONObject request Player player throws ServiceException try JSONArray itemChanges request getJSONArray items int runningTotalCash player getCash for int index 0 index itemChanges length index JSONObject itemChange itemChanges getJSONObject index int itemID itemChange getInt item int change itemChange getInt change int denomination itemChange getInt denomination Inventory inventory findInventory itemID denomination if inventory null throw new ServiceException Invalid sale request item itemID denomination denomination if change 0 runningTotalCash change inventory getPrice else runningTotalCash change inventory getPurchaseprice if player item itemID amount change throw new ServiceException Insufficent quantity item player item itemID name if runningTotalCash 0 throw new ServiceException Not enough cash to complete order for int index 0 index itemChanges length index JSONObject itemChange itemChanges getJSONObject index int itemID itemChange getInt item int change itemChange getInt change int denomination itemChange getInt denomination Inventory inventory findInventory itemID denomination player item itemID add change if change 0 player setCash player getCash change inventory getPrice else player setCash player getCash change inventory getPurchaseprice catch JSONException e e printStackTrace private Inventory findInventory int itemID int denomination for Inventory inventory store getInventory if inventory getItem itemID inventory getDenomination denomination return inventory return @@@ 4 160
package org jpokemon overworld import java util ArrayList import java util HashMap import java util List import java util Map import org jpokemon interaction ActionSet public class Entity protected String name protected boolean solid true protected Location location protected Map String List ActionSet actionSets new HashMap String List ActionSet public String getName return name public Entity setName String name this name name return this public boolean isSolid return solid public Entity setSolid boolean solid this solid solid return this public Location getLocation return location public Entity setLocation Location location this location location return this public List ActionSet getActionSets String trigger return actionSets get trigger public Entity setActionSets String trigger List ActionSet actionSets this actionSets put trigger actionSets return this public Entity addActionSet String trigger ActionSet actionSet if this actionSets containsKey trigger this actionSets put trigger new ArrayList ActionSet this actionSets get trigger add actionSet return this public Entity addAllActionSets String trigger List ActionSet actionSets if this actionSets containsKey trigger this actionSets put trigger new ArrayList ActionSet this actionSets get trigger addAll actionSets return @@@ 4 161
package org jpokemon overworld import org zachtaylor jnodalxml XmlNode public class Location public static final String XML_NODE_NAME location private String map direction private int left top width 1 height 1 public Location public Location int left int top this left top 1 1 public Location int left int top int width int height this left left this top top this width width this height height public Location clone Location location new Location location map map location direction direction location left left location height height location top top location width width return location public Location translate String direction Location location clone if left equals direction location left else if up equals direction location top else if right equals direction location left else if down equals direction location top else return null location setDirection direction return location public String getMap return map public void setMap String map this map map public String getDirection return direction public void setDirection String direction this direction direction public int getLeft return this left public void setLeft int left this left left public int getTop return this top public void setTop int top this top top public int getWidth return this width public void setWidth int width this width width public int getHeight return this height public void setHeight int height this height height public int getRight return this left this width public int getBottom return this top this height public void setBounds int left int width int top int height this left left this top top this width width this height height public boolean contains Location location return this left location left this top location top this getRight location getRight this getBottom location getBottom public void loadXml XmlNode node setMap node getAttribute map setBounds node getIntAttribute left node getIntAttribute width node getIntAttribute top node getIntAttribute height if node hasAttribute direction direction node getAttribute direction else direction down public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME node setAttribute map map node setAttribute direction direction node setAttribute left getLeft node setAttribute top getTop node setAttribute width getWidth node setAttribute height getHeight node setSelfClosing true return node public String toString return getLeft getWidth getTop @@@ 4 162
package org jpokemon overworld import java util ArrayList import java util Collections import java util List public class Map private String name private int width height entityZ private List Entity entities new ArrayList Entity private List String players new ArrayList String public Map String name this name name public String getName return name public Entity getEntity Location target for Entity entity entities if entity getLocation contains target return entity return null public Entity getEntity String entityName for Entity entity entities if entityName equals entity getName return entity return null public void addEntity Entity entity entities add entity public int getWidth return width public void setWidth int width this width width public int getHeight return height public void setHeight int height this height height public int getEntityZ return entityZ public void setEntityZ int entityZ this entityZ entityZ public void addPlayer String playerId players add playerId public List String getPlayers return Collections unmodifiableList players public void setPlayers List String players this players players public void removePlayer String playerId players remove @@@ 4 163
package org jpokemon overworld import java util HashMap import org jpokemon interaction ActionSet import org jpokemon server JPokemonService import org jpokemon server Message import org jpokemon server PlayerManager import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class OverworldService implements JPokemonService private HashMap String Map maps new HashMap String Map public Map getMap String name if maps containsKey name maps put name TmxMapParser parse name return maps get name public void teleportPlayer Player player Location nextLocation sendLeave player player setLocation nextLocation sendJoin player @Override public void login Player player sendJoin player @Override public void logout Player player sendLeave player private void sendLeave Player player String mapId player getLocation getMap Map map getMap mapId map removePlayer player id JSONObject signout new JSONObject try signout put action overworld leave signout put name player id catch JSONException e for String otherPlayerId map getPlayers PlayerManager pushJson PlayerManager getPlayer otherPlayerId signout private void sendJoin Player player Location location player getLocation String mapId location getMap Map map getMap mapId JSONObject sendToOthers new JSONObject JSONObject sendToPlayer new JSONObject JSONArray otherPlayersArray new JSONArray try sendToOthers put action overworld join sendToOthers put spriteheight 56 sendToOthers put spritewidth 42 sendToOthers put name player id sendToOthers put image player getAvatar sendToOthers put x player getLocation getLeft sendToOthers put y player getLocation getTop sendToOthers put z map getEntityZ sendToOthers put direction player getLocation getDirection sendToPlayer put action overworld load sendToPlayer put spriteheight 56 sendToPlayer put spritewidth 42 sendToPlayer put name player id sendToPlayer put image player getAvatar sendToPlayer put x player getLocation getLeft sendToPlayer put y player getLocation getTop sendToPlayer put z map getEntityZ sendToPlayer put direction player getLocation getDirection sendToPlayer put map mapId sendToPlayer put otherPlayers otherPlayersArray for String playerId map getPlayers Player otherPlayer PlayerManager getPlayer playerId PlayerManager pushJson otherPlayer sendToOthers JSONObject otherPlayerJson new JSONObject otherPlayerJson put name otherPlayer id otherPlayerJson put spriteheight 56 otherPlayerJson put spritewidth 42 otherPlayerJson put image otherPlayer getAvatar otherPlayerJson put x otherPlayer getLocation getLeft otherPlayerJson put y otherPlayer getLocation getTop otherPlayerJson put z map getEntityZ otherPlayerJson put direction otherPlayer getLocation getDirection otherPlayersArray put otherPlayerJson map addPlayer player id PlayerManager pushJson player sendToPlayer catch JSONException e e printStackTrace @Override public void serve JSONObject request Player player throws ServiceException try String method request getString method if method equals move move player request else if look equals method look player request else if method equals interact interact player request catch JSONException e e printStackTrace public void move Player player JSONObject request throws JSONException String direction request getString direction Location location player getLocation translate direction if location null return Map map getMap location getMap Entity entity map getEntity location if entity null if entity isSolid return for ActionSet actionSet entity getActionSets step try actionSet execute player catch ServiceException e PlayerManager pushMessage player new Message error e getMessage player setLocation location JSONObject json new JSONObject json put action overworld move json put name player id json put direction direction json put x location getLeft json put y location getTop for String playerId map getPlayers PlayerManager pushJson PlayerManager getPlayer playerId json public void look Player player JSONObject request throws JSONException Map map getMap player getLocation getMap String direction request getString direction if left equals direction up equals direction right equals direction down equals direction player getLocation setDirection direction JSONObject json new JSONObject json put action overworld look json put name player id json put direction direction for String playerId map getPlayers PlayerManager pushJson PlayerManager getPlayer playerId json public void interact Player player JSONObject request Location location player getLocation translate player getLocation getDirection Map map getMap location getMap Entity entity map getEntity location if entity null return for ActionSet actionSet entity getActionSets interact try actionSet execute player catch ServiceException e PlayerManager pushMessage player new Message error e getMessage @Override public JSONObject load JSONObject request Player player return @@@ 4 164
package org jpokemon overworld import java io File import java io FileNotFoundException import org jpokemon interaction ActionFactoryRegistry import org jpokemon interaction ActionSet import org zachtaylor jnodalxml XmlNode import org zachtaylor jnodalxml XmlParser import org zachtaylor myna Myna public class TmxMapParser public static String mappath static Myna configure TmxMapParser class org jpokemon server protected Map map protected int tileHeight tileWidth public static Map parse String mapName TmxMapParser parser new TmxMapParser mapName parser parse return parser map protected TmxMapParser String name map new Map name private void parse try XmlNode data XmlParser parse new File mappath map getName tmx get 1 parseMapDimensions data for XmlNode objectLayer data getChildren objectgroup for XmlNode objectNode objectLayer getAllChildren parseEntity objectNode catch FileNotFoundException e System out println e private void parseMapDimensions XmlNode mapRoot map setWidth mapRoot getIntAttribute width map setHeight mapRoot getIntAttribute height tileWidth mapRoot getIntAttribute tilewidth tileHeight mapRoot getIntAttribute tileheight int entityZ 1 for XmlNode layerNode mapRoot getAllChildren if objectgroup equals layerNode getName break else if layer equals layerNode getName entityZ map setEntityZ entityZ private void parseEntity XmlNode objectNode Entity entity new Entity entity setLocation parseLocation objectNode String entityName null entityType null if objectNode hasAttribute type entityType objectNode getAttribute type if objectNode hasAttribute name entityName objectNode getAttribute name entity setName entityName if npc equals entityType else if door equals entityType entity setSolid false entity addActionSet step ActionSet withAction ActionFactoryRegistry get map entityName else if grass equals entityType entity setSolid false entity addActionSet step ActionSet withAction ActionFactoryRegistry get grass map getName else if entityType null entity addAllActionSets interact ActionSet get global entityName entity addAllActionSets interact ActionSet get map getName entityName map addEntity entity private Location parseLocation XmlNode objectNode Location location new Location location setMap map getName location setLeft objectNode getIntAttribute x tileWidth location setTop objectNode getIntAttribute y tileHeight if objectNode hasAttribute width location setWidth objectNode getIntAttribute x objectNode getIntAttribute width tileWidth location getLeft 1 if objectNode hasAttribute height location setHeight objectNode getIntAttribute y objectNode getIntAttribute height tileHeight location getTop 1 return @@@ 4 165
package org jpokemon overworld import java util ArrayList import java util List import org jpokemon pokemon Pokemon import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement public class WildPokemon private String map private int number levelmin levelmax flex public Pokemon instantiate int level int levelmax levelmin 1 Math random levelmin return new Pokemon number level public static List WildPokemon get String map DataConnectionManager init JPokemonServer databasepath try return SqlStatement select WildPokemon class where map eq map getList catch DataConnectionException e e printStackTrace return new ArrayList WildPokemon public String getMap return map public void setMap String m map m public int getNumber return number public void setNumber int n number n public int getLevelmin return levelmin public void setLevelmin int l levelmin l public int getLevelmax return levelmax public void setLevelmax int l levelmax l public int getFlex return flex public void setFlex int f flex @@@ 4 166
package org jpokemon pokedex import java util ArrayList import java util HashMap import java util List import java util Map import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode public class Pokedex public static final String XML_NODE_NAME pokedex public void saw int num if num 1 throw new IllegalArgumentException num out of range if _data get num PokedexStatus OWN return _data put num PokedexStatus SAW public void own int num if num 1 throw new IllegalArgumentException num out of range _data put num PokedexStatus OWN public PokedexStatus status int num if num 1 throw new IllegalArgumentException num out of range PokedexStatus status _data get num if status null status PokedexStatus NONE return status public int count return _data size public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME List Integer seen new ArrayList Integer owned new ArrayList Integer for Map Entry Integer PokedexStatus pokedexEntry _data entrySet if pokedexEntry getValue PokedexStatus OWN owned add pokedexEntry getKey else seen add pokedexEntry getKey XmlNode seenNode new XmlNode seen seenNode setValue seen toString node addChild seenNode XmlNode ownedNode new XmlNode owned ownedNode setValue owned toString node addChild ownedNode return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node String dataPieces String seenData ownedData XmlNode seen node getChildren seen get 0 XmlNode owned node getChildren owned get 0 seenData seen getValue replace replace trim if seenData isEmpty dataPieces seenData split for String item dataPieces _data put Integer parseInt item trim PokedexStatus SAW ownedData owned getValue replace replace trim if ownedData isEmpty dataPieces ownedData split for String item dataPieces _data put Integer parseInt item trim PokedexStatus OWN private Map Integer PokedexStatus _data new HashMap Integer @@@ 4 167
package org jpokemon pokedex public enum PokedexStatus NONE SAW OWN public static PokedexStatus valueOf int p return values @@@ 4 168
package org jpokemon pokemon public enum ConditionEffect BURN PARALYZE SLEEP POISON FREEZE CONFUSE WRAP FLINCH public double persistanceChance switch this case BURN case PARALYZE case POISON return 1 case SLEEP return 333 case FREEZE return 8 case CONFUSE case WRAP return 667 default return 0 public boolean blocksAttack switch this case FREEZE case SLEEP case FLINCH case CONFUSE return true case PARALYZE return Math random 25 default return false public double damagePercentage switch this case BURN case POISON case WRAP return 1 case CONFUSE return 0 default return 0 public double catchBonus switch this case FREEZE case SLEEP return 2 case BURN case POISON case PARALYZE return 1 5 default return 1 public String getPersistanceMessage switch this case BURN return was injured by it s burn case SLEEP return is still sleeping case POISON return was injured by the poison case FREEZE return is still frozen case CONFUSE return hurt itself in it s confusion case WRAP return was injured by the binding case PARALYZE return is paralyzed default return null public String getDissipationMessage switch this case SLEEP return woke up case FREEZE return broke out of the ice case WRAP return freed itself case CONFUSE return is no longer confused default return @@@ 4 169
package org jpokemon pokemon public class EffortValue private int pokemon stat amount public int getPokemon return pokemon public void setPokemon int val pokemon val public int getStat return stat public void setStat int val stat val public int getAmount return amount public void setAmount int val amount @@@ 4 170
package org jpokemon pokemon public enum GrowthRate SLOW MED_SLOW MED_FAST FAST public static GrowthRate valueOf int index return GrowthRate values index public int xp int n double xp 0 switch this case SLOW xp 5 0 n n n 4 break case MED_SLOW xp 6 0 n n n 5 15 n n 100 n 140 break case MED_FAST xp n n n break case FAST xp 4 0 n n n 5 return Math max 1 int @@@ 4 171
package org jpokemon pokemon import java util ArrayList import java util List import org jpokemon pokemon move Move import org jpokemon pokemon move MoveBlock import org jpokemon pokemon stat Stat import org jpokemon pokemon stat StatBlock import org jpokemon pokemon stat StatType import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode public class Pokemon public static final String XML_NODE_NAME pokemon public Pokemon int num _number num _moves new MoveBlock _number _species PokemonInfo get _number _stats new StatBlock _species public Pokemon int num int lvl this num _level lvl _stats level lvl _moves randomize lvl public int number return _number public String name if _name null return species return _name public void name String s _name s public String species return _species getName public int level return _level public int evolutionLevel return _species getEvolutionlevel public int catchRate return _species getCatchrate public void level int l _level l _stats level l checkNewMoves conditionEffects new ArrayList ConditionEffect public void incLevel int thisLevelIncrement int level StatBlock bonuslevelrate int nextLevelIncrement int level 1 StatBlock bonuslevelrate while nextLevelIncrement thisLevelIncrement _stats points _stats points 1 nextLevelIncrement level level 1 public Type type1 return Type valueOf _species getType1 public Type type2 return Type valueOf _species getType2 public String getTrainerName return _ot public void setTrainerName String s if _ot null _hasOriginalTrainer false else _hasOriginalTrainer true _ot s public boolean hasOriginalTrainer return _hasOriginalTrainer public int xp return _xp public void xp int amount int xpNeededAtLevel xpNeededAtLevel _xp amount while _xp xpNeededAtLevel _xp xpNeededAtLevel incLevel public int xpNeeded return xpNeededAtLevel xp public int xpYield return _species getXpyield public Stat getStat StatType s return _stats get s public int availableStatPoints return _stats points public void statPoints StatType s int amount _stats usePoints s amount public int health int val getStat StatType HEALTH cur return val public int maxHealth return getStat StatType HEALTH max public int attack return getStat StatType ATTACK cur public int specattack return getStat StatType SPECATTACK cur public int defense return getStat StatType DEFENSE cur public int specdefense return getStat StatType SPECDEFENSE cur public int speed return getStat StatType SPEED cur public List EffortValue effortValues return _species getEffortValues public void addEV List EffortValue evs _stats addEV evs public Move move int index return _moves get index public void addMove int number _moves add number public int moveCount return _moves count public void removeAllMoves _moves removeAll public void takeDamage int damage getStat StatType HEALTH effect damage public void healDamage int heal getStat StatType HEALTH effect heal public boolean awake return health 0 public void addConditionEffect ConditionEffect e _stats addConditionEffect e if conditionEffects contains e conditionEffects remove e conditionEffects add e public boolean hasConditionEffect ConditionEffect e return conditionEffects contains e public List ConditionEffect getConditionEffects return conditionEffects public boolean removeConditionEffect ConditionEffect e _stats removeConditionEffect e return conditionEffects remove e public double catchBonus double best 1 for ConditionEffect e conditionEffects best e catchBonus return Math min best 2 0 public void evolve int num if num length 0 _number num 0 else _number _moves setPokemonNumber _number _species PokemonInfo get _number _stats rebase _species checkNewMoves public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME if _name null node setAttribute name _name node setAttribute number _number node setAttribute level _level node setAttribute xp _xp node setAttribute ot _ot node setAttribute has_original_trainer _hasOriginalTrainer XmlNode conditionNode new XmlNode condition conditionNode setValue conditionEffects toString node addChild conditionNode node addChild _stats toXml node addChild _moves toXml return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node _name node getAttribute name _number node getIntAttribute number _moves setPokemonNumber _number _species PokemonInfo get _number _stats rebase _species _level node getIntAttribute level _stats level _level _xp node getIntAttribute xp _ot node getAttribute ot _hasOriginalTrainer node getBoolAttribute has_original_trainer _moves loadXml node getChildren MoveBlock XML_NODE_NAME get 0 _stats loadXml node getChildren StatBlock XML_NODE_NAME get 0 String conditionString node getChildren condition get 0 getValue if conditionString null for String ce conditionString replace replace trim split if ce isEmpty continue addConditionEffect ConditionEffect valueOf ce trim private void checkNewMoves if _moves newMoves level isEmpty private int xpNeededAtLevel GrowthRate rate GrowthRate valueOf _species getGrowthrate return rate xp level @Override public boolean equals Object o if o instanceof Pokemon return false Pokemon p Pokemon o if number p number return false if level p level return false if xp p xp return false if name equals p name return false return true @Override public int hashCode return name hashCode 255 _number _level private MoveBlock _moves private StatBlock _stats private String _name _ot private PokemonInfo _species private int _number _level _xp private boolean _hasOriginalTrainer private List ConditionEffect conditionEffects new ArrayList @@@ 4 172
package org jpokemon pokemon import java util HashMap import java util List import java util Map import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations OneToMany import com njkremer Sqlite Annotations PrimaryKey public class PokemonInfo @PrimaryKey private int number private String name private int type1 type2 attack specattack defense specdefense speed health evolutionlevel xpyield growthrate catchrate @OneToMany pokemon private List EffortValue effortValues private static Map Integer PokemonInfo cache new HashMap Integer PokemonInfo public static PokemonInfo get int num DataConnectionManager init JPokemonServer databasepath if cache get num null try List PokemonInfo pokemonbase SqlStatement select PokemonInfo class where number eq num getList if pokemonbase isEmpty cache put num pokemonbase get 0 catch DataConnectionException e e printStackTrace return cache get num public String toString return Pokemon getNumber getName public String getName return name public void setName String val name val public int getNumber return number public void setNumber int val number val public int getType1 return type1 public void setType1 int val type1 val public int getType2 return type2 public void setType2 int val type2 val public int getAttack return attack public void setAttack int val attack val public int getSpecattack return specattack public void setSpecattack int val specattack val public int getDefense return defense public void setDefense int val defense val public int getSpecdefense return specdefense public void setSpecdefense int val specdefense val public int getSpeed return speed public void setSpeed int val speed val public int getHealth return health public void setHealth int val health val public int getEvolutionlevel return evolutionlevel public void setEvolutionlevel int val evolutionlevel val public int getXpyield return xpyield public void setXpyield int val xpyield val public int getGrowthrate return growthrate public void setGrowthrate int val growthrate val public int getCatchrate return catchrate public void setCatchrate int val catchrate val public List EffortValue getEffortValues return effortValues public void setEffortValues List EffortValue val effortValues @@@ 4 173
package org jpokemon pokemon public enum Type NORMAL FIRE WATER ELECTRIC GRASS ICE FIGHTING POISON GROUND FLYING PSYCHIC BUG ROCK GHOST DRAGON public static Type valueOf int r if r 0 r Type values length return null return Type values r @SuppressWarnings incomplete switch public Effectiveness effectiveness Type t switch this case NORMAL switch t case ROCK return Effectiveness NOT_VERY case GHOST return Effectiveness IMMUNE break case FIRE switch t case GRASS case ICE case BUG return Effectiveness SUPER case FIRE case WATER case ROCK case DRAGON return Effectiveness NOT_VERY break case WATER switch t case FIRE case GROUND case ROCK return Effectiveness SUPER case WATER case GRASS case DRAGON return Effectiveness NOT_VERY break case ELECTRIC switch t case WATER case FLYING return Effectiveness SUPER case ELECTRIC case GRASS case DRAGON return Effectiveness NOT_VERY case GROUND return Effectiveness IMMUNE break case GRASS switch t case WATER case GROUND case ROCK return Effectiveness SUPER case FIRE case GRASS case POISON case FLYING case BUG case DRAGON return Effectiveness NOT_VERY break case ICE switch t case GRASS case GROUND case FLYING case DRAGON return Effectiveness SUPER case FIRE case WATER case ICE return Effectiveness NOT_VERY break case FIGHTING switch t case NORMAL case ICE case ROCK return Effectiveness SUPER case POISON case FLYING case PSYCHIC case BUG return Effectiveness NOT_VERY case GHOST return Effectiveness IMMUNE break case POISON switch t case GRASS return Effectiveness SUPER case POISON case GROUND case ROCK case GHOST return Effectiveness NOT_VERY break case GROUND switch t case FIRE case ELECTRIC case POISON case ROCK return Effectiveness SUPER case GRASS case BUG return Effectiveness NOT_VERY case FLYING return Effectiveness IMMUNE break case FLYING switch t case GRASS case FIGHTING case BUG return Effectiveness SUPER case ELECTRIC case ROCK return Effectiveness NOT_VERY break case PSYCHIC switch t case FIGHTING case POISON return Effectiveness SUPER case PSYCHIC return Effectiveness NOT_VERY break case BUG switch t case GRASS case PSYCHIC return Effectiveness SUPER case FIRE case FIGHTING case POISON case FLYING case GHOST return Effectiveness NOT_VERY break case ROCK switch t case FIRE case ICE case FLYING case BUG return Effectiveness SUPER case FIGHTING case GROUND return Effectiveness NOT_VERY break case GHOST switch t case PSYCHIC case GHOST return Effectiveness SUPER case NORMAL return Effectiveness IMMUNE break case DRAGON if t DRAGON return Effectiveness SUPER break return Effectiveness NORMAL public enum Effectiveness IMMUNE NOT_VERY NORMAL @@@ 4 174
package org jpokemon pokemon import org jpokemon activity Activity import org jpokemon pokemon stat StatType import org jpokemon server ServiceException import org jpokemon trainer Player import org json JSONArray import org json JSONException import org json JSONObject public class UpgradeActivity implements Activity @Override public void onAdd Player player @Override public void logout Player player @Override public void onReturn Activity activity Player player @Override public void serve JSONObject request Player player throws ServiceException Pokemon pokemon getPokemon player request try JSONArray stats request getJSONArray stats for int i 0 i stats length i StatType s StatType valueOf stats getJSONObject i getString stat pokemon statPoints s stats getJSONObject i getInt amount catch JSONException e private static Pokemon getPokemon Player player JSONObject request throws ServiceException int pokemonIndex 1 Pokemon pokemon null try pokemonIndex request getInt pokemon catch JSONException e throw new ServiceException Pokemon index not provided try pokemon player party get pokemonIndex catch IllegalArgumentException e throw new ServiceException Pokemon index pokemonIndex not found return @@@ 4 175
package org jpokemon pokemon move import org jpokemon battle slot Slot import org jpokemon pokemon Pokemon import org jpokemon pokemon Type import org jpokemon pokemon move effect MoveEffect import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode public class Move public static final String XML_NODE_NAME move public Move int number setNumber number public int number return _info getNumber public String name return _info getName public int power return _info getPower public int pp return _pp public int ppMax return _ppMax public double accuracy return _info getAccuracy public MoveStyle style return _style public Type type return _type public int turns if style MoveStyle DELAYNEXT style MoveStyle DELAYBEFORE return 2 return 1 public boolean enabled return _enabled _pp 0 public void enable boolean b _enabled b public void setNumber int number if number 1 _info null else _info MoveInfo get number _pp _ppMax _info getPp _type Type valueOf _info getType _style MoveStyle valueOf _info getStyle _enabled number 0 public void restore _pp _ppMax _enabled true public boolean use boolean success enabled accuracy Math random if success _pp return success public double STAB Pokemon p return STAB p type1 p type2 public double STAB Type t1 Type t2 Type type type return type t1 type t2 1 5 1 0 public int reps if style MoveStyle REPEAT return 1 double chance Math random if chance 0 9947916667 return 5 else if chance 0 9583333333 return 4 else if chance 0 6666666667 return 3 else return 2 public void applyEffects Slot user Slot target int damage for MoveEffect effect _info getEffects effect effect user target damage public boolean hurtUserOnMiss return number 60 number 69 public boolean doesDamage return style MoveStyle STATUS public boolean damageIsAbsolute return false public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME node setAttribute number number node setAttribute pp _pp node setAttribute ppmax _ppMax node setAttribute enabled _enabled node setSelfClosing true return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node setNumber Integer parseInt node getAttribute number _ppMax node getIntAttribute ppmax _pp node getIntAttribute pp @Override public boolean equals Object o if o instanceof Move return false Move m Move o return _info m _info _ppMax m _ppMax public int hashCode return _type ordinal 1375 _style ordinal 71 private Type _type private MoveInfo _info private int _pp _ppMax private boolean _enabled private MoveStyle @@@ 4 176
package org jpokemon pokemon move import java util ArrayList import java util Iterator import java util List import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode import org zachtaylor myna Myna public class MoveBlock implements Iterable Move public static final String XML_NODE_NAME moves public static int movecount 4 static Myna configure MoveBlock class org jpokemon pokemon move public MoveBlock int pokemonNumber _pokemon pokemonNumber _data new Move movecount for int i 0 i movecount i _data i new Move 1 try for MoveMap map MoveMap get _pokemon 1 add map getMove_number catch IllegalStateException e e printStackTrace catch IllegalArgumentException e e printStackTrace public void setPokemonNumber int number _pokemon number public int count return _count public Move get int i if i 0 i _count throw new IllegalArgumentException Index out of bounds return _data i public void add int number if number 0 throw new IllegalArgumentException Move number out of bounds if _count movecount throw new IllegalStateException MoveBlock is full add number _count public void add int number int position if number 0 throw new IllegalArgumentException Move number out of bounds if position 0 position _count throw new IllegalArgumentException Position out of bounds position if contains number throw new IllegalArgumentException Duplicate move number _data position setNumber number _count public void restoreAll for Move move this move restore public void removeAll for Move m _data m setNumber 1 _count 0 public List String newMoves int level List MoveMap maps MoveMap get _pokemon level List String names new ArrayList String for MoveMap map maps names add MoveInfo get map getMove_number getName return names public void randomize int level ArrayList Integer possible new ArrayList Integer for int currentLevel 1 currentLevel level currentLevel for MoveMap map MoveMap get _pokemon currentLevel if possible contains map getMove_number possible add map getMove_number if possible isEmpty return removeAll while possible isEmpty _count movecount add possible remove int Math random possible size public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME for Move m this node addChild m toXml return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node removeAll for XmlNode childNode node getChildren Move XML_NODE_NAME _data _count loadXml childNode _count @Override public Iterator Move iterator return new MoveBlockIterator private boolean contains int number for Move m this if m number number return true return false private class MoveBlockIterator implements Iterator Move public MoveBlockIterator _index 0 @Override public boolean hasNext return _index MoveBlock this _count @Override public Move next return MoveBlock this get _index @Override public void remove private int _index private Move _data private int _count @@@ 4 177
package org jpokemon pokemon move import java util ArrayList import java util HashMap import java util List import java util Map import org jpokemon pokemon move effect MoveEffect import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations OneToMany import com njkremer Sqlite Annotations PrimaryKey public class MoveInfo @PrimaryKey private int number private String name private double accuracy private int type power pp style @OneToMany move_number private List MoveEffect effects new ArrayList MoveEffect private static Map Integer MoveInfo cache new HashMap Integer MoveInfo public static MoveInfo get int number DataConnectionManager init JPokemonServer databasepath if cache get number null try List MoveInfo moves SqlStatement select MoveInfo class where number eq number getList if moves isEmpty cache put number moves get 0 catch DataConnectionException e e printStackTrace return cache get number public String toString return Move getNumber getName public int getNumber return number public void setNumber int n number n public String getName return name public void setName String s name s public double getAccuracy return accuracy public void setAccuracy double d accuracy d public int getType return type public void setType int t type t public int getPower return power public void setPower int p power p public int getPp return pp public void setPp int p pp p public int getStyle return style public void setStyle int s style s public List MoveEffect getEffects return effects public void setEffects List MoveEffect l effects @@@ 4 178
package org jpokemon pokemon move import java util ArrayList import java util HashMap import java util List import java util Map import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement public class MoveMap private int pokemon_number pokemon_level move_number private static Map Integer Map Integer List MoveMap cache new HashMap Integer Map Integer List MoveMap public static List MoveMap get int number int level DataConnectionManager init JPokemonServer databasepath ensureCacheExists number if cache get number get level null try List MoveMap maps SqlStatement select MoveMap class where pokemon_number eq number and pokemon_level eq level getList cache get number put level maps catch DataConnectionException e e printStackTrace return cache get number get level public static List MoveMap get int number DataConnectionManager init JPokemonServer databasepath try List MoveMap maps SqlStatement select MoveMap class where pokemon_number eq number getList return maps catch DataConnectionException e e printStackTrace return new ArrayList MoveMap private static void ensureCacheExists int number if cache get number null cache put number new HashMap Integer List MoveMap public int getPokemon_number return pokemon_number public void setPokemon_number int val pokemon_number val public int getPokemon_level return pokemon_level public void setPokemon_level int val pokemon_level val public int getMove_number return move_number public void setMove_number int val move_number @@@ 4 179
package org jpokemon pokemon move public enum MoveStyle PHYSICAL SPECIAL OHKO STATUS REPEAT DELAYNEXT DELAYBEFORE MISC public static MoveStyle valueOf int style return values @@@ 4 180
package org jpokemon pokemon move effect import org jpokemon battle Target import org jpokemon battle slot Slot import org jpokemon battle slot SlotEffect import org jpokemon battle slot SlotEffectType import org jpokemon pokemon ConditionEffect import org jpokemon pokemon Pokemon import org jpokemon pokemon stat StatType public class MoveEffect public void effect Slot user Slot enemy int damage if chance Math random return MoveEffectType type MoveEffectType valueOf this type Target target Target valueOf this target Pokemon pokemon target Target SELF user leader enemy leader if type isStatModifier pokemon getStat StatType valueOf type toString effect power else if type isConditionModifier pokemon addConditionEffect ConditionEffect valueOf type toString else if type isFieldModifier user addSlotEffect new SlotEffect SlotEffectType valueOf type toString user enemy else if type MoveEffectType HEALTH_MOD pokemon healDamage int pokemon maxHealth power 1000 0 private double chance private int move_number type target power public int getMove_number return move_number public void setMove_number int val move_number val public int getType return type public void setType int val type val public int getTarget return target public void setTarget int val target val public int getPower return power public void setPower int val power val public double getChance return chance public void setChance double val chance @@@ 4 181
package org jpokemon pokemon move effect public enum MoveEffectType ATTACK DEFENSE SPECATTACK SPECDEFENSE SPEED BURN PARALYZE SLEEP POISON FREEZE CONFUSE WRAP FLINCH SEED PHYSICAL_SHIELD SPECIAL_SHIELD INVULERNABLE HEALTH_MOD public static MoveEffectType valueOf int style return values style public boolean isStatModifier return ordinal SPEED ordinal public boolean isConditionModifier return ordinal SPEED ordinal ordinal FLINCH ordinal public boolean isFieldModifier return ordinal FLINCH ordinal ordinal INVULERNABLE @@@ 4 182
package org jpokemon pokemon stat public class Health extends Stat @Override public void effect int power _cur power if _cur _max _cur _max else if _cur 0 _cur @@@ 4 183
package org jpokemon pokemon stat import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode import org zachtaylor myna Myna public class Stat public static final String XML_NODE_NAME stat public static int ivmax 32 public static int delta 6 public static double baseweight 2 0 public static double evweight 0 25 public static double ivweight 1 0 public static double bonusweight 1 0 static Myna configure Stat class org jpokemon pokemon stat public Stat _level 1 _modifier 1 _iv int Math random ivmax public int cur return _cur public int max return _max public int ev return _ev public void ev int val _ev val computeMax computeCur public int iv return _iv public void iv int val _iv val computeMax computeCur public int points return _pts public void points int p _pts p reset public void level int l _level l reset public void base int b _base b reset public void modify double m _modifier m computeCur public void effect int power _delta power if Math abs _delta delta _delta int Math copySign delta _delta computeCur public void reset _delta 0 computeMax computeCur public XmlNode toXml XmlNode myNode new XmlNode XML_NODE_NAME myNode setAttribute cur _cur myNode setAttribute max _max myNode setAttribute points _pts myNode setAttribute ev _ev myNode setAttribute iv _iv myNode setSelfClosing true return myNode public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node _cur node getIntAttribute cur _max node getIntAttribute max _pts node getIntAttribute points _ev node getIntAttribute ev _iv node getIntAttribute iv private void computeMax double val baseweight _base val ivweight _iv val evweight _ev val bonusweight _pts val 100 val 100 val _level val 10 _max int val private void computeCur if _delta 0 _cur int _max 2 0 _delta 2 else if _delta 0 _cur int _max 2 0 2 _delta else _cur _max _cur int Math max _cur _modifier 1 protected double _modifier protected int _delta _cur _max _base _pts _level _ev @@@ 4 184
package org jpokemon pokemon stat import java util List import org jpokemon pokemon ConditionEffect import org jpokemon pokemon EffortValue import org jpokemon pokemon PokemonInfo import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode import org zachtaylor myna Myna public class StatBlock public static final String XML_NODE_NAME stats public static int evmax 255 public static int totalevmax 510 public static int bonusmax 15 public static double bonuslevelrate 1 0 static Myna configure StatBlock class org jpokemon pokemon stat public StatBlock PokemonInfo info _data new Stat StatType values length _data 0 new Health for int i 1 i _data length i _data i new Stat rebase info public Stat get StatType type return _data type ordinal public void reset for Stat s _data s reset public void level int level for Stat s _data s level level public int points return _points public void points int p _points p public void usePoints StatType st int amount if points amount throw new IllegalStateException No points available Stat stat get st int consumable Math min bonusmax stat points amount if consumable 0 return points points amount stat points stat points amount public void rebase PokemonInfo info _data StatType HEALTH ordinal base info getHealth _data StatType ATTACK ordinal base info getAttack _data StatType SPECATTACK ordinal base info getSpecattack _data StatType DEFENSE ordinal base info getDefense _data StatType SPECDEFENSE ordinal base info getSpecdefense _data StatType SPEED ordinal base info getSpeed public void addEV List EffortValue evs for EffortValue ev evs Stat stat get StatType valueOf ev getStat int consumable ev getAmount if _evTotal ev getAmount totalevmax consumable totalevmax _evTotal if stat ev consumable evmax consumable evmax stat ev _evTotal consumable stat ev consumable public void addConditionEffect ConditionEffect i if i ConditionEffect BURN _burn true _data StatType ATTACK ordinal modify 1 0 2 0 else if i ConditionEffect PARALYZE _paralyze true _data StatType SPEED ordinal modify 1 0 4 0 public void removeConditionEffect ConditionEffect i if i ConditionEffect BURN _burn _burn false _data StatType ATTACK ordinal modify 1 else if i ConditionEffect PARALYZE _paralyze _paralyze false _data StatType SPEED ordinal modify 1 public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME node setAttribute points _points node setAttribute evtotal _evTotal for StatType st StatType values XmlNode child get st toXml child setAttribute type st toString node addChild child return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node _points node getIntAttribute points _evTotal node getIntAttribute evtotal for XmlNode childNode node getChildren Stat XML_NODE_NAME Stat s get StatType valueOf childNode getAttribute type s loadXml childNode private Stat _data private int _points _evTotal private boolean _burn @@@ 4 185
package org jpokemon pokemon stat public enum StatType HEALTH ATTACK SPECATTACK DEFENSE SPECDEFENSE SPEED public static StatType valueOf int s return StatType values @@@ 4 186
package org jpokemon pokemon storage import java util Iterator import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode import org zachtaylor myna Myna public class PokemonStorageBlock implements Iterable PokemonStorageUnit public static final String XML_NODE_NAME pokemonstorage public static int boxsize 20 public static int boxcount 8 static Myna configure PokemonStorageBlock class org jpokemon player public PokemonStorageBlock _data new PokemonStorageUnit boxcount 1 _data 0 new PokemonStorageUnit for int i 1 i boxcount i _data i new PokemonStorageUnit boxsize public PokemonStorageUnit get int box if box 0 box boxcount throw new IllegalArgumentException Invalid box number box return _data box public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME for PokemonStorageUnit psu _data node addChild psu toXml return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node int i 0 for XmlNode child node getChildren PokemonStorageUnit XML_NODE_NAME get i loadXml child @Override public Iterator PokemonStorageUnit iterator return new PokemonStorageBlockIterator private class PokemonStorageBlockIterator implements Iterator PokemonStorageUnit @Override public boolean hasNext return index boxcount @Override public PokemonStorageUnit next return _data index @Override public void remove private int index 0 private PokemonStorageUnit @@@ 4 187
package org jpokemon pokemon storage import java util ConcurrentModificationException import java util Iterator import org jpokemon pokemon Pokemon import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode import org zachtaylor myna Myna public class PokemonStorageUnit implements Iterable Pokemon public static final String XML_NODE_NAME pokemonbox public static int partysize 6 static Myna configure PokemonStorageUnit class org jpokemon player public PokemonStorageUnit this partysize public PokemonStorageUnit int size _size size _amount 0 _version 0 _data new Pokemon _size public int size return _amount public Pokemon get int i if i 0 i _amount throw new IllegalArgumentException Index out of bounds i return _data i public boolean add Pokemon p if p null _amount _size contains p return false _data _amount p _version return true public boolean remove Pokemon p int index indexOf p if index 0 throw new IllegalArgumentException Not in this unit p _version return remove index public boolean slide int indexOld int indexNew if indexOld 0 indexNew 0 indexOld _amount indexNew _amount throw new IllegalArgumentException Index out of bounds if indexOld indexNew throw new IllegalArgumentException Arguments are equal Pokemon swap _data indexOld int loopUpdateDirection indexOld indexNew 1 1 for int i indexOld i indexNew i i loopUpdateDirection _data i _data i loopUpdateDirection _data indexNew swap return true public boolean swap int p1 int p2 if p1 0 p2 0 p1 _amount p2 _amount throw new IllegalArgumentException Index out of bounds if p1 p2 throw new IllegalArgumentException Arguments are equal Pokemon swap _data p1 _data p1 _data p2 _data p2 swap _version return true public int indexOf Pokemon p for int i 0 i _amount i if _data i equals p return i return 1 public boolean contains Pokemon p return indexOf p 1 public int awake int answer 0 for Pokemon pokemon this if pokemon awake answer return answer public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME for Pokemon p this node addChild p toXml return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node while _amount 0 remove 0 for XmlNode child node getChildren Pokemon XML_NODE_NAME Pokemon p new Pokemon 1 p loadXml child add p public Iterator Pokemon iterator return new PokemonStorageUnitIterator private boolean remove int index if index 0 index _amount throw new IllegalArgumentException Index out of bounds for int i index i _amount 1 i _data i _data i 1 _data _amount null return true private class PokemonStorageUnitIterator implements Iterator Pokemon public PokemonStorageUnitIterator _index 0 _version PokemonStorageUnit this _version @Override public boolean hasNext checkVersion return _index PokemonStorageUnit this _amount @Override public Pokemon next checkVersion return PokemonStorageUnit this get _index @Override public void remove private void checkVersion if _version PokemonStorageUnit this _version throw new ConcurrentModificationException private int _index _version private Pokemon _data private int _size _amount @@@ 4 188
package org jpokemon server import java io IOException import javax servlet ServletException import javax servlet http HttpServlet import javax servlet http HttpServletRequest import javax servlet http HttpServletResponse import org eclipse jetty server Request import org eclipse jetty server handler ResourceHandler import org zachtaylor myna Myna public class FileServlet extends HttpServlet public static String webdir web public static String cache static Myna configure FileServlet class org jpokemon server public FileServlet resourceHandler new ResourceHandler resourceHandler setWelcomeFiles new String index html resourceHandler setDirectoriesListed false resourceHandler setCacheControl cache resourceHandler setResourceBase webdir @Override protected void doGet HttpServletRequest req HttpServletResponse resp throws ServletException IOException resourceHandler handle req getRequestURI Request req req resp if resp isCommitted resp setStatus HttpServletResponse SC_NOT_FOUND resp setContentType text html resp getWriter println h1 Resource Not Found h1 br Sorry the resource you ve requested could not be located private ResourceHandler resourceHandler private static final long serialVersionUID @@@ 4 189
package org jpokemon server import org apache log4j BasicConfigurator import org apache log4j Logger import org eclipse jetty server Server import org eclipse jetty servlet ServletContextHandler import org eclipse jetty servlet ServletHolder import org zachtaylor myna Myna public class JPokemonServer public static int port 9001 public static String savepath data save public static String imagepath data image public static String scriptedbattlepath data trainer public static String databasepath data Pokemon db static Myna configure JPokemonServer class org jpokemon server public static void main String args throws Exception BasicConfigurator configure PlayerManager bootstrapServices logger trace Spinning up servlets ServletContextHandler root new ServletContextHandler root setContextPath root addServlet new ServletHolder new FileServlet root addServlet new ServletHolder new JPokemonWebSocketServlet socket logger info Server starting on port port Server server new Server port server setHandler root server start server join private static Logger logger Logger getLogger JPokemonServer @@@ 4 190
package org jpokemon server import org jpokemon trainer Player import org json JSONObject public interface JPokemonService public void login Player player public void logout Player player public void serve JSONObject request Player player throws ServiceException public JSONObject load JSONObject request Player @@@ 4 191
package org jpokemon server import java io IOException import org eclipse jetty websocket WebSocket import org json JSONException import org json JSONObject public class JPokemonWebSocket implements WebSocket OnTextMessage private Connection connection @Override public void onClose int arg0 String arg1 PlayerManager close this @Override public void onOpen Connection c connection c @Override public void onMessage String arg0 try PlayerManager dispatch this new JSONObject arg0 catch JSONException e e printStackTrace catch ServiceException e e printStackTrace public void sendJson JSONObject json try connection sendMessage json toString catch IOException e e @@@ 4 192
package org jpokemon server import javax servlet http HttpServletRequest import org eclipse jetty websocket WebSocket import org eclipse jetty websocket WebSocketServlet public class JPokemonWebSocketServlet extends WebSocketServlet private static final long serialVersionUID 1L @Override public WebSocket doWebSocketConnect HttpServletRequest arg0 String arg1 return new @@@ 4 193
package org jpokemon server import org json JSONException import org json JSONObject public class Message public Message String messageClass String text this messageClass messageClass this text text public Message String text this update text public JSONObject toJson try return getJson catch JSONException e return null protected JSONObject getJson throws JSONException JSONObject json new JSONObject json put action notification messageClass json put text text return json private String text private String @@@ 4 194
package org jpokemon server import java io BufferedWriter import java io File import java io FileNotFoundException import java io IOException import java io PrintWriter import java io Writer import java util ArrayList import java util Collections import java util HashMap import java util List import java util Map import java util Stack import org jpokemon activity Activity import org jpokemon battle lobby LobbyService import org jpokemon extra FriendsService import org jpokemon extra PartyService import org jpokemon overworld OverworldService import org jpokemon trainer Player import org json JSONException import org json JSONObject import org zachtaylor jnodalxml XmlParser public class PlayerManager public static boolean playerIsLoggedIn String name boolean result synchronized players result players containsKey name return result public static boolean playerExists String name if playerIsLoggedIn name return true String filename name jpkmn File file new File JPokemonServer savepath filename if file exists file getName equals filename return false return true public static Player getPlayer String name Player player synchronized players player players get name return player public static List String getOnlinePlayerNames List String playerNames null synchronized players playerNames Collections unmodifiableList new ArrayList String players keySet return playerNames public static void bootstrapServices services new HashMap String JPokemonService services put overworld new OverworldService services put lobby new LobbyService services put friends new FriendsService services put party new PartyService public static JPokemonService getService String name return services get name public static boolean hasActivity Player player return activities get player id isEmpty public static Activity getActivity Player player Stack Activity stack activities get player id return stack peek public static void addActivity Player player Activity a try activities get player id add a a onAdd player catch ServiceException e e printStackTrace public static void popActivity Player player Activity a if getActivity player a throw new IllegalStateException Popped activity is not most recent activities get player id pop if hasActivity player getActivity player onReturn a player public static void pushMessage Player player Message message pushJson player message toJson public static void pushJson Player player JSONObject json if json null return JPokemonWebSocket webSocket synchronized players webSocket sockets get player id webSocket sendJson json public static void dispatch JPokemonWebSocket socket JSONObject request throws JSONException ServiceException String playerId synchronized players playerId sessions get socket if playerId null login socket request return Player player getPlayer playerId if request has load String serviceName request getString load JPokemonService service services get serviceName PlayerManager pushJson player service load request player else if hasActivity player Activity a getActivity player a serve request player else if request has service String serviceName request getString service JPokemonService service services get serviceName service serve request player public static void close JPokemonWebSocket socket String playerId synchronized players playerId sessions get socket if playerId null return Player player getPlayer playerId System out println player session closed File file new File JPokemonServer savepath playerId jpkmn try Writer writer new BufferedWriter new PrintWriter file writer write player toXml printToString 0 t writer close catch IOException e e printStackTrace for JPokemonService service services values service logout player while hasActivity player activities get player id pop logout player activities remove playerId synchronized players sessions remove socket sockets remove playerId players remove playerId private static void login JPokemonWebSocket socket JSONObject request throws JSONException ServiceException if request has login throw new ServiceException No credentials found String name request getString login if playerIsLoggedIn name Message message new Message error Player name is already logged in socket sendJson message toJson return if playerExists name Message message new Message error Player name save not found socket sendJson message toJson return Player player new Player name System out println player session opened String filename name jpkmn File file new File JPokemonServer savepath filename try player loadXML XmlParser parse file get 0 catch FileNotFoundException e synchronized players players put name player sockets put name socket sessions put socket name for JPokemonService service services values service login player activities put name new Stack Activity JSONObject closeLoginJson new JSONObject try closeLoginJson put action login accept catch JSONException e pushJson player closeLoginJson private static Map String JPokemonService services private static volatile Map String Player players new HashMap String Player private static volatile Map String JPokemonWebSocket sockets new HashMap String JPokemonWebSocket private static volatile Map JPokemonWebSocket String sessions new HashMap JPokemonWebSocket String private static Map String Stack Activity activities new HashMap String Stack @@@ 4 195
package org jpokemon server public class ServiceException extends Exception public ServiceException String message _message message public String getMessage return _message private String _message private static final long serialVersionUID @@@ 4 196
package org jpokemon trainer import java util List import org jpokemon server JPokemonServer import com njkremer Sqlite DataConnectionException import com njkremer Sqlite DataConnectionManager import com njkremer Sqlite SqlStatement import com njkremer Sqlite Annotations AutoIncrement import com njkremer Sqlite Annotations PrimaryKey public class Event @PrimaryKey @AutoIncrement private int number private String description public static Event createNew Event event new Event event setDescription undefined try SqlStatement insert event execute catch DataConnectionException e event null e printStackTrace return event public static Event get int number DataConnectionManager init JPokemonServer databasepath Event event null try List Event query SqlStatement select Event class where number eq number getList if query isEmpty event query get 0 catch DataConnectionException e e printStackTrace return event public void commit try SqlStatement update this execute catch DataConnectionException e e printStackTrace public String toString return Event getNumber getDescription public int getNumber return number public void setNumber int n number n public String getDescription return description public void setDescription String s description @@@ 4 197
package org jpokemon trainer import java util ArrayList import java util Collections import java util HashMap import java util List import java util Map import org jpokemon item Bag import org jpokemon item Item import org jpokemon overworld Location import org jpokemon pokedex Pokedex import org jpokemon pokemon Pokemon import org jpokemon pokemon storage PokemonStorageBlock import org jpokemon pokemon storage PokemonStorageUnit import org zachtaylor jnodalxml XmlNode public class Player implements PokemonTrainer public static final String XML_NODE_NAME player private String _id _avatar private Bag _bag new Bag private Pokedex _pokedex new Pokedex private Record _record new Record this private Location location new Location private int _badge _cash _xp _level private Map String List String _friends new HashMap String List String private List String _unlockedAvatars new ArrayList String private PokemonStorageBlock _storage new PokemonStorageBlock public Player String id _id id public String id return _id public int getCash return _cash public void setCash int cash _cash cash public int getExperience return _xp public void setExperience int xp _xp xp public String getAvatar return _avatar public void setAvatar String name if _unlockedAvatars contains name return _avatar name public List String getAvatars return Collections unmodifiableList _unlockedAvatars public void addAvatar String name _unlockedAvatars add name public void removeAvatar String name _unlockedAvatars remove name public int getLevel return _level public void setLevel int level _level level public Location getLocation return location public Player setLocation Location location this location location return this public List String getFriends if _friends get friends null return new ArrayList String return Collections unmodifiableList _friends get friends public void addFriend String name if _friends get friends null _friends put friends new ArrayList String _friends get friends add name removeBlocked name public void removeFriend String name if _friends get friends null return _friends get friends remove name public List String getBlocked if _friends get blocked null return new ArrayList String return Collections unmodifiableList _friends get blocked public void addBlocked String name if _friends get blocked null _friends put blocked new ArrayList String _friends get blocked add name removeFriend name public void removeBlocked String name if _friends get blocked null return _friends get blocked remove name public int getBadgeCount return _badge public void setBadgeCount int badge _badge badge public Bag getBag return _bag public Item item int itemID return _bag get itemID public PokemonStorageUnit party return box 0 public PokemonStorageUnit box int box return _storage get box public PokemonStorageBlock getAllPokemon return _storage public boolean add Pokemon p if _record getStarterPokemon null _record setStarterPokemon p name for PokemonStorageUnit unit _storage if unit add p _pokedex own p number p setTrainerName id return true return false public Pokedex pokedex return _pokedex public Record record return _record public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME node setAttribute cash _cash node setAttribute badge _badge if _avatar null node setAttribute avatar _avatar node addChild location toXml node addChild _bag toXml node addChild _record toXml node addChild _pokedex toXml node addChild _storage toXml XmlNode friends new XmlNode friends if _friends get friends null friends setValue _friends get friends toString node addChild friends XmlNode blocked new XmlNode blocked if _friends get blocked null blocked setValue _friends get blocked toString node addChild blocked XmlNode avatars new XmlNode avatars avatars setValue _unlockedAvatars toString node addChild avatars return node public void loadXML XmlNode node _cash node getIntAttribute cash _badge node getIntAttribute badge location loadXml node getChildren Location XML_NODE_NAME get 0 _bag loadXml node getChildren Bag XML_NODE_NAME get 0 _record loadXml node getChildren Record XML_NODE_NAME get 0 _pokedex loadXml node getChildren Pokedex XML_NODE_NAME get 0 _storage loadXml node getChildren PokemonStorageBlock XML_NODE_NAME get 0 String friendsString node getChildren friends get 0 getValue if friendsString null for String f friendsString replace replace trim split if f isEmpty continue addFriend f String blockedString node getChildren blocked get 0 getValue if blockedString null for String f blockedString replace replace trim split if f isEmpty continue addBlocked f try String avatarsString node getChildren avatars get 0 getValue for String avatar avatarsString replace replace split addAvatar avatar trim if node hasAttribute avatar _avatar node getAttribute avatar else _avatar male hero 1 catch Exception e _unlockedAvatars new ArrayList String _unlockedAvatars add male hero 1 setAvatar male hero 1 @Override public boolean equals Object o if o instanceof Player return false return Player o _id equals _id @Override public int hashCode return _id hashCode @Override public String toString return Player@ hashCode @@@ 4 198
package org jpokemon trainer import org jpokemon pokemon Pokemon import org jpokemon pokemon storage PokemonStorageUnit public interface PokemonTrainer public String id public PokemonStorageUnit party public boolean add Pokemon @@@ 4 199
package org jpokemon trainer import java util ArrayList import java util List import org json JSONArray import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode public class Progress public static final String XML_NODE_NAME progress public Progress _events new ArrayList Integer public void put int id if id 1 throw new IllegalArgumentException Out of bounds event id if _events contains id throw new IllegalArgumentException Duplicate put for event id _events add id public boolean get int id if id 1 throw new IllegalArgumentException Out of bounds event id return _events contains id public JSONArray toJSON JSONArray data new JSONArray for Integer i _events data put i intValue return data public XmlNode toXML XmlNode node new XmlNode XML_NODE_NAME node setValue _events toString return node public void loadXML XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node for String value node getValue replace replace trim split if value isEmpty continue put Integer parseInt value private List Integer @@@ 4 200
package org jpokemon trainer import java util ArrayList import java util List import org zachtaylor jnodalxml XmlException import org zachtaylor jnodalxml XmlNode public class Record public static final String XML_NODE_NAME record public Record Player p player p public void setRivalName String rivalName _rivalName rivalName public String getRivalName return _rivalName public void setStarterPokemon String p _pokemon p public String getStarterPokemon return _pokemon public void putEvent int id if id 1 throw new IllegalArgumentException Out of bounds event id if _events contains id throw new IllegalArgumentException Duplicate put for event id _events add id public boolean getEvent int id if id 1 throw new IllegalArgumentException Out of bounds event id return _events contains id public void putTrainer String id if _trainers contains id throw new IllegalArgumentException Duplicate put for trainer id _trainers add id public boolean getTrainer String id return _trainers contains id public String replaceMacros String s if _rivalName null s s replaceAll rival _rivalName if player null s s replaceAll player player id if _pokemon null s s replaceAll starter _pokemon return s public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME if _rivalName null node setAttribute rival _rivalName if _pokemon null node setAttribute starter _pokemon XmlNode eventNode new XmlNode events eventNode setValue _events toString node addChild eventNode XmlNode trainerNode new XmlNode trainers trainerNode setValue _trainers toString node addChild trainerNode return node public void loadXml XmlNode node if XML_NODE_NAME equals node getName throw new XmlException Cannot read node if node hasAttribute rival _rivalName node getAttribute rival if node hasAttribute starter _pokemon node getAttribute starter for String value node getChildren events get 0 getValue replace replace trim split if value isEmpty continue putEvent Integer parseInt value for String value node getChildren trainers get 0 getValue replace replace trim split if value isEmpty continue putTrainer value private Player player private String _rivalName _pokemon private List Integer _events new ArrayList Integer private List String _trainers new ArrayList @@@ 4 201
package org jpokemon trainer import org jpokemon pokemon Pokemon import org jpokemon pokemon storage PokemonStorageUnit import org zachtaylor jnodalxml XmlNode public class Trainer implements PokemonTrainer public static String XML_NODE_NAME trainer public Trainer String id _id id public String id return _id public String getName return _name public void setName String name _name name public boolean isGym return _isGym public void setGym boolean isGym _isGym isGym public PokemonStorageUnit party return _party public boolean add Pokemon p p setTrainerName getName return party add p public XmlNode toXml XmlNode node new XmlNode XML_NODE_NAME node setAttribute name _name node setAttribute gym _isGym node addChild _party toXml return node public void loadXml XmlNode node _name node getAttribute name _isGym node getBoolAttribute gym _party loadXml node getChildren PokemonStorageUnit XML_NODE_NAME get 0 public boolean equals Object o if o instanceof Trainer return false return Trainer o _id _id public int hashCode return _id hashCode private boolean _isGym false private String _name null _id null private PokemonStorageUnit _party new @@@ 4 202
package org jpokemon trainer import org jpokemon pokemon Pokemon import org jpokemon pokemon storage PokemonStorageUnit public class WildTrainer implements PokemonTrainer public String id return wild_pokemon public String getName return Wild Pokemon public void setName String s public PokemonStorageUnit party return _party public boolean add Pokemon p return party add p public void notify String message private PokemonStorageUnit _party new @@@ 4 203
package org jpokemon pokedex import junit framework TestCase public class PokedexTest extends TestCase public static int power 5 range 20 Pokedex dex protected void setUp dex new Pokedex public void testSaw int cur for int i 0 i power i cur int Math random range 1 dex saw cur assertTrue PokedexStatus SAW dex status cur public void testOwn int cur for int i 0 i power i cur int Math random range 1 dex own cur assertTrue PokedexStatus OWN dex status cur public void testNoValue int n int Math random range 1 assertEquals PokedexStatus NONE dex status n public void testCount assertEquals 0 dex count int n int Math random range 1 dex saw n assertEquals 1 dex count public void testOwnOverridesSaw int n int Math random range 1 dex saw n dex own n assertTrue PokedexStatus OWN dex status n public void testSawDoesNotOverrideOwn int n int Math random range 1 dex own n dex saw n assertTrue PokedexStatus OWN dex status n public void testMinimumValue try dex status 0 fail catch Exception e assertTrue e instanceof IllegalArgumentException try dex saw 0 fail catch Exception e assertTrue e instanceof IllegalArgumentException try dex own 0 fail catch Exception e assertTrue e instanceof @@@ 4 204
package org jpokemon pokemon import junit framework TestCase import org jpokemon pokemon stat StatBlock import org jpokemon pokemon stat StatType public class PokemonTest extends TestCase static int number level static Pokemon pokemon static int randomPokemon 1 4 7 10 13 public void setUp number randomPokemon int Math random randomPokemon length level 5 int Math random 5 pokemon new Pokemon number level public void testNumber assertEquals number pokemon number public void testName String nickname foo assertEquals pokemon species pokemon name pokemon name nickname assertEquals nickname pokemon name pokemon name null assertEquals pokemon species pokemon name public void testXp assertEquals 0 pokemon xp assertEquals level pokemon level pokemon xp 1 assertEquals 1 pokemon xp assertEquals level pokemon level pokemon xp pokemon xpNeeded assertEquals 0 pokemon xp assertEquals level 1 pokemon level public void testStatLookup assertEquals pokemon attack pokemon getStat StatType ATTACK cur assertEquals pokemon specattack pokemon getStat StatType SPECATTACK cur assertEquals pokemon defense pokemon getStat StatType DEFENSE cur assertEquals pokemon specdefense pokemon getStat StatType SPECDEFENSE cur assertEquals pokemon speed pokemon getStat StatType SPEED cur public void testStatPoints try pokemon statPoints StatType ATTACK 1 fail Cannot spend when have no stat points to spend catch Exception e assertTrue e instanceof IllegalStateException assertEquals 0 pokemon getStat StatType ATTACK points StatBlock bonuslevelrate 1 0 level pokemon level level pokemon statPoints StatType ATTACK 1 assertEquals 1 0 pokemon getStat StatType ATTACK points try pokemon statPoints StatType ATTACK 1 fail Cannot spend when have no stat points to spend catch Exception e assertTrue e instanceof IllegalStateException assertEquals int StatBlock bonuslevelrate pokemon getStat StatType ATTACK points public void testDamageAndHealth int maxhealth pokemon maxHealth int damage pokemon health 1 assertTrue pokemon awake pokemon takeDamage damage assertEquals 1 pokemon health assertEquals maxhealth pokemon maxHealth assertTrue pokemon awake pokemon takeDamage 1 assertEquals 0 pokemon health assertEquals maxhealth pokemon maxHealth assertFalse pokemon awake pokemon healDamage 5 assertEquals 5 pokemon health assertEquals maxhealth pokemon maxHealth assertTrue pokemon awake public void testOriginalTrainer assertFalse pokemon hasOriginalTrainer assertEquals null pokemon getTrainerName pokemon setTrainerName foo assertTrue pokemon hasOriginalTrainer assertEquals foo pokemon getTrainerName pokemon setTrainerName bar assertTrue pokemon hasOriginalTrainer assertEquals foo pokemon @@@ 4 205
package org jpokemon pokemon move import junit framework TestCase import org junit Test public class MoveBlockTest extends TestCase MoveBlock block int pokemonNumber moveRange 40 pokemonRange 25 public void setUp pokemonNumber 1 int Math random pokemonRange 1 block new MoveBlock pokemonNumber @Test public void testEveryPokemonHasDefaultMoves for int i 1 i pokemonRange i pokemonNumber i block new MoveBlock pokemonNumber assertTrue block count 0 public void testAdd while block count MoveBlock movecount setUp int count block count try block add 0 fail You cannot add Move 0 catch Exception e assertTrue e instanceof IllegalArgumentException assertEquals count block count block add 3 assertEquals count 1 block count int number for number 14 block count MoveBlock movecount number try block add number catch IllegalArgumentException e try for block count MoveBlock movecount number try block add number catch IllegalArgumentException e block add number fail Should die when overadding things catch Exception e assertTrue e instanceof IllegalStateException public void testAddOverwrite try block add 3 1 fail Cannot add to position 1 catch Exception e assertTrue e instanceof IllegalArgumentException int moveNumber do moveNumber int Math random moveRange while moveNumber block get 0 number block add moveNumber 0 assertEquals new Move moveNumber block get 0 while block count MoveBlock movecount 1 setUp int count block count try block add 0 count fail You cannot add Move 0 catch Exception e assertTrue e instanceof IllegalArgumentException assertEquals count block count try block add count count 1 catch Exception e assertTrue e instanceof IllegalArgumentException public void testRemoveAll block removeAll assertEquals 0 block count public void testRestoreAll while block count 2 setUp while block get 0 pp 0 block get 0 use while block get 1 pp 0 block get 1 use assertTrue block get 0 enabled assertTrue block get 1 enabled block restoreAll assertTrue block get 0 enabled assertTrue block get 1 enabled public void testRandomizeNoMoves block randomize 0 assertTrue block count 0 public void testPreventDuplicateMoves int moveNumber int Math random moveRange block removeAll block add moveNumber try block add moveNumber fail Duplicate move allowed catch Exception e assertTrue e instanceof @@@ 4 206
package org jpokemon pokemon move import java util HashMap import java util Map import junit framework TestCase import org jpokemon pokemon Type import org junit Test public class MoveTest extends TestCase static int moveRange 40 Move move int number MoveInfo answers public void setUp number 1 int Math random moveRange move new Move number answers MoveInfo get number @Test public void testNumber assertEquals number move number public void testName assertEquals answers getName move name public void testPpMax assertEquals answers getPp move pp public void testType Type type Type valueOf answers getType assertEquals type move type public void testDisable assertTrue move enabled move enable false assertFalse move enabled public void testPpCount number 141 move new Move number answers MoveInfo get number int random int Math random answers getPp for int i 0 i random i move use assertEquals random answers getPp move pp public void testPpExhaustion number 141 move new Move number answers MoveInfo get number assertTrue move enabled for int i answers getPp i 0 i move use assertFalse move enabled public void testRestore number 141 move new Move number answers MoveInfo get number assertTrue move enabled for int i answers getPp i 0 i move use assertFalse move enabled move restore assertEquals answers getPp move pp public void testReps MoveStyle style MoveStyle valueOf answers getStyle while style MoveStyle REPEAT number 1 int Math random moveRange move new Move number answers MoveInfo get number style MoveStyle valueOf answers getStyle assertTrue move reps 1 while style MoveStyle REPEAT number 1 int Math random moveRange move new Move number answers MoveInfo get number style MoveStyle valueOf answers getStyle assertTrue move reps 1 public void testSTAB Type type Type valueOf answers getType assertEquals 1 5 move STAB type null while type Type valueOf answers getType type Type valueOf int Math random Type values length assertEquals 1 0 move STAB type null public void testRepsDistribution int sampleSize 128 result Map Integer Integer results new HashMap Integer Integer MoveStyle style MoveStyle valueOf answers getStyle while style MoveStyle REPEAT number 1 int Math random moveRange move new Move number answers MoveInfo get number style MoveStyle valueOf answers getStyle for int i 0 i sampleSize i result move reps if results get result null results put result 0 results put result results get result 1 System out println nDistribution of Reps for Map Entry Integer Integer entry results entrySet System out print entry getKey System out println entry getValue 1 0 sampleSize System out @@@ 4 207
package org jpokemon pokemon stat import junit framework TestCase import org jpokemon pokemon ConditionEffect import org jpokemon pokemon PokemonInfo public class StatBlockTest extends TestCase static int range 25 StatBlock block PokemonInfo pokemon public void setUp int pokemonNumber int Math random range 1 pokemon PokemonInfo get pokemonNumber block new StatBlock pokemon block level 100 public void testGet Stat attackStat block get StatType ATTACK assertEquals pokemon getAttack attackStat _base public void testReset Stat specDefenseStat block get StatType SPECDEFENSE Stat healthStat block get StatType HEALTH int specDefense specDefenseStat cur int health healthStat cur specDefenseStat effect 2 healthStat effect 10 assertNotSame specDefense specDefenseStat cur assertNotSame health healthStat cur block reset assertEquals specDefense specDefenseStat cur assertEquals health healthStat cur public void testBurnEffectsAttack Stat attackStat block get StatType ATTACK int attack attackStat cur block addConditionEffect ConditionEffect BURN assertEquals Math max attack 2 1 attackStat cur public void testBurnEffectRemoval Stat attackStat block get StatType ATTACK int attack attackStat cur block addConditionEffect ConditionEffect BURN assertEquals Math max attack 2 1 attackStat cur block removeConditionEffect ConditionEffect BURN assertEquals attack attackStat cur public void testParalyzeEffectsSpeed Stat speedStat block get StatType SPEED int speed speedStat cur block addConditionEffect ConditionEffect PARALYZE assertEquals Math max speed 4 1 speedStat cur public void testRemoveMissingConditionIssue Stat attackStat block get StatType ATTACK int attack attackStat cur block removeConditionEffect ConditionEffect BURN assertEquals attack attackStat cur public void testParalyzeEffectRemoval Stat speedStat block get StatType SPEED int speed speedStat cur block addConditionEffect ConditionEffect PARALYZE assertEquals Math max speed 4 1 speedStat cur block removeConditionEffect ConditionEffect PARALYZE assertEquals speed speedStat cur public void testAddPoint Stat defenseStat block get StatType DEFENSE assertEquals 0 defenseStat points block points 1 block usePoints StatType DEFENSE 1 assertEquals 1 defenseStat points public void testCannotAddPointWhenHaveNoPoints Stat defenseStat block get StatType DEFENSE assertEquals 0 defenseStat points block points 0 try block usePoints StatType DEFENSE 1 fail No points to spend catch Exception e assertTrue e instanceof IllegalStateException assertEquals 0 defenseStat @@@ 4 208
package org jpokemon pokemon stat import junit framework TestCase public class StatTest extends TestCase Stat stat public void setUp stat new Stat stat iv 0 stat level 100 stat base 100 public void testBase assertEquals 310 stat max assertEquals stat max stat cur public void testLevel stat level 10 assertEquals 40 stat max assertEquals stat max stat cur public void testPoints stat points 100 assertEquals 100 stat points assertEquals 360 stat max assertEquals stat max stat cur public void testModify stat modify 1 2 0 assertEquals 155 stat cur public void testEffectUpOne stat effect 1 assertEquals 310 stat max assertEquals 465 stat cur public void testEffectDownOne stat effect 1 assertEquals 310 stat max assertEquals 206 stat cur public void testReset stat effect 6 assertEquals 310 stat max assertEquals 77 stat cur stat reset assertEquals 310 stat max assertEquals 310 stat cur public void testResetDoesNotOverrideModify stat effect 6 assertEquals 77 stat cur stat modify 1 0 2 assertEquals 38 stat cur stat reset assertEquals 155 stat cur public void testModifyDoesNotOverrideEffect stat effect 6 stat modify 1 0 2 assertEquals 38 stat cur stat modify 1 assertEquals 77 stat cur public void testEffectMaximum stat effect 6 assertEquals 310 stat max assertEquals 1240 stat cur stat effect 2 assertEquals 310 stat max assertEquals 1240 stat cur public void testEffectMinimum stat effect 6 assertEquals 310 stat max assertEquals 77 stat cur stat effect 2 assertEquals 310 stat max assertEquals 77 stat cur public void testMinimumValue stat base 1 stat level 1 stat effect 6 assertEquals 2 stat cur public void testModifyAndEffect stat modify 1 0 2 stat effect 2 assertEquals 310 stat cur public void testEV assertEquals 310 stat max stat ev 100 stat level 100 assertEquals 100 stat ev assertEquals 335 stat max public void testIV stat iv 100 assertEquals 100 stat iv assertEquals 410 stat @@@ 4 209
package org jpokemon pokemon storage import junit framework TestCase import org jpokemon pokemon Pokemon public class PokemonStorageUnitTest extends TestCase private static int size 6 public static PokemonStorageUnit unit public void setUp unit new PokemonStorageUnit size public void testAdd unit add new Pokemon 1 assertEquals 1 unit size public void testRemove Pokemon p new Pokemon 1 unit add p unit remove p assertEquals 0 unit size public void testGet Pokemon p new Pokemon 1 unit add p assertEquals p unit get 0 public void testSwap Pokemon p1 new Pokemon 1 Pokemon p2 new Pokemon 2 unit add p1 unit add p2 unit swap 0 1 assertEquals p1 unit get 1 assertEquals p2 unit get 0 public void testAddLimit for int i 0 i size 1 i unit add new Pokemon i 1 assertEquals size unit size public void testGetBounds try unit get 0 fail catch Exception e assertTrue e instanceof IllegalArgumentException public void testSwapMany Pokemon p1 new Pokemon 1 Pokemon p2 new Pokemon 2 Pokemon p3 new Pokemon 3 Pokemon p4 new Pokemon 4 unit add p1 unit add p2 unit add p3 unit add p4 unit swap 0 3 assertEquals p4 unit get 0 assertEquals p2 unit get 1 assertEquals p3 unit get 2 assertEquals p1 unit get 3 public void testSwapBounds try unit swap 0 1 fail catch Exception e assertTrue e instanceof IllegalArgumentException public void testSwapSame Pokemon p1 new Pokemon 1 unit add p1 try unit swap 0 0 fail catch Exception e assertTrue e instanceof IllegalArgumentException public void testRemoveNotInPartyException PokemonStorageUnit unit1 new PokemonStorageUnit 6 Pokemon p1 new Pokemon 1 Pokemon p2 new Pokemon 2 unit1 add p1 unit add p2 try unit remove p1 fail catch Exception e assertTrue e instanceof @@@ 4 210
package org jpokemon trainer import junit framework TestCase import org jpokemon pokedex PokedexStatus import org jpokemon pokemon Pokemon import org jpokemon pokemon storage PokemonStorageUnit public class PlayerTest extends TestCase static int range 25 Player player public void setUp player new Player id public void testBadge int badge 2 player setBadgeCount badge assertEquals badge player getBadgeCount public void testCash int cash 200 player setCash cash assertEquals cash player getCash public void testAddUsesStorage int i 1 while player party add new Pokemon i i assertEquals PokemonStorageUnit partysize player party size assertFalse player party add new Pokemon i assertTrue player add new Pokemon i public void testAddPokemonUpdatesPokedex int number int Math random range 1 Pokemon p new Pokemon number assertEquals PokedexStatus NONE player pokedex status number player add p assertEquals PokedexStatus OWN player pokedex status @@@ 4 211
package org jpokemon trainer import junit framework TestCase public class RecordTest extends TestCase private Record record public void setUp record new Record null public void testGetPutEvent assertFalse record getEvent 7 record putEvent 7 assertTrue record getEvent 7 public void testGetPutTrainer assertFalse record getTrainer foo record putTrainer foo assertTrue record getTrainer foo public void testEventBounds try record getEvent 0 fail Out of bounds event catch Exception e assertTrue e instanceof IllegalArgumentException try record putEvent 0 fail Out of bounds event catch Exception e assertTrue e instanceof IllegalArgumentException public void testRepeatPutEvent record putEvent 7 try record putEvent 7 fail Duplicate put should fail catch Exception e assertTrue e instanceof IllegalArgumentException public void testRepeatPutTrainer record putTrainer gary try record putTrainer gary fail Duplicate put should fail catch Exception e assertTrue e instanceof @@@ 4 212
